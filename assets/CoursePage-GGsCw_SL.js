import{h as Sd,g as L,_ as st,i as Ii,r as Te,b as yo,j as Nc,o as ce,c as he,w as Yo,v as es,a as ee,k as Cd,l as Un,p as yd,m as Rd,n as Pd,t as ts,q as jc,s as ho,d as tt,e as Xr,F as Lc,f as Ed,x as _d,y as Je,z as Id,A as Td}from"./index-AeptQjzu.js";import{H as rs}from"./Header-3xabpu00.js";var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ad(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var p=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,p.get?p:{enumerable:!0,get:function(){return r[n]}})}),t}const Re=Sd({events:new Map}),Pi={log(){console.log(Re.events)},emit(r,e){Re.events.has(r)||Re.events.set(r,[]),Re.events.get(r).forEach(n=>n(e)),this.log()},on(r,e){Re.events.has(r)||Re.events.set(r,new Set);const t=Re.events.get(r);return t.add(e),this.log(),()=>{t.delete(e),t.size===0&&Re.events.delete(r)}}};var re={},$n={},Ti={},Wn={},j={},at={},ae={},xc={},Ai={},wi={};Object.defineProperty(wi,"__esModule",{value:!0});wi.default=bd;let mi;const wd=new Uint8Array(16);function bd(){if(!mi&&(mi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mi(wd)}var be={},Ze={},bi={};Object.defineProperty(bi,"__esModule",{value:!0});bi.default=void 0;var Od=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;bi.default=Od;Object.defineProperty(Ze,"__esModule",{value:!0});Ze.default=void 0;var Md=Dd(bi);function Dd(r){return r&&r.__esModule?r:{default:r}}function kd(r){return typeof r=="string"&&Md.default.test(r)}var zd=kd;Ze.default=zd;Object.defineProperty(be,"__esModule",{value:!0});be.default=void 0;be.unsafeStringify=Bc;var Nd=jd(Ze);function jd(r){return r&&r.__esModule?r:{default:r}}const U=[];for(let r=0;r<256;++r)U.push((r+256).toString(16).slice(1));function Bc(r,e=0){return U[r[e+0]]+U[r[e+1]]+U[r[e+2]]+U[r[e+3]]+"-"+U[r[e+4]]+U[r[e+5]]+"-"+U[r[e+6]]+U[r[e+7]]+"-"+U[r[e+8]]+U[r[e+9]]+"-"+U[r[e+10]]+U[r[e+11]]+U[r[e+12]]+U[r[e+13]]+U[r[e+14]]+U[r[e+15]]}function Ld(r,e=0){const t=Bc(r,e);if(!(0,Nd.default)(t))throw TypeError("Stringified UUID is invalid");return t}var xd=Ld;be.default=xd;Object.defineProperty(Ai,"__esModule",{value:!0});Ai.default=void 0;var Bd=Fd(wi),qd=be;function Fd(r){return r&&r.__esModule?r:{default:r}}let is,Hn,Vn=0,Kn=0;function Ud(r,e,t){let n=e&&t||0;const p=e||new Array(16);r=r||{};let u=r.node||is,c=r.clockseq!==void 0?r.clockseq:Hn;if(u==null||c==null){const d=r.random||(r.rng||Bd.default)();u==null&&(u=is=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),c==null&&(c=Hn=(d[6]<<8|d[7])&16383)}let s=r.msecs!==void 0?r.msecs:Date.now(),i=r.nsecs!==void 0?r.nsecs:Kn+1;const o=s-Vn+(i-Kn)/1e4;if(o<0&&r.clockseq===void 0&&(c=c+1&16383),(o<0||s>Vn)&&r.nsecs===void 0&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Vn=s,Kn=i,Hn=c,s+=122192928e5;const a=((s&268435455)*1e4+i)%4294967296;p[n++]=a>>>24&255,p[n++]=a>>>16&255,p[n++]=a>>>8&255,p[n++]=a&255;const h=s/4294967296*1e4&268435455;p[n++]=h>>>8&255,p[n++]=h&255,p[n++]=h>>>24&15|16,p[n++]=h>>>16&255,p[n++]=c>>>8|128,p[n++]=c&255;for(let d=0;d<6;++d)p[n+d]=u[d];return e||(0,qd.unsafeStringify)(p)}var $d=Ud;Ai.default=$d;var Oi={},we={},ii={};Object.defineProperty(ii,"__esModule",{value:!0});ii.default=void 0;var Wd=Hd(Ze);function Hd(r){return r&&r.__esModule?r:{default:r}}function Vd(r){if(!(0,Wd.default)(r))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Kd=Vd;ii.default=Kd;Object.defineProperty(we,"__esModule",{value:!0});we.URL=we.DNS=void 0;we.default=Xd;var Jd=be,Gd=Qd(ii);function Qd(r){return r&&r.__esModule?r:{default:r}}function Zd(r){r=unescape(encodeURIComponent(r));const e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}const qc="6ba7b810-9dad-11d1-80b4-00c04fd430c8";we.DNS=qc;const Fc="6ba7b811-9dad-11d1-80b4-00c04fd430c8";we.URL=Fc;function Xd(r,e,t){function n(p,u,c,s){var i;if(typeof p=="string"&&(p=Zd(p)),typeof u=="string"&&(u=(0,Gd.default)(u)),((i=u)===null||i===void 0?void 0:i.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let o=new Uint8Array(16+p.length);if(o.set(u),o.set(p,u.length),o=t(o),o[6]=o[6]&15|e,o[8]=o[8]&63|128,c){s=s||0;for(let a=0;a<16;++a)c[s+a]=o[a];return c}return(0,Jd.unsafeStringify)(o)}try{n.name=r}catch{}return n.DNS=qc,n.URL=Fc,n}var Mi={};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.default=void 0;function Yd(r){if(typeof r=="string"){const e=unescape(encodeURIComponent(r));r=new Uint8Array(e.length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t)}return eh(th(rh(r),r.length*8))}function eh(r){const e=[],t=r.length*32,n="0123456789abcdef";for(let p=0;p<t;p+=8){const u=r[p>>5]>>>p%32&255,c=parseInt(n.charAt(u>>>4&15)+n.charAt(u&15),16);e.push(c)}return e}function Uc(r){return(r+64>>>9<<4)+14+1}function th(r,e){r[e>>5]|=128<<e%32,r[Uc(e)-1]=e;let t=1732584193,n=-271733879,p=-1732584194,u=271733878;for(let c=0;c<r.length;c+=16){const s=t,i=n,o=p,a=u;t=K(t,n,p,u,r[c],7,-680876936),u=K(u,t,n,p,r[c+1],12,-389564586),p=K(p,u,t,n,r[c+2],17,606105819),n=K(n,p,u,t,r[c+3],22,-1044525330),t=K(t,n,p,u,r[c+4],7,-176418897),u=K(u,t,n,p,r[c+5],12,1200080426),p=K(p,u,t,n,r[c+6],17,-1473231341),n=K(n,p,u,t,r[c+7],22,-45705983),t=K(t,n,p,u,r[c+8],7,1770035416),u=K(u,t,n,p,r[c+9],12,-1958414417),p=K(p,u,t,n,r[c+10],17,-42063),n=K(n,p,u,t,r[c+11],22,-1990404162),t=K(t,n,p,u,r[c+12],7,1804603682),u=K(u,t,n,p,r[c+13],12,-40341101),p=K(p,u,t,n,r[c+14],17,-1502002290),n=K(n,p,u,t,r[c+15],22,1236535329),t=J(t,n,p,u,r[c+1],5,-165796510),u=J(u,t,n,p,r[c+6],9,-1069501632),p=J(p,u,t,n,r[c+11],14,643717713),n=J(n,p,u,t,r[c],20,-373897302),t=J(t,n,p,u,r[c+5],5,-701558691),u=J(u,t,n,p,r[c+10],9,38016083),p=J(p,u,t,n,r[c+15],14,-660478335),n=J(n,p,u,t,r[c+4],20,-405537848),t=J(t,n,p,u,r[c+9],5,568446438),u=J(u,t,n,p,r[c+14],9,-1019803690),p=J(p,u,t,n,r[c+3],14,-187363961),n=J(n,p,u,t,r[c+8],20,1163531501),t=J(t,n,p,u,r[c+13],5,-1444681467),u=J(u,t,n,p,r[c+2],9,-51403784),p=J(p,u,t,n,r[c+7],14,1735328473),n=J(n,p,u,t,r[c+12],20,-1926607734),t=G(t,n,p,u,r[c+5],4,-378558),u=G(u,t,n,p,r[c+8],11,-2022574463),p=G(p,u,t,n,r[c+11],16,1839030562),n=G(n,p,u,t,r[c+14],23,-35309556),t=G(t,n,p,u,r[c+1],4,-1530992060),u=G(u,t,n,p,r[c+4],11,1272893353),p=G(p,u,t,n,r[c+7],16,-155497632),n=G(n,p,u,t,r[c+10],23,-1094730640),t=G(t,n,p,u,r[c+13],4,681279174),u=G(u,t,n,p,r[c],11,-358537222),p=G(p,u,t,n,r[c+3],16,-722521979),n=G(n,p,u,t,r[c+6],23,76029189),t=G(t,n,p,u,r[c+9],4,-640364487),u=G(u,t,n,p,r[c+12],11,-421815835),p=G(p,u,t,n,r[c+15],16,530742520),n=G(n,p,u,t,r[c+2],23,-995338651),t=Q(t,n,p,u,r[c],6,-198630844),u=Q(u,t,n,p,r[c+7],10,1126891415),p=Q(p,u,t,n,r[c+14],15,-1416354905),n=Q(n,p,u,t,r[c+5],21,-57434055),t=Q(t,n,p,u,r[c+12],6,1700485571),u=Q(u,t,n,p,r[c+3],10,-1894986606),p=Q(p,u,t,n,r[c+10],15,-1051523),n=Q(n,p,u,t,r[c+1],21,-2054922799),t=Q(t,n,p,u,r[c+8],6,1873313359),u=Q(u,t,n,p,r[c+15],10,-30611744),p=Q(p,u,t,n,r[c+6],15,-1560198380),n=Q(n,p,u,t,r[c+13],21,1309151649),t=Q(t,n,p,u,r[c+4],6,-145523070),u=Q(u,t,n,p,r[c+11],10,-1120210379),p=Q(p,u,t,n,r[c+2],15,718787259),n=Q(n,p,u,t,r[c+9],21,-343485551),t=Ie(t,s),n=Ie(n,i),p=Ie(p,o),u=Ie(u,a)}return[t,n,p,u]}function rh(r){if(r.length===0)return[];const e=r.length*8,t=new Uint32Array(Uc(e));for(let n=0;n<e;n+=8)t[n>>5]|=(r[n/8]&255)<<n%32;return t}function Ie(r,e){const t=(r&65535)+(e&65535);return(r>>16)+(e>>16)+(t>>16)<<16|t&65535}function ih(r,e){return r<<e|r>>>32-e}function Di(r,e,t,n,p,u){return Ie(ih(Ie(Ie(e,r),Ie(n,u)),p),t)}function K(r,e,t,n,p,u,c){return Di(e&t|~e&n,r,e,p,u,c)}function J(r,e,t,n,p,u,c){return Di(e&n|t&~n,r,e,p,u,c)}function G(r,e,t,n,p,u,c){return Di(e^t^n,r,e,p,u,c)}function Q(r,e,t,n,p,u,c){return Di(t^(e|~n),r,e,p,u,c)}var nh=Yd;Mi.default=nh;Object.defineProperty(Oi,"__esModule",{value:!0});Oi.default=void 0;var oh=$c(we),sh=$c(Mi);function $c(r){return r&&r.__esModule?r:{default:r}}const ah=(0,oh.default)("v3",48,sh.default);var ch=ah;Oi.default=ch;var ki={},zi={};Object.defineProperty(zi,"__esModule",{value:!0});zi.default=void 0;const uh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var ph={randomUUID:uh};zi.default=ph;Object.defineProperty(ki,"__esModule",{value:!0});ki.default=void 0;var ns=Wc(zi),dh=Wc(wi),hh=be;function Wc(r){return r&&r.__esModule?r:{default:r}}function lh(r,e,t){if(ns.default.randomUUID&&!e&&!r)return ns.default.randomUUID();r=r||{};const n=r.random||(r.rng||dh.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let p=0;p<16;++p)e[t+p]=n[p];return e}return(0,hh.unsafeStringify)(n)}var vh=lh;ki.default=vh;var Ni={},ji={};Object.defineProperty(ji,"__esModule",{value:!0});ji.default=void 0;function fh(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Jn(r,e){return r<<e|r>>>32-e}function gh(r){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){const c=unescape(encodeURIComponent(r));r=[];for(let s=0;s<c.length;++s)r.push(c.charCodeAt(s))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);const n=r.length/4+2,p=Math.ceil(n/16),u=new Array(p);for(let c=0;c<p;++c){const s=new Uint32Array(16);for(let i=0;i<16;++i)s[i]=r[c*64+i*4]<<24|r[c*64+i*4+1]<<16|r[c*64+i*4+2]<<8|r[c*64+i*4+3];u[c]=s}u[p-1][14]=(r.length-1)*8/Math.pow(2,32),u[p-1][14]=Math.floor(u[p-1][14]),u[p-1][15]=(r.length-1)*8&4294967295;for(let c=0;c<p;++c){const s=new Uint32Array(80);for(let l=0;l<16;++l)s[l]=u[c][l];for(let l=16;l<80;++l)s[l]=Jn(s[l-3]^s[l-8]^s[l-14]^s[l-16],1);let i=t[0],o=t[1],a=t[2],h=t[3],d=t[4];for(let l=0;l<80;++l){const v=Math.floor(l/20),f=Jn(i,5)+fh(v,o,a,h)+d+e[v]+s[l]>>>0;d=h,h=a,a=Jn(o,30)>>>0,o=i,i=f}t[0]=t[0]+i>>>0,t[1]=t[1]+o>>>0,t[2]=t[2]+a>>>0,t[3]=t[3]+h>>>0,t[4]=t[4]+d>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var mh=gh;ji.default=mh;Object.defineProperty(Ni,"__esModule",{value:!0});Ni.default=void 0;var Sh=Hc(we),Ch=Hc(ji);function Hc(r){return r&&r.__esModule?r:{default:r}}const yh=(0,Sh.default)("v5",80,Ch.default);var Rh=yh;Ni.default=Rh;var Li={};Object.defineProperty(Li,"__esModule",{value:!0});Li.default=void 0;var Ph="00000000-0000-0000-0000-000000000000";Li.default=Ph;var xi={};Object.defineProperty(xi,"__esModule",{value:!0});xi.default=void 0;var Eh=_h(Ze);function _h(r){return r&&r.__esModule?r:{default:r}}function Ih(r){if(!(0,Eh.default)(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}var Th=Ih;xi.default=Th;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NIL",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(r,"parse",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(r,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(r,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(r,"v4",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(r,"v5",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(r,"validate",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return c.default}});var e=a(Ai),t=a(Oi),n=a(ki),p=a(Ni),u=a(Li),c=a(xi),s=a(Ze),i=a(be),o=a(ii);function a(h){return h&&h.__esModule?h:{default:h}}})(xc);Object.defineProperty(ae,"__esModule",{value:!0});ae.createNoDashGuid=ae.createGuid=void 0;const Ah=xc,Vc=()=>Ah.v4();ae.createGuid=Vc;const wh=()=>Vc().replace(new RegExp("-","g"),"").toUpperCase();ae.createNoDashGuid=wh;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PlatformEvent=r.EventType=void 0;const e=ae;(function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warning=2]="Warning",n[n.Error=3]="Error",n[n.None=4]="None"})(r.EventType||(r.EventType={}));class t{constructor(p,u){this.privName=p,this.privEventId=e.createNoDashGuid(),this.privEventTime=new Date().toISOString(),this.privEventType=u,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}r.PlatformEvent=t})(at);Object.defineProperty(j,"__esModule",{value:!0});j.AudioStreamNodeErrorEvent=j.AudioStreamNodeDetachedEvent=j.AudioStreamNodeAttachedEvent=j.AudioStreamNodeAttachingEvent=j.AudioStreamNodeEvent=j.AudioSourceErrorEvent=j.AudioSourceOffEvent=j.AudioSourceReadyEvent=j.AudioSourceInitializingEvent=j.AudioSourceEvent=void 0;const lo=at;class ct extends lo.PlatformEvent{constructor(e,t,n=lo.EventType.Info){super(e,n),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}}j.AudioSourceEvent=ct;class bh extends ct{constructor(e){super("AudioSourceInitializingEvent",e)}}j.AudioSourceInitializingEvent=bh;class Oh extends ct{constructor(e){super("AudioSourceReadyEvent",e)}}j.AudioSourceReadyEvent=Oh;class Mh extends ct{constructor(e){super("AudioSourceOffEvent",e)}}j.AudioSourceOffEvent=Mh;class Dh extends ct{constructor(e,t){super("AudioSourceErrorEvent",e,lo.EventType.Error),this.privError=t}get error(){return this.privError}}j.AudioSourceErrorEvent=Dh;class ni extends ct{constructor(e,t,n){super(e,t),this.privAudioNodeId=n}get audioNodeId(){return this.privAudioNodeId}}j.AudioStreamNodeEvent=ni;class kh extends ni{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}}j.AudioStreamNodeAttachingEvent=kh;class zh extends ni{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}}j.AudioStreamNodeAttachedEvent=zh;class Nh extends ni{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}}j.AudioStreamNodeDetachedEvent=Nh;class jh extends ni{constructor(e,t,n){super("AudioStreamNodeErrorEvent",e,t),this.privError=n}get error(){return this.privError}}j.AudioStreamNodeErrorEvent=jh;var B={};Object.defineProperty(B,"__esModule",{value:!0});B.ConnectionMessageSentEvent=B.ConnectionMessageReceivedEvent=B.ConnectionEstablishErrorEvent=B.ConnectionErrorEvent=B.ConnectionClosedEvent=B.ConnectionEstablishedEvent=B.ConnectionStartEvent=B.ConnectionEvent=B.ServiceEvent=void 0;const Ge=at;class Lh extends Ge.PlatformEvent{constructor(e,t,n=Ge.EventType.Info){super(e,n),this.privJsonResult=t}get jsonString(){return this.privJsonResult}}B.ServiceEvent=Lh;class Oe extends Ge.PlatformEvent{constructor(e,t,n=Ge.EventType.Info){super(e,n),this.privConnectionId=t}get connectionId(){return this.privConnectionId}}B.ConnectionEvent=Oe;class xh extends Oe{constructor(e,t,n){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=n}get uri(){return this.privUri}get headers(){return this.privHeaders}}B.ConnectionStartEvent=xh;class Bh extends Oe{constructor(e){super("ConnectionEstablishedEvent",e)}}B.ConnectionEstablishedEvent=Bh;class qh extends Oe{constructor(e,t,n){super("ConnectionClosedEvent",e,Ge.EventType.Debug),this.privReason=n,this.privStatusCode=t}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}B.ConnectionClosedEvent=qh;class Fh extends Oe{constructor(e,t,n){super("ConnectionErrorEvent",e,Ge.EventType.Debug),this.privMessage=t,this.privType=n}get message(){return this.privMessage}get type(){return this.privType}}B.ConnectionErrorEvent=Fh;class Uh extends Oe{constructor(e,t,n){super("ConnectionEstablishErrorEvent",e,Ge.EventType.Error),this.privStatusCode=t,this.privReason=n}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}B.ConnectionEstablishErrorEvent=Uh;class $h extends Oe{constructor(e,t,n){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=n}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}B.ConnectionMessageReceivedEvent=$h;class Wh extends Oe{constructor(e,t,n){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=n}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}B.ConnectionMessageSentEvent=Wh;var Ro={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.ObjectDisposedError=W.InvalidOperationError=W.ArgumentNullError=void 0;class Hh extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}W.ArgumentNullError=Hh;class Vh extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}W.InvalidOperationError=Vh;class Kh extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}}W.ObjectDisposedError=Kh;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectionMessage=r.MessageType=void 0;const e=W,t=ae;var n;(function(u){u[u.Text=0]="Text",u[u.Binary=1]="Binary"})(n=r.MessageType||(r.MessageType={}));class p{constructor(c,s,i,o){if(this.privBody=null,c===n.Text&&s&&typeof s!="string")throw new e.InvalidOperationError("Payload must be a string");if(c===n.Binary&&s&&!(s instanceof ArrayBuffer))throw new e.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=c,this.privBody=s,this.privHeaders=i||{},this.privId=o||t.createNoDashGuid(),this.messageType){case n.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case n.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===n.Binary)throw new e.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===n.Text)throw new e.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}r.ConnectionMessage=p})(Ro);var Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.ConnectionOpenResponse=void 0;class Jh{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}Bi.ConnectionOpenResponse=Jh;var qi={};Object.defineProperty(qi,"__esModule",{value:!0});qi.DeferralMap=void 0;class Gh{constructor(){this.privMap={}}add(e,t){this.privMap[e]=t}getId(e){return this.privMap[e]}complete(e,t){try{this.privMap[e].resolve(t)}catch(n){this.privMap[e].reject(n)}finally{this.privMap[e]=void 0}}}qi.DeferralMap=Gh;var Qe={};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.SendingAgentContextMessageEvent=Qe.DialogEvent=void 0;const os=at;class Kc extends os.PlatformEvent{constructor(e,t=os.EventType.Info){super(e,t)}}Qe.DialogEvent=Kc;class Qh extends Kc{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}Qe.SendingAgentContextMessageEvent=Qh;var Fi={},oi={};Object.defineProperty(oi,"__esModule",{value:!0});oi.EventSource=void 0;const Zh=W,Xh=ae;class Yh{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new Zh.ObjectDisposedError("EventSource");if(this.metadata)for(const t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(const t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)}attach(e){const t=Xh.createNoDashGuid();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(e){return this.attach(t=>e.onEvent(t))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(t=>e.onEvent(t)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}oi.EventSource=Yh;Object.defineProperty(Fi,"__esModule",{value:!0});Fi.Events=void 0;const el=W,tl=oi;class ei{static setEventSource(e){if(!e)throw new el.ArgumentNullError("eventSource");ei.privInstance=e}static get instance(){return ei.privInstance}}Fi.Events=ei;ei.privInstance=new tl.EventSource;var Jc={};Object.defineProperty(Jc,"__esModule",{value:!0});var Gc={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectionState=void 0,function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(r.ConnectionState||(r.ConnectionState={}))})(Gc);var Qc={};Object.defineProperty(Qc,"__esModule",{value:!0});var Zc={};Object.defineProperty(Zc,"__esModule",{value:!0});var Xc={};Object.defineProperty(Xc,"__esModule",{value:!0});var Yc={};Object.defineProperty(Yc,"__esModule",{value:!0});var eu={};Object.defineProperty(eu,"__esModule",{value:!0});var tu={};Object.defineProperty(tu,"__esModule",{value:!0});var ru={};Object.defineProperty(ru,"__esModule",{value:!0});var iu={};Object.defineProperty(iu,"__esModule",{value:!0});var si={};Object.defineProperty(si,"__esModule",{value:!0});si.List=void 0;const rl=W;class Ee{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),e===0?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();const n=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),n}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const e=Array();return this.privList.forEach(t=>{e.push(t)}),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)}select(e){this.throwIfDisposed();const t=[];for(let n=0;n<this.privList.length;n++)t.push(e(this.privList[n],n));return new Ee(t)}where(e){this.throwIfDisposed();const t=new Ee;for(let n=0;n<this.privList.length;n++)e(this.privList[n],n)&&t.add(this.privList[n]);return t}orderBy(e){this.throwIfDisposed();const n=this.toArray().sort(e);return new Ee(n)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy((t,n)=>e(n,t))}clone(){return this.throwIfDisposed(),new Ee(this.toArray())}concat(e){return this.throwIfDisposed(),new Ee(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new Ee(this.privList.concat(e))}isDisposed(){return this.privList==null}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new rl.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const t in e)t&&e[t]()}}si.List=Ee;var Po={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.marshalPromiseToCallbacks=r.Sink=r.Deferred=r.PromiseResultEventSource=r.PromiseResult=r.PromiseState=void 0;var e;(function(s){s[s.None=0]="None",s[s.Resolved=1]="Resolved",s[s.Rejected=2]="Rejected"})(e=r.PromiseState||(r.PromiseState={}));class t{constructor(i){this.throwIfError=()=>{if(this.isError)throw this.error},i.on(o=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=o)},o=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=o)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}r.PromiseResult=t;class n{constructor(){this.setResult=i=>{this.privOnSetResult(i)},this.setError=i=>{this.privOnSetError(i)},this.on=(i,o)=>{this.privOnSetResult=i,this.privOnSetError=o}}}r.PromiseResultEventSource=n;class p{constructor(){this.resolve=i=>(this.privResolve(i),this),this.reject=i=>(this.privReject(i),this),this.privPromise=new Promise((i,o)=>{this.privResolve=i,this.privReject=o})}get promise(){return this.privPromise}}r.Deferred=p;class u{constructor(){this.privState=e.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new n,this.privPromiseResult=new t(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(i){if(this.privState!==e.None)throw new Error("'Cannot resolve a completed promise'");this.privState=e.Resolved,this.privPromiseResultEvents.setResult(i);for(let o=0;o<this.privSuccessHandlers.length;o++)this.executeSuccessCallback(i,this.privSuccessHandlers[o],this.privErrorHandlers[o]);this.detachHandlers()}reject(i){if(this.privState!==e.None)throw new Error("'Cannot reject a completed promise'");this.privState=e.Rejected,this.privPromiseResultEvents.setError(i);for(const o of this.privErrorHandlers)this.executeErrorCallback(i,o);this.detachHandlers()}on(i,o){i==null&&(i=()=>{}),this.privState===e.None?(this.privSuccessHandlers.push(i),this.privErrorHandlers.push(o)):(this.privState===e.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,i,o):this.privState===e.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,o),this.detachHandlers())}executeSuccessCallback(i,o,a){try{o(i)}catch(h){this.executeErrorCallback(`'Unhandled callback error: ${h}'`,a)}}executeErrorCallback(i,o){if(o)try{o(i)}catch(a){throw new Error(`'Unhandled callback error: ${a}. InnerError: ${i}'`)}else throw new Error(`'Unhandled error: ${i}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}r.Sink=u;function c(s,i,o){s.then(a=>{try{i&&i(a)}catch(h){if(o)try{if(h instanceof Error){const d=h;o(d.name+": "+d.message)}else o(h)}catch{}}},a=>{if(o)try{if(a instanceof Error){const h=a;o(h.name+": "+h.message)}else o(a)}catch{}})}r.marshalPromiseToCallbacks=c})(Po);var ai={},ss=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(ai,"__esModule",{value:!0});ai.Queue=void 0;const Gn=W,Qn=si,as=Po;var Yr;(function(r){r[r.Dequeue=0]="Dequeue",r[r.Peek=1]="Peek"})(Yr||(Yr={}));class il{constructor(e){this.privPromiseStore=new Qn.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new Qn.List,this.privDetachables=[],this.privSubscribers=new Qn.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise(t=>t(e)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(t=>{this.privList.add(t)},()=>{})}dequeue(){this.throwIfDispose();const e=new as.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:Yr.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();const e=new as.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:Yr.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}drainAndDispose(e,t){return ss(this,void 0,void 0,function*(){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;const n=this.privSubscribers;if(n){for(;n.length()>0;)n.removeFirst().deferral.resolve(void 0);this.privSubscribers===n&&(this.privSubscribers=n)}for(const p of this.privDetachables)yield p.detach();if(this.privPromiseStore.length()>0&&e){const p=[];return this.privPromiseStore.toArray().forEach(u=>{p.push(u)}),Promise.all(p).finally(()=>{this.privSubscribers=null,this.privList.forEach(u=>{e(u)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}})}dispose(e){return ss(this,void 0,void 0,function*(){yield this.drainAndDispose(null,e)})}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){const n=e.removeFirst();if(n.type===Yr.Peek)n.deferral.resolve(t.first());else{const p=t.removeFirst();n.deferral.resolve(p)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new Gn.InvalidOperationError(this.privDisposeReason):new Gn.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new Gn.InvalidOperationError("Queue disposing")}}ai.Queue=il;var Ui={};Object.defineProperty(Ui,"__esModule",{value:!0});Ui.RawWebsocketMessage=void 0;const Si=Ro,ht=W,nl=ae;class ol{constructor(e,t,n){if(this.privPayload=null,!t)throw new ht.ArgumentNullError("payload");if(e===Si.MessageType.Binary&&t.__proto__.constructor.name!=="ArrayBuffer")throw new ht.InvalidOperationError("Payload must be ArrayBuffer");if(e===Si.MessageType.Text&&typeof t!="string")throw new ht.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=n||nl.createNoDashGuid()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===Si.MessageType.Binary)throw new ht.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===Si.MessageType.Text)throw new ht.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}}Ui.RawWebsocketMessage=ol;var $i={};Object.defineProperty($i,"__esModule",{value:!0});$i.RiffPcmEncoder=void 0;class sl{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){const t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;const n=t.length*2,p=new ArrayBuffer(n),u=new DataView(p);return this.floatTo16BitPCM(u,0,t),p}setString(e,t,n){for(let p=0;p<n.length;p++)e.setUint8(t+p,n.charCodeAt(p))}floatTo16BitPCM(e,t,n){for(let p=0;p<n.length;p++,t+=2){const u=Math.max(-1,Math.min(1,n[p]));e.setInt16(t,u<0?u*32768:u*32767,!0)}}downSampleAudioFrame(e,t,n){if(!e)return null;if(n===t||n>t)return e;const p=t/n,u=Math.round(e.length/p),c=new Float32Array(u);let s=0,i=0;for(;i<u;){const o=Math.round((i+1)*p);let a=0,h=0;for(;s<o&&s<e.length;)a+=e[s++],h++;c[i++]=a/h}return c}}$i.RiffPcmEncoder=sl;var Wi={},al=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.Stream=void 0;const cs=W,cl=ae,us=ai;class ul{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||cl.createNoDashGuid(),this.privReaderQueue=new us.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch{}}read(){if(this.privIsReadEnded)throw new cs.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(e=>al(this,void 0,void 0,function*(){return(e===void 0||e.isEnd)&&(yield this.privReaderQueue.dispose("End of stream reached")),e}))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new us.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new cs.InvalidOperationError("Stream closed")}}Wi.Stream=ul;var Hi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TranslationStatus=void 0,function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(r.TranslationStatus||(r.TranslationStatus={}))})(Hi);var lt={},ps;function pl(){if(ps)return lt;ps=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.ChunkedArrayBufferStream=void 0;const r=I();let e=class extends r.Stream{constructor(n,p){super(p),this.privTargetChunkSize=n,this.privNextBufferReadyBytes=0}writeStreamChunk(n){if(n.isEnd||this.privNextBufferReadyBytes===0&&n.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(n);return}let p=0;for(;p<n.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=n.timeReceived);const u=Math.min(n.buffer.byteLength-p,this.privTargetChunkSize-this.privNextBufferReadyBytes),c=new Uint8Array(this.privNextBufferToWrite),s=new Uint8Array(n.buffer.slice(p,u+p));c.set(s,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=u,p+=u,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};return lt.ChunkedArrayBufferStream=e,lt}var nu={};Object.defineProperty(nu,"__esModule",{value:!0});var Vi={};Object.defineProperty(Vi,"__esModule",{value:!0});Vi.Timeout=void 0;class Z{static load(){const e=new Map([[0,()=>{}]]),t=new Map,p="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),u=new Worker(p);return u.addEventListener("message",({data:i})=>{if(Z.isCallNotification(i)){const{params:{timerId:o}}=i,a=e.get(o);if(typeof a=="number"){const h=t.get(a);if(h===void 0||h!==o)throw new Error("The timer is in an undefined state.")}else if(typeof a<"u")a(),e.delete(o);else throw new Error("The timer is in an undefined state.")}else if(Z.isClearResponse(i)){const{id:o}=i,a=t.get(o);if(a===void 0)throw new Error("The timer is in an undefined state.");t.delete(o),e.delete(a)}else{const{error:{message:o}}=i;throw new Error(o)}}),{clearTimeout:i=>{const o=Math.random();t.set(o,i),e.set(i,o),u.postMessage({id:o,method:"clear",params:{timerId:i}})},setTimeout:(i,o)=>{const a=Math.random();return e.set(a,i),u.postMessage({id:null,method:"set",params:{delay:o,now:performance.now(),timerId:a}}),a}}}static loadWorkerTimers(){return()=>(Z.workerTimers!==null||(Z.workerTimers=Z.load()),Z.workerTimers)}static isCallNotification(e){return e.method!==void 0&&e.method==="call"}static isClearResponse(e){return e.error===null&&typeof e.id=="number"}}Vi.Timeout=Z;Z.workerTimers=null;Z.clearTimeout=r=>Z.timers().clearTimeout(r);Z.setTimeout=(r,e)=>Z.timers().setTimeout(r,e);Z.timers=Z.loadWorkerTimers();var k={};Object.defineProperty(k,"__esModule",{value:!0});k.OCSPCacheUpdateErrorEvent=k.OCSPResponseRetrievedEvent=k.OCSPCacheFetchErrorEvent=k.OCSPVerificationFailedEvent=k.OCSPCacheHitEvent=k.OCSPCacheEntryNeedsRefreshEvent=k.OCSPCacheEntryExpiredEvent=k.OCSPWSUpgradeStartedEvent=k.OCSPStapleReceivedEvent=k.OCSPCacheUpdateCompleteEvent=k.OCSPDiskCacheStoreEvent=k.OCSPMemoryCacheStoreEvent=k.OCSPCacheUpdateNeededEvent=k.OCSPDiskCacheHitEvent=k.OCSPCacheMissEvent=k.OCSPMemoryCacheHitEvent=k.OCSPEvent=void 0;const H=at;class V extends H.PlatformEvent{constructor(e,t,n){super(e,t),this.privSignature=n}}k.OCSPEvent=V;class dl extends V{constructor(e){super("OCSPMemoryCacheHitEvent",H.EventType.Debug,e)}}k.OCSPMemoryCacheHitEvent=dl;class hl extends V{constructor(e){super("OCSPCacheMissEvent",H.EventType.Debug,e)}}k.OCSPCacheMissEvent=hl;class ll extends V{constructor(e){super("OCSPDiskCacheHitEvent",H.EventType.Debug,e)}}k.OCSPDiskCacheHitEvent=ll;class vl extends V{constructor(e){super("OCSPCacheUpdateNeededEvent",H.EventType.Debug,e)}}k.OCSPCacheUpdateNeededEvent=vl;class fl extends V{constructor(e){super("OCSPMemoryCacheStoreEvent",H.EventType.Debug,e)}}k.OCSPMemoryCacheStoreEvent=fl;class gl extends V{constructor(e){super("OCSPDiskCacheStoreEvent",H.EventType.Debug,e)}}k.OCSPDiskCacheStoreEvent=gl;class ml extends V{constructor(e){super("OCSPCacheUpdateCompleteEvent",H.EventType.Debug,e)}}k.OCSPCacheUpdateCompleteEvent=ml;class Sl extends V{constructor(){super("OCSPStapleReceivedEvent",H.EventType.Debug,"")}}k.OCSPStapleReceivedEvent=Sl;class Cl extends V{constructor(e){super("OCSPWSUpgradeStartedEvent",H.EventType.Debug,e)}}k.OCSPWSUpgradeStartedEvent=Cl;class yl extends V{constructor(e,t){super("OCSPCacheEntryExpiredEvent",H.EventType.Debug,e),this.privExpireTime=t}}k.OCSPCacheEntryExpiredEvent=yl;class Rl extends V{constructor(e,t,n){super("OCSPCacheEntryNeedsRefreshEvent",H.EventType.Debug,e),this.privExpireTime=n,this.privStartTime=t}}k.OCSPCacheEntryNeedsRefreshEvent=Rl;class Pl extends V{constructor(e,t,n){super("OCSPCacheHitEvent",H.EventType.Debug,e),this.privExpireTime=n,this.privExpireTimeString=new Date(n).toLocaleDateString(),this.privStartTime=t,this.privStartTimeString=new Date(t).toLocaleTimeString()}}k.OCSPCacheHitEvent=Pl;class El extends V{constructor(e,t){super("OCSPVerificationFailedEvent",H.EventType.Debug,e),this.privError=t}}k.OCSPVerificationFailedEvent=El;class _l extends V{constructor(e,t){super("OCSPCacheFetchErrorEvent",H.EventType.Debug,e),this.privError=t}}k.OCSPCacheFetchErrorEvent=_l;class Il extends V{constructor(e){super("OCSPResponseRetrievedEvent",H.EventType.Debug,e)}}k.OCSPResponseRetrievedEvent=Il;class Tl extends V{constructor(e,t){super("OCSPCacheUpdateErrorEvent",H.EventType.Debug,e),this.privError=t}}k.OCSPCacheUpdateErrorEvent=Tl;var vt={},ds;function Al(){if(ds)return vt;ds=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.BackgroundEvent=void 0;const r=I();class e extends r.PlatformEvent{constructor(n){super("BackgroundEvent",r.EventType.Error),this.privError=n}get error(){return this.privError}}return vt.BackgroundEvent=e,vt}var hs;function I(){return hs||(hs=1,function(r){var e=C&&C.__createBinding||(Object.create?function(p,u,c,s){s===void 0&&(s=c),Object.defineProperty(p,s,{enumerable:!0,get:function(){return u[c]}})}:function(p,u,c,s){s===void 0&&(s=c),p[s]=u[c]}),t=C&&C.__exportStar||function(p,u){for(var c in p)c!=="default"&&!u.hasOwnProperty(c)&&e(u,p,c)};Object.defineProperty(r,"__esModule",{value:!0}),t(j,r),t(B,r),t(Ro,r),t(Bi,r),t(qi,r),t(Qe,r),t(W,r),t(Fi,r),t(oi,r),t(ae,r),t(Jc,r),t(Gc,r),t(Qc,r),t(Zc,r),t(Xc,r),t(Yc,r),t(eu,r),t(tu,r),t(ru,r),t(iu,r),t(si,r),t(at,r),t(Po,r),t(ai,r),t(Ui,r),t($i,r),t(Wi,r);var n=Hi;Object.defineProperty(r,"TranslationStatus",{enumerable:!0,get:function(){return n.TranslationStatus}}),t(pl(),r),t(nu,r),t(Vi,r),t(k,r),t(Al(),r)}(Wn)),Wn}var q={};Object.defineProperty(q,"__esModule",{value:!0});q.HeaderNames=void 0;class ue{}q.HeaderNames=ue;ue.AuthKey="Ocp-Apim-Subscription-Key";ue.Authorization="Authorization";ue.SpIDAuthKey="Apim-Subscription-Id";ue.ConnectionId="X-ConnectionId";ue.ContentType="Content-Type";ue.CustomCommandsAppId="X-CommandsAppId";ue.Path="Path";ue.RequestId="X-RequestId";ue.RequestStreamId="X-StreamId";ue.RequestTimestamp="X-Timestamp";var ut={};Object.defineProperty(ut,"__esModule",{value:!0});ut.AuthInfo=void 0;class wl{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}ut.AuthInfo=wl;Object.defineProperty(Ti,"__esModule",{value:!0});Ti.CognitiveSubscriptionKeyAuthentication=void 0;const bl=I(),Ol=q,Ml=ut;class Dl{constructor(e){if(!e)throw new bl.ArgumentNullError("subscriptionKey");this.privAuthInfo=new Ml.AuthInfo(Ol.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}Ti.CognitiveSubscriptionKeyAuthentication=Dl;var Ki={};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.CognitiveTokenAuthentication=void 0;const ls=I(),vs=ut,fs=q;class ti{constructor(e,t){if(!e)throw new ls.ArgumentNullError("fetchCallback");if(!t)throw new ls.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}fetch(e){return this.privFetchCallback(e).then(t=>new vs.AuthInfo(fs.HeaderNames.Authorization,t===void 0?void 0:ti.privTokenPrefix+t))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then(t=>new vs.AuthInfo(fs.HeaderNames.Authorization,t===void 0?void 0:ti.privTokenPrefix+t))}}Ki.CognitiveTokenAuthentication=ti;ti.privTokenPrefix="Bearer ";var ou={};Object.defineProperty(ou,"__esModule",{value:!0});var su={};Object.defineProperty(su,"__esModule",{value:!0});var ft={},Zn={},Ji={};const kl={},zl=Object.freeze(Object.defineProperty({__proto__:null,default:kl},Symbol.toStringTag,{value:"Module"})),Xe=Ad(zl);var Eo={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.LogLevel=void 0;const e=I();Object.defineProperty(r,"LogLevel",{enumerable:!0,get:function(){return e.EventType}})})(Eo);var T={};Object.defineProperty(T,"__esModule",{value:!0});T.Contracts=void 0;class _e{static throwIfNullOrUndefined(e,t){if(e==null)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(e===null)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(_e.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfNullOrTooLong(e,t,n){if(_e.throwIfNullOrUndefined(e,t),(""+e).length>n)throw new Error("throwIfNullOrTooLong:"+t+" (more than "+n.toString()+" characters)")}static throwIfNullOrTooShort(e,t,n){if(_e.throwIfNullOrUndefined(e,t),(""+e).length<n)throw new Error("throwIfNullOrTooShort:"+t+" (less than "+n.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(_e.throwIfNullOrUndefined(e,t),e.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(const n of e)_e.throwIfNullOrWhitespace(n,t)}static throwIfFileDoesNotExist(e,t){_e.throwIfNullOrWhitespace(e,t)}static throwIfNotUndefined(e,t){if(e!==void 0)throw new Error("throwIfNotUndefined:"+t)}}T.Contracts=_e;var Nl=C&&C.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),jl=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Ll=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.hasOwnProperty.call(r,t)&&Nl(e,r,t);return jl(e,r),e};Object.defineProperty(Ji,"__esModule",{value:!0});Ji.ConsoleLoggingListener=void 0;const gs=Ll(Xe),gt=Eo,xl=T;class Bl{constructor(e=gt.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){xl.Contracts.throwIfNullOrUndefined(gs.openSync,`
File System access not available`),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){const t=this.toString(e);if(this.privLogPath&&gs.writeFileSync(this.privLogPath,t+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case gt.LogLevel.Debug:console.debug(t);break;case gt.LogLevel.Info:console.info(t);break;case gt.LogLevel.Warning:console.warn(t);break;case gt.LogLevel.Error:console.error(t);break;default:console.log(t);break}}}toString(e){const t=[`${e.eventTime}`,`${e.name}`],n=e;for(const p in n)if(p&&e.hasOwnProperty(p)&&p!=="eventTime"&&p!=="eventType"&&p!=="eventId"&&p!=="name"&&p!=="constructor"){const u=n[p];let c="<NULL>";u!=null&&(typeof u=="number"||typeof u=="string"?c=u.toString():c=JSON.stringify(u)),t.push(`${p}: ${c}`)}return t.join(" | ")}}Ji.ConsoleLoggingListener=Bl;var au={};Object.defineProperty(au,"__esModule",{value:!0});var Xn={},Me={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.AudioStreamFormatImpl=r.AudioStreamFormat=r.AudioFormatTag=void 0;var e;(function(p){p[p.PCM=1]="PCM",p[p.MuLaw=2]="MuLaw",p[p.Siren=3]="Siren",p[p.MP3=4]="MP3",p[p.SILKSkype=5]="SILKSkype",p[p.OGG_OPUS=6]="OGG_OPUS",p[p.WEBM_OPUS=7]="WEBM_OPUS",p[p.ALaw=8]="ALaw",p[p.FLAC=9]="FLAC",p[p.OPUS=10]="OPUS"})(e=r.AudioFormatTag||(r.AudioFormatTag={}));class t{static getDefaultInputFormat(){return n.getDefaultInputFormat()}static getWaveFormat(u,c,s,i){return new n(u,c,s,i)}static getWaveFormatPCM(u,c,s){return new n(u,c,s)}}r.AudioStreamFormat=t;class n extends t{constructor(u=16e3,c=16,s=1,i=e.PCM){super();let o=!0;switch(i){case e.PCM:this.formatTag=1;break;case e.ALaw:this.formatTag=6;break;case e.MuLaw:this.formatTag=7;break;default:o=!1}if(this.bitsPerSample=c,this.samplesPerSec=u,this.channels=s,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),o){this.privHeader=new ArrayBuffer(44);const a=new DataView(this.privHeader);this.setString(a,0,"RIFF"),a.setUint32(4,0,!0),this.setString(a,8,"WAVEfmt "),a.setUint32(16,16,!0),a.setUint16(20,this.formatTag,!0),a.setUint16(22,this.channels,!0),a.setUint32(24,this.samplesPerSec,!0),a.setUint32(28,this.avgBytesPerSec,!0),a.setUint16(32,this.channels*(this.bitsPerSample/8),!0),a.setUint16(34,this.bitsPerSample,!0),this.setString(a,36,"data"),a.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new n}static getAudioContext(u){const c=window.AudioContext||window.webkitAudioContext||!1;if(c)return u!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new c({sampleRate:u}):new c;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(u,c,s){for(let i=0;i<s.length;i++)u.setUint8(c+i,s.charCodeAt(i))}}r.AudioStreamFormatImpl=n})(Me);var ms;function ql(){return ms||(ms=1,function(r){var e=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.MicAudioSource=r.AudioWorkletSourceURLPropertyName=void 0;const t=_(),n=I(),p=Me;r.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";class u{constructor(s,i,o,a){this.privRecorder=s,this.deviceId=i,this.privStreams={},this.privOutputChunkSize=u.AUDIOFORMAT.avgBytesPerSec/10,this.privId=o||n.createNoDashGuid(),this.privEvents=new n.EventSource,this.privMediaStream=a||null,this.privIsClosing=!1}get format(){return Promise.resolve(u.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new n.Deferred;try{this.createAudioContext()}catch(o){if(o instanceof Error){const a=o;this.privInitializeDeferral.reject(a.name+": "+a.message)}else this.privInitializeDeferral.reject(o);return this.privInitializeDeferral.promise}const s=window.navigator;let i=s.getUserMedia||s.webkitGetUserMedia||s.mozGetUserMedia||s.msGetUserMedia;if(s.mediaDevices&&(i=(o,a,h)=>{s.mediaDevices.getUserMedia(o).then(a).catch(h)}),i){const o=()=>{this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):i({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},a=>{this.privMediaStream=a,this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},a=>{const h=`Error occurred during microphone initialization: ${a}`;this.privInitializeDeferral.reject(h),this.onEvent(new n.AudioSourceErrorEvent(this.privId,h))})};this.privContext.state==="suspended"?this.privContext.resume().then(o).catch(a=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${a}`)}):o()}else{const o="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(o),this.onEvent(new n.AudioSourceErrorEvent(o,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(s){return this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,s)),this.listen(s).then(i=>(this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,s)),{detach:()=>e(this,void 0,void 0,function*(){return i.readEnded(),delete this.privStreams[s],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,s)),this.turnOff()}),id:()=>s,read:()=>i.read()}))}detach(s){s&&this.privStreams[s]&&(this.privStreams[s].close(),delete this.privStreams[s],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,s)))}turnOff(){return e(this,void 0,void 0,function*(){for(const s in this.privStreams)if(s){const i=this.privStreams[s];i&&i.close()}this.onEvent(new n.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(yield this.privInitializeDeferral,this.privInitializeDeferral=null),yield this.destroyAudioContext()})}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(s=>({bitspersample:u.AUDIOFORMAT.bitsPerSample,channelcount:u.AUDIOFORMAT.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:s,samplerate:u.AUDIOFORMAT.samplesPerSec,type:t.type.Microphones}))}setProperty(s,i){if(s===r.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(i);else throw new Error("Property '"+s+"' is not supported on Microphone.")}getMicrophoneLabel(){const s="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(s);this.privMicrophoneLabel=s;const i=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(i===void 0)return Promise.resolve(this.privMicrophoneLabel);const o=new n.Deferred;return navigator.mediaDevices.enumerateDevices().then(a=>{for(const h of a)if(h.deviceId===i){this.privMicrophoneLabel=h.label;break}o.resolve(this.privMicrophoneLabel)},()=>o.resolve(this.privMicrophoneLabel)),o.promise}listen(s){return e(this,void 0,void 0,function*(){yield this.turnOn();const i=new n.ChunkedArrayBufferStream(this.privOutputChunkSize,s);this.privStreams[s]=i;try{this.privRecorder.record(this.privContext,this.privMediaStream,i)}catch(a){throw this.onEvent(new n.AudioStreamNodeErrorEvent(this.privId,s,a)),a}return i})}onEvent(s){this.privEvents.onEvent(s),n.Events.instance.onEvent(s)}createAudioContext(){this.privContext||(this.privContext=p.AudioStreamFormatImpl.getAudioContext(u.AUDIOFORMAT.samplesPerSec))}destroyAudioContext(){return e(this,void 0,void 0,function*(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let s=!1;"close"in this.privContext&&(s=!0),s?this.privIsClosing||(this.privIsClosing=!0,yield this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&(yield this.privContext.suspend())})}}r.MicAudioSource=u,u.AUDIOFORMAT=p.AudioStreamFormat.getDefaultInputFormat()}(Xn)),Xn}var mt={},Ss;function Fl(){if(Ss)return mt;Ss=1;var r=C&&C.__awaiter||function(u,c,s,i){function o(a){return a instanceof s?a:new s(function(h){h(a)})}return new(s||(s=Promise))(function(a,h){function d(f){try{v(i.next(f))}catch(m){h(m)}}function l(f){try{v(i.throw(f))}catch(m){h(m)}}function v(f){f.done?a(f.value):o(f.value).then(d,l)}v((i=i.apply(u,c||[])).next())})};Object.defineProperty(mt,"__esModule",{value:!0}),mt.FileAudioSource=void 0;const e=_(),t=I(),n=Me;let p=class{constructor(c,s,i){this.privStreams={},this.privHeaderEnd=44,this.privId=i||t.createNoDashGuid(),this.privEvents=new t.EventSource,this.privSource=c,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=c.name:this.privFilename=s||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const c=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new t.AudioSourceErrorEvent(c,"")),Promise.reject(c)}this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}id(){return this.privId}attach(c){return r(this,void 0,void 0,function*(){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,c));const s=yield this.upload(c);return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,c)),Promise.resolve({detach:()=>r(this,void 0,void 0,function*(){s.readEnded(),delete this.privStreams[c],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,c)),yield this.turnOff()}),id:()=>c,read:()=>s.read()})})}detach(c){c&&this.privStreams[c]&&(this.privStreams[c].close(),delete this.privStreams[c],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,c)))}turnOff(){for(const c in this.privStreams)if(c){const s=this.privStreams[c];s&&!s.isClosed&&s.close()}return this.onEvent(new t.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(c=>Promise.resolve({bitspersample:c.bitsPerSample,channelcount:c.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:c.samplesPerSec,type:e.type.File}))}readHeader(){const s=this.privSource.slice(0,4296),i=new t.Deferred,o=a=>{const h=new DataView(a),d=S=>String.fromCharCode(h.getUint8(S),h.getUint8(S+1),h.getUint8(S+2),h.getUint8(S+3));if(d(0)!=="RIFF"){i.reject("Invalid WAV header in file, RIFF was not found");return}if(d(8)!=="WAVE"||d(12)!=="fmt "){i.reject("Invalid WAV header in file, WAVEfmt was not found");return}const l=h.getInt32(16,!0),v=h.getUint16(22,!0),f=h.getUint32(24,!0),m=h.getUint16(34,!0);let g=36+Math.max(l-16,0);for(;d(g)!=="data";g+=2)if(g>4288){i.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=g+8,i.resolve(n.AudioStreamFormat.getWaveFormatPCM(f,m,v))};if(typeof window<"u"&&typeof Blob<"u"&&s instanceof Blob){const a=new FileReader;a.onload=h=>{const d=h.target.result;o(d)},a.readAsArrayBuffer(s)}else{const a=s;o(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength))}return i.promise}upload(c){return r(this,void 0,void 0,function*(){const s=i=>{const o=`Error occurred while processing '${this.privFilename}'. ${i}`;throw this.onEvent(new t.AudioStreamNodeErrorEvent(this.privId,c,o)),new Error(o)};try{yield this.turnOn();const i=yield this.privAudioFormatPromise,o=new t.ChunkedArrayBufferStream(i.avgBytesPerSec/10,c);this.privStreams[c]=o;const a=this.privSource.slice(this.privHeaderEnd),h=d=>{o.isClosed||(o.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()}),o.close())};if(typeof window<"u"&&typeof Blob<"u"&&a instanceof Blob){const d=new FileReader;d.onerror=l=>s(l.toString()),d.onload=l=>{const v=l.target.result;h(v)},d.readAsArrayBuffer(a)}else{const d=a;h(d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength))}return o}catch(i){s(i)}})}onEvent(c){this.privEvents.onEvent(c),t.Events.instance.onEvent(c)}};return mt.FileAudioSource=p,mt}var Gi={};Object.defineProperty(Gi,"__esModule",{value:!0});Gi.PcmRecorder=void 0;const Ul=I();class $l{constructor(e){this.privStopInputOnRelease=e}record(e,t,n){const u=new Ul.RiffPcmEncoder(e.sampleRate,16e3),c=e.createMediaStreamSource(t),s=()=>{const o=(()=>{let a=0;try{return e.createScriptProcessor(a,1,1)}catch{a=2048;let d=e.sampleRate;for(;a<16384&&d>=32e3;)a<<=1,d>>=1;return e.createScriptProcessor(a,1,1)}})();o.onaudioprocess=a=>{const h=a.inputBuffer.getChannelData(0);if(n&&!n.isClosed){const d=u.encode(h);d&&n.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},c.connect(o),o.connect(e.destination),this.privMediaResources={scriptProcessorNode:o,source:c,stream:t}},i=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(e.audioWorklet&&!i){if(!this.privSpeechProcessorScript){const o=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,a=new Blob([o],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(a)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const o=new AudioWorkletNode(e,"speech-processor");o.port.onmessage=a=>{const h=a.data;if(n&&!n.isClosed){const d=u.encode(h);d&&n.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},c.connect(o),o.connect(e.destination),this.privMediaResources={scriptProcessorNode:o,source:c,stream:t}}).catch(()=>{s()})}else try{s()}catch(o){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${o}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(t=>t.stop()),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}Gi.PcmRecorder=$l;var Qi={},ci={},Wl=C&&C.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Hl=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),cu=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.hasOwnProperty.call(r,t)&&Wl(e,r,t);return Hl(e,r),e},Cs=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})},_o=C&&C.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ci,"__esModule",{value:!0});ci.WebsocketMessageAdapter=void 0;const Vl=cu(Xe),Kl=cu(Xe),Jl=_o(Xe),Gl=_o(Xe),Ql=_o(Xe),Zl=q,w=I();class ri{constructor(e,t,n,p,u,c){if(!e)throw new w.ArgumentNullError("uri");if(!n)throw new w.ArgumentNullError("messageFormatter");this.proxyInfo=p,this.privConnectionEvents=new w.EventSource,this.privConnectionId=t,this.privMessageFormatter=n,this.privConnectionState=w.ConnectionState.None,this.privUri=e,this.privHeaders=u,this.privEnableCompression=c,this.privHeaders[Zl.HeaderNames.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===w.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new w.Deferred,this.privCertificateValidatedDeferral=new w.Deferred,this.privConnectionState=w.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!ri.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{const e={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression};this.privCertificateValidatedDeferral.resolve(),e.agent=this.getAgent();let n=new URL(this.privUri).protocol;(n==null?void 0:n.toLocaleLowerCase())==="wss:"?n="https:":(n==null?void 0:n.toLocaleLowerCase())==="ws:"&&(n="http:"),e.agent.protocol=n,this.privWebsocketClient=new Ql.default(this.privUri,e)}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new w.Queue,this.privDisconnectDeferral=new w.Deferred,this.privSendMessageQueue=new w.Queue,this.processSendQueue().catch(e=>{w.Events.instance.onEvent(new w.BackgroundEvent(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new w.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new w.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=w.ConnectionState.Connected,this.onEvent(new w.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new w.ConnectionOpenResponse(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new w.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===w.ConnectionState.Connecting?(this.privConnectionState=w.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new w.ConnectionOpenResponse(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=w.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new w.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(t=>{w.Events.instance.onEvent(new w.BackgroundEvent(t))})},this.privWebsocketClient.onmessage=e=>{const t=new Date().toISOString();if(this.privConnectionState===w.ConnectionState.Connected){const n=new w.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(n.promise),e.data instanceof ArrayBuffer){const p=new w.RawWebsocketMessage(w.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(p).then(u=>{this.onEvent(new w.ConnectionMessageReceivedEvent(this.privConnectionId,t,u)),n.resolve(u)},u=>{n.reject(`Invalid binary message format. Error: ${u}`)})}else{const p=new w.RawWebsocketMessage(w.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(p).then(u=>{this.onEvent(new w.ConnectionMessageReceivedEvent(this.privConnectionId,t,u)),n.resolve(u)},u=>{n.reject(`Invalid text message format. Error: ${u}`)})}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==w.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${w.ConnectionState[this.privConnectionState]} state`);const t=new w.Deferred,n=new w.Deferred;return this.privSendMessageQueue.enqueueFromPromise(n.promise),this.privMessageFormatter.fromConnectionMessage(e).then(p=>{n.resolve({Message:e,RawWebsocketMessage:p,sendStatusDeferral:t})},p=>{n.reject(`Error formatting the message. ${p}`)}),t.promise}read(){return this.privConnectionState!==w.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){if(this.privWebsocketClient)this.privConnectionState!==w.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(!e)return Promise.resolve();if(this.onEvent(new w.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),e.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(e.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+new Error().stack);return Promise.resolve()}catch(t){return Promise.reject(`websocket send error: ${t}`)}}onClose(e,t){return Cs(this,void 0,void 0,function*(){const n=`Connection closed. ${e}: ${t}`;this.privConnectionState=w.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),yield this.privReceivingMessageQueue.drainAndDispose(()=>{},n),yield this.privSendMessageQueue.drainAndDispose(p=>{p.sendStatusDeferral.reject(n)},n)})}processSendQueue(){return Cs(this,void 0,void 0,function*(){for(;;){const t=yield this.privSendMessageQueue.dequeue();if(!t)return;try{yield this.sendRawMessage(t),t.sendStatusDeferral.resolve()}catch(n){t.sendStatusDeferral.reject(n)}}})}onEvent(e){this.privConnectionEvents.onEvent(e),w.Events.instance.onEvent(e)}getAgent(){const e=new Jl.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){const t={host:e.HostName,port:e.Port};return e.UserName?t.headers={"Proxy-Authentication":"Basic "+new Buffer(`${e.UserName}:${e.Password===void 0?"":e.Password}`).toString("base64")}:t.headers={},t.headers.requestOCSP="true",new Gl.default(t)}createConnection(e,t){let n;if(t=Object.assign(Object.assign({},t),{requestOCSP:!0,servername:t.host}),this.proxyInfo){const u=ri.GetProxyAgent(this.proxyInfo);n=new Promise((c,s)=>{u.callback(e,t,(i,o)=>{i?s(i):c(o)})})}else t.secureEndpoint?n=Promise.resolve(Kl.connect(t)):n=Promise.resolve(Vl.connect(t));return n}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}ci.WebsocketMessageAdapter=ri;ri.forceNpmWebSocket=!1;var Xl=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.WebsocketConnection=void 0;const Yn=I(),Yl=ci;class ev{constructor(e,t,n,p,u,c=!1,s){if(this.privIsDisposed=!1,!e)throw new Yn.ArgumentNullError("uri");if(!p)throw new Yn.ArgumentNullError("messageFormatter");this.privMessageFormatter=p;let i="",o=0;if(t){for(const a in t)if(a){i+=o===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(a);i+=h;let d=t[a];d&&(d=encodeURIComponent(d),i+=`=${d}`),o++}}if(n){for(const a in n)if(a){i+=o===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(n[a]);i+=`${a}=${h}`,o++}}this.privUri=e+i,this.privId=s||Yn.createNoDashGuid(),this.privConnectionMessageAdapter=new Yl.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,u,n,c)}dispose(){return Xl(this,void 0,void 0,function*(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&(yield this.privConnectionMessageAdapter.close())})}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}Qi.WebsocketConnection=ev;var Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.ReplayableAudioNode=void 0;class tv{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){const e=this.privReplayOffset-this.privBufferStartOffset;let t=Math.round(e*this.privBytesPerSecond*1e-7);t%2!==0&&t++;let n=0;for(;n<this.privBuffers.length&&t>=this.privBuffers[n].chunk.buffer.byteLength;)t-=this.privBuffers[n++].chunk.buffer.byteLength;if(n<this.privBuffers.length){const p=this.privBuffers[n].chunk.buffer.slice(t);return this.privReplayOffset+=p.byteLength/this.privBytesPerSecond*1e7,n===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:p,isEnd:!1,timeReceived:this.privBuffers[n].chunk.timeReceived})}}return this.privAudioNode.read().then(e=>(e&&e.buffer&&(this.privBuffers.push(new rv(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=e;const t=e-this.privBufferStartOffset;let n=Math.round(t*this.privBytesPerSecond*1e-7),p=0;for(;p<this.privBuffers.length&&n>=this.privBuffers[p].chunk.buffer.byteLength;)n-=this.privBuffers[p++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-n/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(p)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(const t of this.privBuffers){const n=t.byteOffset/this.privBytesPerSecond*1e7,p=n+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=n&&e<=p)return t.chunk.timeReceived}return 0}}Zi.ReplayableAudioNode=tv;class rv{constructor(e,t,n){this.chunk=e,this.serial=t,this.byteOffset=n}}var St={},eo={},ve={},ui={},iv=C&&C.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),nv=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ov=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.hasOwnProperty.call(r,t)&&iv(e,r,t);return nv(e,r),e};Object.defineProperty(ui,"__esModule",{value:!0});ui.AudioFileWriter=void 0;const Ct=ov(Xe),to=T;class sv{constructor(e){to.Contracts.throwIfNullOrUndefined(Ct.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=Ct.openSync(e,"w")}set format(e){to.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=Ct.createWriteStream("",{fd:this.privFd,start:t,autoClose:!1}))}write(e){to.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),Ct.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),Ct.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}}ui.AudioFileWriter=sv;var ne={},ys;function uu(){if(ys)return ne;ys=1;var r=C&&C.__awaiter||function(h,d,l,v){function f(m){return m instanceof l?m:new l(function(g){g(m)})}return new(l||(l=Promise))(function(m,g){function S(P){try{E(v.next(P))}catch(b){g(b)}}function y(P){try{E(v.throw(P))}catch(b){g(b)}}function E(P){P.done?m(P.value):f(P.value).then(S,y)}E((v=v.apply(h,d||[])).next())})};Object.defineProperty(ne,"__esModule",{value:!0}),ne.PullAudioInputStreamImpl=ne.PullAudioInputStream=ne.PushAudioInputStreamImpl=ne.PushAudioInputStream=ne.AudioInputStream=void 0;const e=_(),t=I(),n=ae,p=R(),u=Me;let c=class{constructor(){}static createPushStream(d){return s.create(d)}static createPullStream(d,l){return o.create(d,l)}};ne.AudioInputStream=c;class s extends c{static create(d){return new i(d)}}ne.PushAudioInputStream=s;class i extends s{constructor(d){super(),d===void 0?this.privFormat=u.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=d,this.privEvents=new t.EventSource,this.privId=n.createNoDashGuid(),this.privStream=new t.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(d){this.privStream.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}attach(d){return r(this,void 0,void 0,function*(){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,d)),yield this.turnOn();const l=this.privStream;return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,d)),{detach:()=>r(this,void 0,void 0,function*(){return this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,d)),this.turnOff()}),id:()=>d,read:()=>l.read()}})}detach(d){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,d))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(d){this.privEvents.onEvent(d),t.Events.instance.onEvent(d)}toBuffer(d){const l=Buffer.alloc(d.byteLength),v=new Uint8Array(d);for(let f=0;f<l.length;++f)l[f]=v[f];return l}}ne.PushAudioInputStreamImpl=i;class o extends c{constructor(){super()}static create(d,l){return new a(d,l)}}ne.PullAudioInputStream=o;class a extends o{constructor(d,l){super(),l===void 0?this.privFormat=p.AudioStreamFormat.getDefaultInputFormat():this.privFormat=l,this.privEvents=new t.EventSource,this.privId=n.createNoDashGuid(),this.privCallback=d,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}attach(d){return r(this,void 0,void 0,function*(){return this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,d)),yield this.turnOn(),this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,d)),{detach:()=>(this.privCallback.close(),this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,d)),this.turnOff()),id:()=>d,read:()=>{let l=0,v;for(;l<this.privBufferSize;){const f=new ArrayBuffer(this.privBufferSize-l),m=this.privCallback.read(f);if(v===void 0?v=f:new Int8Array(v).set(new Int8Array(f),l),m===0)break;l+=m}return Promise.resolve({buffer:v.slice(0,l),isEnd:this.privIsClosed||l===0,timeReceived:Date.now()})}}})}detach(d){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,d))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(d){this.privEvents.onEvent(d),t.Events.instance.onEvent(d)}}return ne.PullAudioInputStreamImpl=a,ne}var $={},De={},Io={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SpeechSynthesisOutputFormat=void 0,function(e){e[e.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",e[e.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",e[e.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",e[e.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",e[e.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",e[e.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",e[e.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",e[e.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",e[e.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",e[e.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",e[e.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",e[e.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",e[e.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",e[e.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",e[e.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",e[e.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",e[e.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",e[e.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",e[e.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",e[e.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",e[e.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",e[e.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",e[e.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",e[e.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",e[e.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",e[e.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",e[e.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",e[e.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",e[e.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",e[e.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",e[e.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",e[e.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",e[e.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",e[e.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",e[e.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",e[e.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",e[e.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm"}(r.SpeechSynthesisOutputFormat||(r.SpeechSynthesisOutputFormat={}))})(Io);Object.defineProperty(De,"__esModule",{value:!0});De.AudioOutputFormatImpl=void 0;const D=Io,M=Me;class A extends M.AudioStreamFormatImpl{constructor(e,t,n,p,u,c,s,i,o){super(n,c,t,e),this.formatTag=e,this.avgBytesPerSec=p,this.blockAlign=u,this.priAudioFormatString=s,this.priRequestAudioFormatString=i,this.priHasHeader=o}static fromSpeechSynthesisOutputFormat(e){return e===void 0?A.getDefaultOutputFormat():A.fromSpeechSynthesisOutputFormatString(A.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new A(M.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new A(M.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new A(M.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new A(M.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new A(M.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new A(M.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new A(M.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new A(M.AudioFormatTag.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new A(M.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new A(M.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new A(M.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new A(M.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new A(M.AudioFormatTag.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new A(M.AudioFormatTag.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new A(M.AudioFormatTag.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new A(M.AudioFormatTag.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new A(M.AudioFormatTag.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new A(M.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new A(M.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new A(M.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new A(M.AudioFormatTag.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);case"riff-16khz-16bit-mono-pcm":default:return new A(M.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return A.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){const t=new DataView(this.privHeader);t.setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);const t=new Uint8Array(e.byteLength+this.header.byteLength);return t.set(new Uint8Array(this.header),0),t.set(new Uint8Array(e),this.header.byteLength),t.buffer}}De.AudioOutputFormatImpl=A;A.SpeechSynthesisOutputFormatToString={[D.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[D.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[D.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[D.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[D.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[D.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[D.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[D.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[D.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[D.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[D.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[D.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[D.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[D.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[D.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[D.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[D.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[D.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[D.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[D.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm"};var av=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty($,"__esModule",{value:!0});$.PushAudioOutputStreamImpl=$.PushAudioOutputStream=$.PullAudioOutputStreamImpl=$.PullAudioOutputStream=$.AudioOutputStream=void 0;const vo=I(),cv=T,uv=De;class To{constructor(){}static createPullStream(){return Ao.create()}}$.AudioOutputStream=To;class Ao extends To{static create(){return new pu}}$.PullAudioOutputStream=Ao;class pu extends Ao{constructor(){super(),this.privId=vo.createNoDashGuid(),this.privStream=new vo.Stream}set format(e){e==null&&(this.privFormat=uv.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}read(e){return av(this,void 0,void 0,function*(){const t=new Int8Array(e);let n=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>e.byteLength)return t.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);t.set(this.privLastChunkView),n=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;n<e.byteLength&&!this.privStream.isReadEnded;){const p=yield this.privStream.read();if(p!==void 0&&!p.isEnd){let u;p.buffer.byteLength>e.byteLength-n?(u=p.buffer.slice(0,e.byteLength-n),this.privLastChunkView=new Int8Array(p.buffer.slice(e.byteLength-n))):u=p.buffer,t.set(new Int8Array(u),n),n+=u.byteLength}else this.privStream.readEnded()}return n})}write(e){cv.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}$.PullAudioOutputStreamImpl=pu;class du extends To{constructor(){super()}static create(e){return new hu(e)}}$.PushAudioOutputStream=du;class hu extends du{constructor(e){super(),this.privId=vo.createNoDashGuid(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}$.PushAudioOutputStreamImpl=hu;var Rs;function vu(){if(Rs)return ve;Rs=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.AudioOutputConfigImpl=ve.AudioConfigImpl=ve.AudioConfig=void 0;const r=F(),e=T,t=R(),n=ui,p=uu(),u=$;let c=class lu{static fromDefaultMicrophoneInput(){const a=new r.PcmRecorder(!0);return new s(new r.MicAudioSource(a))}static fromMicrophoneInput(a){const h=new r.PcmRecorder(!0);return new s(new r.MicAudioSource(h,a))}static fromWavFileInput(a,h="unnamedBuffer.wav"){return new s(new r.FileAudioSource(a,h))}static fromStreamInput(a){if(a instanceof t.PullAudioInputStreamCallback)return new s(new p.PullAudioInputStreamImpl(a));if(a instanceof t.AudioInputStream)return new s(a);if(typeof MediaStream<"u"&&a instanceof MediaStream){const h=new r.PcmRecorder(!1);return new s(new r.MicAudioSource(h,null,null,a))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new i(new t.SpeakerAudioDestination)}static fromSpeakerOutput(a){if(a===void 0)return lu.fromDefaultSpeakerOutput();if(a instanceof t.SpeakerAudioDestination)return new i(a);throw new Error("Not Supported Type")}static fromAudioFileOutput(a){return new i(new n.AudioFileWriter(a))}static fromStreamOutput(a){if(a instanceof t.PushAudioOutputStreamCallback)return new i(new u.PushAudioOutputStreamImpl(a));if(a instanceof t.PushAudioOutputStream)return new i(a);if(a instanceof t.PullAudioOutputStream)return new i(a);throw new Error("Not Supported Type")}};ve.AudioConfig=c;class s extends c{constructor(a){super(),this.privSource=a}get format(){return this.privSource.format}close(a,h){this.privSource.turnOff().then(()=>{a&&a()},d=>{h&&h(d)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(a){return this.privSource.attach(a)}detach(a){return this.privSource.detach(a)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(a,h){if(e.Contracts.throwIfNull(h,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(a,h);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(a,h){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(a,h);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}ve.AudioConfigImpl=s;class i extends c{constructor(a){super(),this.privDestination=a}set format(a){this.privDestination.format=a}write(a){this.privDestination.write(a)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}return ve.AudioOutputConfigImpl=i,ve}var fu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CancellationReason=void 0,function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(r.CancellationReason||(r.CancellationReason={}))})(fu);var Xi={};Object.defineProperty(Xi,"__esModule",{value:!0});Xi.PullAudioInputStreamCallback=void 0;class pv{}Xi.PullAudioInputStreamCallback=pv;var Yi={};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.PushAudioOutputStreamCallback=void 0;class dv{}Yi.PushAudioOutputStreamCallback=dv;var en={};Object.defineProperty(en,"__esModule",{value:!0});en.KeywordRecognitionModel=void 0;const Ps=T;class hv{constructor(){this.privDisposed=!1}static fromFile(e){throw Ps.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw Ps.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}en.KeywordRecognitionModel=hv;var tn={};Object.defineProperty(tn,"__esModule",{value:!0});tn.SessionEventArgs=void 0;class lv{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}tn.SessionEventArgs=lv;var yt={},Es;function vv(){if(Es)return yt;Es=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.RecognitionEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{constructor(n,p){super(p),this.privOffset=n}get offset(){return this.privOffset}};return yt.RecognitionEventArgs=e,yt}var gu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.OutputFormat=void 0,function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(r.OutputFormat||(r.OutputFormat={}))})(gu);var Rt={},_s;function fv(){if(_s)return Rt;_s=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.IntentRecognitionEventArgs=void 0;const r=R();let e=class extends r.RecognitionEventArgs{constructor(n,p,u){super(p,u),this.privResult=n}get result(){return this.privResult}};return Rt.IntentRecognitionEventArgs=e,Rt}var rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.RecognitionResult=void 0;class gv{constructor(e,t,n,p,u,c,s,i,o,a){this.privResultId=e,this.privReason=t,this.privText=n,this.privDuration=p,this.privOffset=u,this.privLanguage=c,this.privLanguageDetectionConfidence=s,this.privErrorDetails=i,this.privJson=o,this.privProperties=a}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}rn.RecognitionResult=gv;var Pt={},Is;function mv(){if(Is)return Pt;Is=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.SpeechRecognitionResult=void 0;const r=R();let e=class extends r.RecognitionResult{constructor(n,p,u,c,s,i,o,a,h,d,l){super(n,p,u,c,s,i,o,h,d,l),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}};return Pt.SpeechRecognitionResult=e,Pt}var Et={},Ts;function Sv(){if(Ts)return Et;Ts=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.IntentRecognitionResult=void 0;const r=R();let e=class extends r.SpeechRecognitionResult{constructor(n,p,u,c,s,i,o,a,h,d,l){super(p,u,c,s,i,o,a,void 0,h,d,l),this.privIntentId=n}get intentId(){return this.privIntentId}};return Et.IntentRecognitionResult=e,Et}var rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.LanguageUnderstandingModelImpl=rt.LanguageUnderstandingModel=void 0;const Ye=T;class mu{constructor(){}static fromEndpoint(e){Ye.Contracts.throwIfNull(e,"uri"),Ye.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");const t=new yi,n=e.host.indexOf(".");if(n===-1)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,n);const p=e.pathname.lastIndexOf("/")+1;if(p===-1)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(p),t.subscriptionKey=e.searchParams.get("subscription-key"),t.subscriptionKey===void 0)throw new Error("Could not determine subscription key from endpoint");return t}static fromAppId(e){Ye.Contracts.throwIfNullOrWhitespace(e,"appId");const t=new yi;return t.appId=e,t}static fromSubscription(e,t,n){Ye.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),Ye.Contracts.throwIfNullOrWhitespace(t,"appId"),Ye.Contracts.throwIfNullOrWhitespace(n,"region");const p=new yi;return p.appId=t,p.region=n,p.subscriptionKey=e,p}}rt.LanguageUnderstandingModel=mu;class yi extends mu{}rt.LanguageUnderstandingModelImpl=yi;var fe={},As;function Cv(){if(As)return fe;As=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.MeetingTranscriptionEventArgs=fe.ConversationTranscriptionEventArgs=fe.SpeechRecognitionEventArgs=void 0;const r=R();let e=class extends r.RecognitionEventArgs{constructor(u,c,s){super(c,s),this.privResult=u}get result(){return this.privResult}};fe.SpeechRecognitionEventArgs=e;class t extends r.RecognitionEventArgs{constructor(u,c,s){super(c,s),this.privResult=u}get result(){return this.privResult}}fe.ConversationTranscriptionEventArgs=t;class n extends e{}return fe.MeetingTranscriptionEventArgs=n,fe}var _t={},It={},ws;function pi(){if(ws)return It;ws=1,Object.defineProperty(It,"__esModule",{value:!0}),It.CancellationEventArgsBase=void 0;const r=R();let e=class extends r.RecognitionEventArgs{constructor(n,p,u,c,s){super(c,s),this.privReason=n,this.privErrorDetails=p,this.privErrorCode=u}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return It.CancellationEventArgsBase=e,It}var bs;function yv(){if(bs)return _t;bs=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.SpeechRecognitionCanceledEventArgs=void 0;const r=pi();let e=class extends r.CancellationEventArgsBase{};return _t.SpeechRecognitionCanceledEventArgs=e,_t}var Tt={},Os;function Rv(){if(Os)return Tt;Os=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.TranslationRecognitionEventArgs=void 0;const r=R();let e=class extends r.RecognitionEventArgs{constructor(n,p,u){super(p,u),this.privResult=n}get result(){return this.privResult}};return Tt.TranslationRecognitionEventArgs=e,Tt}var At={},Ms;function Pv(){if(Ms)return At;Ms=1,Object.defineProperty(At,"__esModule",{value:!0}),At.TranslationSynthesisEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{constructor(n,p){super(p),this.privResult=n}get result(){return this.privResult}};return At.TranslationSynthesisEventArgs=e,At}var wt={},Ds;function Cu(){if(Ds)return wt;Ds=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.TranslationRecognitionResult=void 0;const r=R();let e=class Su extends r.SpeechRecognitionResult{constructor(n,p,u,c,s,i,o,a,h,d,l){super(p,u,c,s,i,o,a,void 0,h,d,l),this.privTranslations=n}static fromSpeechRecognitionResult(n){return new Su(void 0,n.resultId,n.reason,n.text,n.duration,n.offset,n.language,n.languageDetectionConfidence,n.errorDetails,n.json,n.properties)}get translations(){return this.privTranslations}};return wt.TranslationRecognitionResult=e,wt}var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.TranslationSynthesisResult=void 0;class Ev{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}}nn.TranslationSynthesisResult=Ev;var yu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ResultReason=void 0,function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizedKeyword=4]="RecognizedKeyword",e[e.RecognizingIntent=5]="RecognizingIntent",e[e.RecognizedIntent=6]="RecognizedIntent",e[e.TranslatingSpeech=7]="TranslatingSpeech",e[e.TranslatedSpeech=8]="TranslatedSpeech",e[e.SynthesizingAudio=9]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",e[e.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",e[e.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",e[e.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",e[e.RecognizedSpeakers=14]="RecognizedSpeakers",e[e.RecognizedSpeaker=15]="RecognizedSpeaker",e[e.ResetVoiceProfile=16]="ResetVoiceProfile",e[e.DeletedVoiceProfile=17]="DeletedVoiceProfile",e[e.VoicesListRetrieved=18]="VoicesListRetrieved",e[e.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",e[e.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",e[e.TranslatedInstantMessage=21]="TranslatedInstantMessage",e[e.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"}(r.ResultReason||(r.ResultReason={}))})(yu);var ke={},ks;function _v(){if(ks)return ke;ks=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.SpeechConfigImpl=ke.SpeechConfig=void 0;const r=_(),e=T,t=R();let n=class{constructor(){}static fromSubscription(c,s){e.Contracts.throwIfNullOrWhitespace(c,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(s,"region");const i=new p;return i.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i.setProperty(t.PropertyId.SpeechServiceConnection_IntentRegion,s),i.setProperty(t.PropertyId.SpeechServiceConnection_Key,c),i}static fromEndpoint(c,s){e.Contracts.throwIfNull(c,"endpoint");const i=new p;return i.setProperty(t.PropertyId.SpeechServiceConnection_Endpoint,c.href),s!==void 0&&i.setProperty(t.PropertyId.SpeechServiceConnection_Key,s),i}static fromHost(c,s){e.Contracts.throwIfNull(c,"hostName");const i=new p;return i.setProperty(t.PropertyId.SpeechServiceConnection_Host,c.protocol+"//"+c.hostname+(c.port===""?"":":"+c.port)),s!==void 0&&i.setProperty(t.PropertyId.SpeechServiceConnection_Key,s),i}static fromAuthorizationToken(c,s){e.Contracts.throwIfNull(c,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(s,"region");const i=new p;return i.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i.setProperty(t.PropertyId.SpeechServiceConnection_IntentRegion,s),i.authorizationToken=c,i}close(){}};ke.SpeechConfig=n;class p extends n{constructor(){super(),this.privProperties=new t.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=t.OutputFormat.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceAuthorization_Token,c)}get speechRecognitionLanguage(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,c)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,c)}get outputFormat(){return t.OutputFormat[this.privProperties.getProperty(r.OutputFormatPropertyName,void 0)]}set outputFormat(c){this.privProperties.setProperty(r.OutputFormatPropertyName,t.OutputFormat[c])}get endpointId(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_EndpointId,c)}setProperty(c,s){e.Contracts.throwIfNull(s,"value"),this.privProperties.setProperty(c,s)}getProperty(c,s){return this.privProperties.getProperty(c,s)}setProxy(c,s,i,o){this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyHostName],c),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyPort],s),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyPassword],o)}setServiceProperty(c,s){const i=JSON.parse(this.privProperties.getProperty(r.ServicePropertiesPropertyName,"{}"));i[c]=s,this.privProperties.setProperty(r.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceResponse_ProfanityOption,t.ProfanityOption[c])}enableAudioLogging(){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(r.ForceDictationPropertyName,"true")}clone(){const c=new p;return c.privProperties=this.privProperties.clone(),c}get speechSynthesisLanguage(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthLanguage,c)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthVoice,c)}get speechSynthesisOutputFormat(){return t.SpeechSynthesisOutputFormat[this.privProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(c){this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthOutputFormat,t.SpeechSynthesisOutputFormat[c])}}return ke.SpeechConfigImpl=p,ke}var ze={},zs;function Iv(){if(zs)return ze;zs=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.SpeechTranslationConfigImpl=ze.SpeechTranslationConfig=void 0;const r=_(),e=T,t=R();let n=class extends t.SpeechConfig{constructor(){super()}static fromSubscription(c,s){e.Contracts.throwIfNullOrWhitespace(c,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(s,"region");const i=new p;return i.properties.setProperty(t.PropertyId.SpeechServiceConnection_Key,c),i.properties.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i}static fromAuthorizationToken(c,s){e.Contracts.throwIfNullOrWhitespace(c,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(s,"region");const i=new p;return i.properties.setProperty(t.PropertyId.SpeechServiceAuthorization_Token,c),i.properties.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i}static fromHost(c,s){e.Contracts.throwIfNull(c,"hostName");const i=new p;return i.setProperty(t.PropertyId.SpeechServiceConnection_Host,c.protocol+"//"+c.hostname+(c.port===""?"":":"+c.port)),s!==void 0&&i.setProperty(t.PropertyId.SpeechServiceConnection_Key,s),i}static fromEndpoint(c,s){e.Contracts.throwIfNull(c,"endpoint"),e.Contracts.throwIfNull(s,"subscriptionKey");const i=new p;return i.properties.setProperty(t.PropertyId.SpeechServiceConnection_Endpoint,c.href),i.properties.setProperty(t.PropertyId.SpeechServiceConnection_Key,s),i}};ze.SpeechTranslationConfig=n;class p extends n{constructor(){super(),this.privSpeechProperties=new t.PropertyCollection,this.outputFormat=t.OutputFormat.Simple}set authorizationToken(c){e.Contracts.throwIfNullOrWhitespace(c,"value"),this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceAuthorization_Token,c)}set speechRecognitionLanguage(c){e.Contracts.throwIfNullOrWhitespace(c,"value"),this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,c)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return t.OutputFormat[this.privSpeechProperties.getProperty(r.OutputFormatPropertyName,void 0)]}set outputFormat(c){this.privSpeechProperties.setProperty(r.OutputFormatPropertyName,t.OutputFormat[c])}get endpointId(){return this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(c){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_EndpointId,c)}addTargetLanguage(c){e.Contracts.throwIfNullOrWhitespace(c,"value");const s=this.targetLanguages;s.includes(c)||(s.push(c),this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_TranslationToLanguages,s.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(c){e.Contracts.throwIfNullOrWhitespace(c,"value"),this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_TranslationVoice,c)}get region(){return this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_Region)}setProxy(c,s,i,o){this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyHostName],c),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyPort],s),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(t.PropertyId[t.PropertyId.SpeechServiceConnection_ProxyPassword],o)}getProperty(c,s){return this.privSpeechProperties.getProperty(c,s)}setProperty(c,s){this.privSpeechProperties.setProperty(c,s)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(c,s){const i=JSON.parse(this.privSpeechProperties.getProperty(r.ServicePropertiesPropertyName,"{}"));i[c]=s,this.privSpeechProperties.setProperty(r.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(c){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceResponse_ProfanityOption,t.ProfanityOption[c])}enableAudioLogging(){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(r.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(c){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthLanguage,c)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(c){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthVoice,c)}get speechSynthesisOutputFormat(){return t.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(t.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(c){this.privSpeechProperties.setProperty(t.PropertyId.SpeechServiceConnection_SynthOutputFormat,t.SpeechSynthesisOutputFormat[c])}}return ze.SpeechTranslationConfigImpl=p,ze}var bt={},Ns;function Pu(){if(Ns)return bt;Ns=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.PropertyCollection=void 0;const r=R();let e=class Ru{constructor(){this.privKeys=[],this.privValues=[]}getProperty(n,p){let u;typeof n=="string"?u=n:u=r.PropertyId[n];for(let c=0;c<this.privKeys.length;c++)if(this.privKeys[c]===u)return this.privValues[c];if(p!==void 0)return String(p)}setProperty(n,p){let u;typeof n=="string"?u=n:u=r.PropertyId[n];for(let c=0;c<this.privKeys.length;c++)if(this.privKeys[c]===u){this.privValues[c]=p;return}this.privKeys.push(u),this.privValues.push(p)}clone(){const n=new Ru;for(let p=0;p<this.privKeys.length;p++)n.privKeys.push(this.privKeys[p]),n.privValues.push(this.privValues[p]);return n}mergeTo(n){this.privKeys.forEach(p=>{if(n.getProperty(p,void 0)===void 0){const u=this.getProperty(p);n.setProperty(p,u)}})}get keys(){return this.privKeys}};return bt.PropertyCollection=e,bt}var on={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PropertyId=void 0,function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",e[e.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",e[e.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=25]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceConnection_LanguageIdMode=34]="SpeechServiceConnection_LanguageIdMode",e[e.SpeechServiceConnection_RecognitionEndpointVersion=35]="SpeechServiceConnection_RecognitionEndpointVersion",e[e.SpeechServiceConnection_SpeakerIdMode=36]="SpeechServiceConnection_SpeakerIdMode",e[e.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",e[e.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",e[e.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",e[e.Conversation_ApplicationId=46]="Conversation_ApplicationId",e[e.Conversation_DialogType=47]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=49]="Conversation_From_Id",e[e.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",e[e.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",e[e.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",e[e.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",e[e.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",e[e.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=56]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=57]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=59]="ConversationTranslator_Token",e[e.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",e[e.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",e[e.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",e[e.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",e[e.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",e[e.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",e[e.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version",e[e.WebWorkerLoadType=67]="WebWorkerLoadType",e[e.TalkingAvatarService_WebRTC_SDP=68]="TalkingAvatarService_WebRTC_SDP"}(r.PropertyId||(r.PropertyId={}))})(on);var Ot={},js;function Tv(){if(js)return Ot;js=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.Recognizer=void 0;const e=_(),t=I(),n=T,p=R();let u=class Eu{constructor(s,i,o){this.audioConfig=s!==void 0?s:p.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=i.clone(),this.privConnectionFactory=o,this.implCommonRecognizerSetup()}close(s,i){n.Contracts.throwIfDisposed(this.privDisposed),t.marshalPromiseToCallbacks(this.dispose(!0),s,i)}get internalData(){return this.privReco}dispose(s){return r(this,void 0,void 0,function*(){this.privDisposed||(this.privDisposed=!0,s&&this.privReco&&(yield this.privReco.audioSource.turnOff(),yield this.privReco.dispose()))})}static get telemetryEnabled(){return e.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(s){e.ServiceRecognizerBase.telemetryDataEnabled=s}implCommonRecognizerSetup(){let s=typeof window<"u"?"Browser":"Node",i="unknown",o="unknown";typeof navigator<"u"&&(s=s+"/"+navigator.platform,i=navigator.userAgent,o=navigator.appVersion);const a=this.createRecognizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(s,i,o))));this.privReco=this.createServiceRecognizer(Eu.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,a)}recognizeOnceAsyncImpl(s){return r(this,void 0,void 0,function*(){n.Contracts.throwIfDisposed(this.privDisposed);const i=new t.Deferred;yield this.implRecognizerStop(),yield this.privReco.recognize(s,i.resolve,i.reject);const o=yield i.promise;return yield this.implRecognizerStop(),o})}startContinuousRecognitionAsyncImpl(s){return r(this,void 0,void 0,function*(){n.Contracts.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop(),yield this.privReco.recognize(s,void 0,void 0)})}stopContinuousRecognitionAsyncImpl(){return r(this,void 0,void 0,function*(){n.Contracts.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop()})}implRecognizerStop(){return r(this,void 0,void 0,function*(){this.privReco&&(yield this.privReco.stopRecognizing())})}static getAuthFromProperties(s){const i=s.getProperty(p.PropertyId.SpeechServiceConnection_Key,void 0);return i&&i!==""?new e.CognitiveSubscriptionKeyAuthentication(i):new e.CognitiveTokenAuthentication(()=>{const a=s.getProperty(p.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(a)},()=>{const a=s.getProperty(p.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(a)})}};return Ot.Recognizer=u,Ot}var Mt={},Ls;function Av(){if(Ls)return Mt;Ls=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.SpeechRecognizer=void 0;const e=_(),t=I(),n=T,p=R();let u=class _u extends p.Recognizer{constructor(s,i){const o=s;n.Contracts.throwIfNull(o,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(o.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage),p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage]),super(i,o.properties,new e.SpeechConnectionFactory),this.privDisposedRecognizer=!1}static FromConfig(s,i,o){const a=s;return i.properties.mergeTo(a.properties),new _u(s,o)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){n.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,s)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,p.OutputFormat[p.OutputFormat.Simple])===p.OutputFormat[p.OutputFormat.Simple]?p.OutputFormat.Simple:p.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(s,i){t.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(e.RecognitionMode.Interactive),s,i)}startContinuousRecognitionAsync(s,i){t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(e.RecognitionMode.Conversation),s,i)}stopContinuousRecognitionAsync(s,i){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),s,i)}startKeywordRecognitionAsync(s,i,o){n.Contracts.throwIfNull(s,"model"),o&&o("Not yet implemented.")}stopKeywordRecognitionAsync(s){s&&s()}close(s,i){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),t.marshalPromiseToCallbacks(this.dispose(!0),s,i)}dispose(s){const i=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedRecognizer||(s&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield i.dispose.call(this,s))})}createRecognizerConfig(s){return new e.RecognizerConfig(s,this.privProperties)}createServiceRecognizer(s,i,o,a){const h=o;return new e.SpeechServiceRecognizer(s,i,h,a,this)}};return Mt.SpeechRecognizer=u,Mt}var Dt={},xs;function wv(){if(xs)return Dt;xs=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.IntentRecognizer=void 0;const e=_(),t=I(),n=T,p=R();let u=class extends p.Recognizer{constructor(s,i){n.Contracts.throwIfNullOrUndefined(s,"speechConfig");const o=s;n.Contracts.throwIfNullOrUndefined(o,"speechConfig"),super(i,o.properties,new e.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=o.properties,n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage),p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,s)}get properties(){return this.privProperties}recognizeOnceAsync(s,i){if(n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const o=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",o.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(o.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}t.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(e.RecognitionMode.Interactive),s,i)}startContinuousRecognitionAsync(s,i){if(Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const o=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",o.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(o.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(e.RecognitionMode.Conversation),s,i)}stopContinuousRecognitionAsync(s,i){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),s,i)}startKeywordRecognitionAsync(s,i,o){n.Contracts.throwIfNull(s,"model"),o&&o("Not yet implemented.")}stopKeywordRecognitionAsync(s,i){if(s)try{s()}catch(o){i&&i(o)}}addIntent(s,i){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(i,"intentId"),n.Contracts.throwIfNullOrWhitespace(s,"simplePhrase"),this.privAddedIntents.push([i,s])}addIntentWithLanguageModel(s,i,o){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(s,"intentId"),n.Contracts.throwIfNull(i,"model");const a=i;n.Contracts.throwIfNullOrWhitespace(a.appId,"model.appId"),this.privAddedLmIntents[s]=new e.AddedLmIntent(a,o)}addAllIntents(s,i){n.Contracts.throwIfNull(s,"model");const o=s;n.Contracts.throwIfNullOrWhitespace(o.appId,"model.appId"),this.privUmbrellaIntent=new e.AddedLmIntent(o,i)}close(s,i){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),t.marshalPromiseToCallbacks(this.dispose(!0),s,i)}createRecognizerConfig(s){return new e.RecognizerConfig(s,this.privProperties)}createServiceRecognizer(s,i,o,a){const h=o;return new e.IntentServiceRecognizer(s,i,h,a,this)}dispose(s){const i=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedIntentRecognizer||s&&(this.privDisposedIntentRecognizer=!0,yield i.dispose.call(this,s))})}buildSpeechContext(){let s,i,o;const a=[];this.privUmbrellaIntent!==void 0&&(s=this.privUmbrellaIntent.modelImpl.appId,i=this.privUmbrellaIntent.modelImpl.region,o=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const h of Object.keys(this.privAddedLmIntents)){const d=this.privAddedLmIntents[h];if(s===void 0)s=d.modelImpl.appId;else if(s!==d.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(i===void 0)i=d.modelImpl.region;else if(i!==d.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(o===void 0)o=d.modelImpl.subscriptionKey;else if(o!==d.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const l="luis/"+s+"-PRODUCTION#"+h;a.push(l)}return{Intent:{id:s,key:o===void 0?this.privProperties.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_Key]):o,provider:"LUIS"},ReferenceGrammars:this.privUmbrellaIntent===void 0?a:["luis/"+s+"-PRODUCTION"]}}};return Dt.IntentRecognizer=u,Dt}var Iu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.VoiceProfileType=void 0,function(e){e[e.TextIndependentIdentification=0]="TextIndependentIdentification",e[e.TextDependentVerification=1]="TextDependentVerification",e[e.TextIndependentVerification=2]="TextIndependentVerification"}(r.VoiceProfileType||(r.VoiceProfileType={}))})(Iu);var kt={},zt={},Ne={},Bs;function Tu(){if(Bs)return Ne;Bs=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.ConnectionMessageImpl=Ne.ConnectionMessage=void 0;const r=q,e=I(),t=Pu(),n=on;let p=class{};Ne.ConnectionMessage=p;class u{constructor(s){this.privConnectionMessage=s,this.privProperties=new t.PropertyCollection,this.privConnectionMessage.headers[r.HeaderNames.ConnectionId]&&this.privProperties.setProperty(n.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[r.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(i=>{this.privProperties.setProperty(i,this.privConnectionMessage.headers[i])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(s=>s.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===e.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===e.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}return Ne.ConnectionMessageImpl=u,Ne}var qs;function Au(){if(qs)return zt;qs=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Connection=void 0;const r=_(),e=I(),t=Tu(),n=T,p=R();let u=class fo{static fromRecognizer(s){const i=s.internalData,o=new fo;return o.privInternalData=i,o.setupEvents(),o}static fromSynthesizer(s){const i=s.internalData,o=new fo;return o.privInternalData=i,o.setupEvents(),o}openConnection(s,i){e.marshalPromiseToCallbacks(this.privInternalData.connect(),s,i)}closeConnection(s,i){if(this.privInternalData instanceof r.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");e.marshalPromiseToCallbacks(this.privInternalData.disconnect(),s,i)}setMessageProperty(s,i,o){if(n.Contracts.throwIfNullOrWhitespace(i,"propertyName"),this.privInternalData instanceof r.ServiceRecognizerBase){if(s.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");this.privInternalData.speechContext.setSection(i,o)}else if(this.privInternalData instanceof r.SynthesisAdapterBase){if(s.toLowerCase()!=="synthesis.context")throw new Error("Only synthesis.context message property sets are currently supported for synthesizer");this.privInternalData.synthesisContext.setSection(i,o)}}sendMessageAsync(s,i,o,a){e.marshalPromiseToCallbacks(this.privInternalData.sendNetworkMessage(s,i),o,a)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(s=>{s.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new p.ConnectionEventArgs(s.connectionId)):s.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new p.ConnectionEventArgs(s.connectionId)):s.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new p.ConnectionMessageEventArgs(new t.ConnectionMessageImpl(s.message))):s.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new p.ConnectionMessageEventArgs(new t.ConnectionMessageImpl(s.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(s=>{this.receivedServiceMessage&&this.receivedServiceMessage(new p.ServiceEventArgs(s.jsonString,s.name))})}};return zt.Connection=u,zt}var Fs;function bv(){if(Fs)return kt;Fs=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(kt,"__esModule",{value:!0}),kt.TranslationRecognizer=void 0;const e=_(),t=I(),n=Au(),p=T,u=R();let c=class wu extends u.Recognizer{constructor(i,o,a){const h=i;p.Contracts.throwIfNull(h,"speechConfig"),super(o,h.properties,a||new e.TranslationConnectionFactory),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&p.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationVoice),u.PropertyId[u.PropertyId.SpeechServiceConnection_TranslationVoice]),p.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages),u.PropertyId[u.PropertyId.SpeechServiceConnection_TranslationToLanguages]),p.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage),u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(i,o,a){const h=i;return o.properties.mergeTo(h.properties),new wu(i,a)}get speechRecognitionLanguage(){return p.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return p.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return p.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(i){this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,i)}recognizeOnceAsync(i,o){p.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),t.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(e.RecognitionMode.Interactive),i,o)}startContinuousRecognitionAsync(i,o){t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(e.RecognitionMode.Conversation),i,o)}stopContinuousRecognitionAsync(i,o){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),i,o)}removeTargetLanguage(i){if(p.Contracts.throwIfNullOrUndefined(i,"language to be removed"),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){const o=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),a=o.indexOf(i);a>-1&&(o.splice(a,1),this.properties.setProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages,o.join(",")),this.updateLanguages(o))}}addTargetLanguage(i){p.Contracts.throwIfNullOrUndefined(i,"language to be added");let o=[];this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(o=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),o.includes(i)||(o.push(i),this.properties.setProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages,o.join(",")))):(this.properties.setProperty(u.PropertyId.SpeechServiceConnection_TranslationToLanguages,i),o=[i]),this.updateLanguages(o)}close(i,o){p.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),t.marshalPromiseToCallbacks(this.dispose(!0),i,o)}onConnection(){}dispose(i){const o=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,i&&(yield this.implRecognizerStop(),yield o.dispose.call(this,i)))})}createRecognizerConfig(i){return new e.RecognizerConfig(i,this.privProperties)}createServiceRecognizer(i,o,a,h){const d=a;return new e.TranslationServiceRecognizer(i,o,d,h,this)}updateLanguages(i){const o=n.Connection.fromRecognizer(this);o&&(o.setMessageProperty("speech.context","translationcontext",{to:i}),o.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:i})))}};return kt.TranslationRecognizer=c,kt}var Nt={},Us;function Ov(){if(Us)return Nt;Us=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.Translations=void 0;const r=R();let e=class{constructor(){this.privMap=new r.PropertyCollection}get languages(){return this.privMap.keys}get(n,p){return this.privMap.getProperty(n,p)}set(n,p){this.privMap.setProperty(n,p)}};return Nt.Translations=e,Nt}var bu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.NoMatchReason=void 0,function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(r.NoMatchReason||(r.NoMatchReason={}))})(bu);var jt={},$s;function Mv(){if($s)return jt;$s=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.NoMatchDetails=void 0;const r=_(),e=R();let t=class Ou{constructor(p){this.privReason=p}static fromResult(p){const u=r.SimpleSpeechPhrase.fromJSON(p.json);let c=e.NoMatchReason.NotRecognized;switch(u.RecognitionStatus){case r.RecognitionStatus.BabbleTimeout:c=e.NoMatchReason.InitialBabbleTimeout;break;case r.RecognitionStatus.InitialSilenceTimeout:c=e.NoMatchReason.InitialSilenceTimeout;break;default:c=e.NoMatchReason.NotRecognized;break}return new Ou(c)}get reason(){return this.privReason}};return jt.NoMatchDetails=t,jt}var sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.TranslationRecognitionCanceledEventArgs=void 0;class Dv{constructor(e,t,n,p,u){this.privCancelReason=t,this.privErrorDetails=n,this.privResult=u,this.privSessionId=e,this.privErrorCode=p}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}sn.TranslationRecognitionCanceledEventArgs=Dv;var Lt={},Ws;function kv(){if(Ws)return Lt;Ws=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.IntentRecognitionCanceledEventArgs=void 0;const r=R();let e=class extends r.IntentRecognitionEventArgs{constructor(n,p,u,c,s,i){super(c,s,i),this.privReason=n,this.privErrorDetails=p,this.privErrorCode=u}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return Lt.IntentRecognitionCanceledEventArgs=e,Lt}var di={};Object.defineProperty(di,"__esModule",{value:!0});di.CancellationDetailsBase=void 0;class zv{constructor(e,t,n){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=n}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}di.CancellationDetailsBase=zv;var xt={},Hs;function Nv(){if(Hs)return xt;Hs=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.CancellationDetails=void 0;const r=_(),e=di,t=R();let n=class Mu extends e.CancellationDetailsBase{constructor(u,c,s){super(u,c,s)}static fromResult(u){let c=t.CancellationReason.Error,s=t.CancellationErrorCode.NoError;if(u instanceof t.RecognitionResult&&u.json){const i=r.SimpleSpeechPhrase.fromJSON(u.json);c=r.EnumTranslation.implTranslateCancelResult(i.RecognitionStatus)}return u.properties&&(s=t.CancellationErrorCode[u.properties.getProperty(r.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.NoError])]),new Mu(c,u.errorDetails||r.EnumTranslation.implTranslateErrorDetails(s),s)}};return xt.CancellationDetails=n,xt}var Du={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CancellationErrorCode=void 0,function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError",e[e.Forbidden=8]="Forbidden"}(r.CancellationErrorCode||(r.CancellationErrorCode={}))})(Du);var Bt={},Vs;function jv(){if(Vs)return Bt;Vs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ConnectionEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{};return Bt.ConnectionEventArgs=e,Bt}var qt={},Ks;function Lv(){if(Ks)return qt;Ks=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ServiceEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{constructor(n,p,u){super(u),this.privJsonResult=n,this.privEventName=p}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};return qt.ServiceEventArgs=e,qt}var an={};Object.defineProperty(an,"__esModule",{value:!0});an.PhraseListGrammar=void 0;class wo{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const t=e.internalData;return new wo(t)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}an.PhraseListGrammar=wo;var je={},Js;function bo(){if(Js)return je;Js=1,Object.defineProperty(je,"__esModule",{value:!0}),je.DialogServiceConfigImpl=je.DialogServiceConfig=void 0;const r=T,e=R();let t=class{constructor(){}set applicationId(u){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};je.DialogServiceConfig=t;class n extends t{constructor(){super(),this.privSpeechConfig=new e.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(u){r.Contracts.throwIfNullOrWhitespace(u,"value"),this.privSpeechConfig.speechRecognitionLanguage=u}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(u){this.privSpeechConfig.outputFormat=u}setProperty(u,c){this.privSpeechConfig.setProperty(u,c)}getProperty(u,c){return this.privSpeechConfig.getProperty(u)}setProxy(u,c,s,i){this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyHostName,u),this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPort,`${c}`),s&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyUserName,s),i&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPassword,i)}setServiceProperty(u,c,s){this.privSpeechConfig.setServiceProperty(u,c)}close(){}}return je.DialogServiceConfigImpl=n,je}var Ft={},Gs;function xv(){if(Gs)return Ft;Gs=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.BotFrameworkConfig=void 0;const r=T,e=bo(),t=R();let n=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(u,c,s){r.Contracts.throwIfNullOrWhitespace(u,"subscription"),r.Contracts.throwIfNullOrWhitespace(c,"region");const i=new e.DialogServiceConfigImpl;return i.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),i.setProperty(t.PropertyId.SpeechServiceConnection_Key,u),i.setProperty(t.PropertyId.SpeechServiceConnection_Region,c),s&&i.setProperty(t.PropertyId.Conversation_ApplicationId,s),i}static fromAuthorizationToken(u,c,s){r.Contracts.throwIfNullOrWhitespace(u,"authorizationToken"),r.Contracts.throwIfNullOrWhitespace(c,"region");const i=new e.DialogServiceConfigImpl;return i.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),i.setProperty(t.PropertyId.SpeechServiceAuthorization_Token,u),i.setProperty(t.PropertyId.SpeechServiceConnection_Region,c),s&&i.setProperty(t.PropertyId.Conversation_ApplicationId,s),i}static fromHost(u,c,s){r.Contracts.throwIfNullOrUndefined(u,"host");const i=u instanceof URL?u:new URL(`wss://${u}.convai.speech.azure.us`);r.Contracts.throwIfNullOrUndefined(i,"resolvedHost");const o=new e.DialogServiceConfigImpl;return o.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(t.PropertyId.SpeechServiceConnection_Host,i.toString()),c!==void 0&&o.setProperty(t.PropertyId.SpeechServiceConnection_Key,c),o}static fromEndpoint(u,c){r.Contracts.throwIfNull(u,"endpoint");const s=new e.DialogServiceConfigImpl;return s.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),s.setProperty(t.PropertyId.SpeechServiceConnection_Endpoint,u.toString()),c!==void 0&&s.setProperty(t.PropertyId.SpeechServiceConnection_Key,c),s}};return Ft.BotFrameworkConfig=n,Ft}var Ut={},Qs;function Bv(){if(Qs)return Ut;Qs=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.CustomCommandsConfig=void 0;const r=T,e=bo(),t=R();let n=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(u,c,s){r.Contracts.throwIfNullOrWhitespace(u,"applicationId"),r.Contracts.throwIfNullOrWhitespace(c,"subscription"),r.Contracts.throwIfNullOrWhitespace(s,"region");const i=new e.DialogServiceConfigImpl;return i.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),i.setProperty(t.PropertyId.Conversation_ApplicationId,u),i.setProperty(t.PropertyId.SpeechServiceConnection_Key,c),i.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i}static fromAuthorizationToken(u,c,s){r.Contracts.throwIfNullOrWhitespace(u,"applicationId"),r.Contracts.throwIfNullOrWhitespace(c,"authorizationToken"),r.Contracts.throwIfNullOrWhitespace(s,"region");const i=new e.DialogServiceConfigImpl;return i.setProperty(t.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),i.setProperty(t.PropertyId.Conversation_ApplicationId,u),i.setProperty(t.PropertyId.SpeechServiceAuthorization_Token,c),i.setProperty(t.PropertyId.SpeechServiceConnection_Region,s),i}set applicationId(u){r.Contracts.throwIfNullOrWhitespace(u,"value"),this.setProperty(t.PropertyId.Conversation_ApplicationId,u)}get applicationId(){return this.getProperty(t.PropertyId.Conversation_ApplicationId)}};return Ut.CustomCommandsConfig=n,Ut}var $t={},Wt={},Ht={},pe={};Object.defineProperty(pe,"__esModule",{value:!0});pe.QueryParameterNames=void 0;class x{}pe.QueryParameterNames=x;x.BotId="botid";x.CustomSpeechDeploymentId="cid";x.CustomVoiceDeploymentId="deploymentId";x.EnableAudioLogging="storeAudio";x.EnableLanguageId="lidEnabled";x.EnableWordLevelTimestamps="wordLevelTimestamps";x.EndSilenceTimeoutMs="endSilenceTimeoutMs";x.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs";x.Format="format";x.InitialSilenceTimeoutMs="initialSilenceTimeoutMs";x.Language="language";x.Profanity="profanity";x.RequestBotStatusMessages="enableBotMessageStatus";x.StableIntermediateThreshold="stableIntermediateThreshold";x.StableTranslation="stableTranslation";x.TestHooks="testhooks";x.Postprocessing="postprocessing";x.CtsMeetingId="meetingId";x.CtsDeviceId="deviceId";x.CtsIsParticipant="isParticipant";x.EnableAvatar="enableTalkingAvatar";var Zs;function de(){if(Zs)return Ht;Zs=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ConnectionFactoryBase=void 0;const r=_(),e=R(),t=pe;let n=class{static getHostSuffix(u){if(u){if(u.toLowerCase().startsWith("china"))return".azure.cn";if(u.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(u,c,s){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,t.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,t.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,t.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,t.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,t.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,t.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,t.QueryParameterNames.EnableWordLevelTimestamps],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,t.QueryParameterNames.StableIntermediateThreshold]]).forEach((a,h)=>{this.setUrlParameter(h,a,u,c,s)});const o=JSON.parse(u.parameters.getProperty(r.ServicePropertiesPropertyName,"{}"));Object.keys(o).forEach(a=>{c[a]=o[a]})}setUrlParameter(u,c,s,i,o){const a=s.parameters.getProperty(u,void 0);a&&(!o||o.search(c)===-1)&&(i[c]=a.toLocaleLowerCase())}};return Ht.ConnectionFactoryBase=n,Ht}var Xs;function qv(){if(Xs)return Wt;Xs=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.DialogConnectionFactory=void 0;const r=F(),e=_(),t=R(),n=de(),p=_(),u=q,c=pe;class s extends n.ConnectionFactoryBase{create(o,a,h){const d=o.parameters.getProperty(t.PropertyId.Conversation_ApplicationId,""),l=o.parameters.getProperty(t.PropertyId.Conversation_DialogType),v=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region),f=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),m=o.parameters.getProperty(t.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),g={};g[u.HeaderNames.ConnectionId]=h,g[c.QueryParameterNames.Format]=o.parameters.getProperty(e.OutputFormatPropertyName,t.OutputFormat[t.OutputFormat.Simple]).toLowerCase(),g[c.QueryParameterNames.Language]=f,g[c.QueryParameterNames.RequestBotStatusMessages]=m,d&&(g[c.QueryParameterNames.BotId]=d,l===t.DialogServiceConfig.DialogTypes.CustomCommands&&(g[u.HeaderNames.CustomCommandsAppId]=d));const S=l===t.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",y=l===t.DialogServiceConfig.DialogTypes.CustomCommands?"v1":l===t.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",E={};a.token!=null&&a.token!==""&&(E[a.headerName]=a.token);let P=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,"");if(!P){const O=n.ConnectionFactoryBase.getHostSuffix(v),z=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,`wss://${v}.${s.BaseUrl}${O}`);P=`${z.endsWith("/")?z:z+"/"}${S}${s.ApiKey}/${y}`}this.setCommonUrlParams(o,g,P);const b=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(P,g,E,new p.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),b,h)}}return Wt.DialogConnectionFactory=s,s.ApiKey="api",s.BaseUrl="convai.speech",Wt}var Ys;function Fv(){if(Ys)return $t;Ys=1;var r=C&&C.__awaiter||function(i,o,a,h){function d(l){return l instanceof a?l:new a(function(v){v(l)})}return new(a||(a=Promise))(function(l,v){function f(S){try{g(h.next(S))}catch(y){v(y)}}function m(S){try{g(h.throw(S))}catch(y){v(y)}}function g(S){S.done?l(S.value):d(S.value).then(f,m)}g((h=h.apply(i,o||[])).next())})};Object.defineProperty($t,"__esModule",{value:!0}),$t.DialogServiceConnector=void 0;const e=qv(),t=_(),n=I(),p=T,u=R(),c=on;let s=class extends u.Recognizer{constructor(o,a){const h=o;p.Contracts.throwIfNull(o,"dialogConfig"),super(a,h.properties,new e.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=h.properties.clone();const d=this.buildAgentConfig();this.privReco.agentConfig.set(d)}connect(o,a){n.marshalPromiseToCallbacks(this.privReco.connect(),o,a)}disconnect(o,a){n.marshalPromiseToCallbacks(this.privReco.disconnect(),o,a)}get authorizationToken(){return this.properties.getProperty(c.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){p.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(c.PropertyId.SpeechServiceAuthorization_Token,o)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(c.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(o){this.properties.setProperty(c.PropertyId.Conversation_Speech_Activity_Template,o)}listenOnceAsync(o,a){if(this.isTurnComplete){p.Contracts.throwIfDisposed(this.privIsDisposed);const d=r(this,void 0,void 0,function*(){yield this.privReco.connect(),yield this.implRecognizerStop(),this.isTurnComplete=!1;const l=new n.Deferred;yield this.privReco.recognize(t.RecognitionMode.Conversation,l.resolve,l.reject);const v=yield l.promise;return yield this.implRecognizerStop(),v});d.catch(()=>{this.dispose(!0).catch(()=>{})}),n.marshalPromiseToCallbacks(d.finally(()=>{this.isTurnComplete=!0}),o,a)}}sendActivityAsync(o,a,h){n.marshalPromiseToCallbacks(this.privReco.sendMessage(o),a,h)}close(o,a){p.Contracts.throwIfDisposed(this.privIsDisposed),n.marshalPromiseToCallbacks(this.dispose(!0),o,a)}dispose(o){const a=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privIsDisposed||o&&(this.privIsDisposed=!0,yield this.implRecognizerStop(),yield a.dispose.call(this,o))})}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,h,d){const l=h;return new t.DialogServiceAdapter(o,a,l,d,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(c.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(c.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(c.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(c.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};return $t.DialogServiceConnector=s,$t}var cn={};Object.defineProperty(cn,"__esModule",{value:!0});cn.ActivityReceivedEventArgs=void 0;class Uv{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}cn.ActivityReceivedEventArgs=Uv;var un={},pn={};Object.defineProperty(pn,"__esModule",{value:!0});pn.TurnStatusResponsePayload=void 0;class Oo{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new Oo(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}pn.TurnStatusResponsePayload=Oo;Object.defineProperty(un,"__esModule",{value:!0});un.TurnStatusReceivedEventArgs=void 0;const $v=pn;class Wv{constructor(e){this.privTurnStatus=$v.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}un.TurnStatusReceivedEventArgs=Wv;var ku={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ServicePropertyChannel=void 0,function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(r.ServicePropertyChannel||(r.ServicePropertyChannel={}))})(ku);var zu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ProfanityOption=void 0,function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(r.ProfanityOption||(r.ProfanityOption={}))})(zu);var Vt={},ea;function Hv(){if(ea)return Vt;ea=1;var r=C&&C.__awaiter||function(u,c,s,i){function o(a){return a instanceof s?a:new s(function(h){h(a)})}return new(s||(s=Promise))(function(a,h){function d(f){try{v(i.next(f))}catch(m){h(m)}}function l(f){try{v(i.throw(f))}catch(m){h(m)}}function v(f){f.done?a(f.value):o(f.value).then(d,l)}v((i=i.apply(u,c||[])).next())})};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.BaseAudioPlayer=void 0;const e=W,t=R(),n=Me;let p=class{constructor(c){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,c===void 0&&(c=t.AudioStreamFormat.getDefaultInputFormat()),this.init(c)}playAudioSample(c,s,i){try{this.ensureInitializedContext();const o=this.formatAudioData(c),a=new Float32Array(this.samples.length+o.length);a.set(this.samples,0),a.set(o,this.samples.length),this.samples=a,s&&s()}catch(o){i&&i(o)}}stopAudio(c,s){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{c&&c()},i=>{s&&s(i)}),this.audioContext=null)}init(c){this.audioFormat=c,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();const c=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},c)}}createAudioContext(){this.audioContext=n.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(c){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(c),128);case 16:return this.formatArrayBuffer(new Int16Array(c),32768);case 32:return this.formatArrayBuffer(new Int32Array(c),2147483648);default:throw new e.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(c,s){const i=new Float32Array(c.length);for(let o=0;o<c.length;o++)i[o]=c[o]/s;return i}updateAudioBuffer(){if(this.samples.length===0)return;const c=this.audioFormat.channels,s=this.audioContext.createBufferSource(),i=this.samples.length/c,o=this.audioContext.createBuffer(c,i,this.audioFormat.samplesPerSec);for(let a=0;a<c;a++){let h=a;const d=o.getChannelData(a);for(let l=0;l<this.samples.length;l++,h+=c)d[l]=this.samples[h]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),s.buffer=o,s.connect(this.gainNode),s.start(this.startTime),this.startTime+=o.duration,this.samples=new Float32Array}playAudio(c){return r(this,void 0,void 0,function*(){this.audioContext===null&&this.createAudioContext();const s=this.audioContext.createBufferSource(),i=this.audioContext.destination;yield this.audioContext.decodeAudioData(c,o=>{s.buffer=o,s.connect(i),s.start(0)})})}};return Vt.BaseAudioPlayer=p,Vt}var dn={};Object.defineProperty(dn,"__esModule",{value:!0});dn.ConnectionMessageEventArgs=void 0;class Vv{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}}dn.ConnectionMessageEventArgs=Vv;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});hn.VoiceProfile=void 0;class Kv{constructor(e,t){this.privId=e,this.privProfileType=t}get profileId(){return this.privId}get profileType(){return this.privProfileType}}hn.VoiceProfile=Kv;var Le={},ta;function Jv(){if(ta)return Le;ta=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.VoiceProfileEnrollmentCancellationDetails=Le.VoiceProfileEnrollmentResult=void 0;const r=_(),e=R();let t=class go{constructor(u,c,s){this.privReason=u,this.privProperties=new e.PropertyCollection,this.privReason!==e.ResultReason.Canceled?c&&(this.privDetails=JSON.parse(c),this.privDetails.enrollmentStatus.toLowerCase()==="enrolling"&&(this.privReason=e.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=s,this.privProperties.setProperty(r.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(u){const c=[];for(const s of u.value){const i=s.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:s.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,o=new go(i,null,null);o.privDetails=this.getIdentificationDetails(s),c.push(o)}return c}static FromVerificationProfileList(u){const c=[];for(const s of u.value){const i=s.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:s.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,o=new go(i,null,null);o.privDetails=this.getVerificationDetails(s),c.push(o)}return c}static getIdentificationDetails(u){return{audioLength:u.audioLength?parseFloat(u.audioLength):0,audioSpeechLength:u.audioSpeechLength?parseFloat(u.audioSpeechLength):0,enrollmentStatus:u.enrollmentStatus,enrollmentsCount:u.enrollmentsCount||0,enrollmentsLength:u.enrollmentsLength?parseFloat(u.enrollmentsLength):0,enrollmentsSpeechLength:u.enrollmentsSpeechLength?parseFloat(u.enrollmentsSpeechLength):0,profileId:u.profileId||u.identificationProfileId,remainingEnrollmentsSpeechLength:u.remainingEnrollmentsSpeechLength?parseFloat(u.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(u){return{audioLength:u.audioLength?parseFloat(u.audioLength):0,audioSpeechLength:u.audioSpeechLength?parseFloat(u.audioSpeechLength):0,enrollmentStatus:u.enrollmentStatus,enrollmentsCount:u.enrollmentsCount,enrollmentsLength:u.enrollmentsLength?parseFloat(u.enrollmentsLength):0,enrollmentsSpeechLength:u.enrollmentsSpeechLength?parseFloat(u.enrollmentsSpeechLength):0,profileId:u.profileId||u.verificationProfileId,remainingEnrollmentsCount:u.remainingEnrollments||u.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:u.remainingEnrollmentsSpeechLength?parseFloat(u.remainingEnrollmentsSpeechLength):0}}};Le.VoiceProfileEnrollmentResult=t;class n extends e.CancellationDetailsBase{constructor(u,c,s){super(u,c,s)}static fromResult(u){const c=e.CancellationReason.Error;let s=e.CancellationErrorCode.NoError;return u.properties&&(s=e.CancellationErrorCode[u.properties.getProperty(r.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.NoError])]),new n(c,u.errorDetails,s)}}return Le.VoiceProfileEnrollmentCancellationDetails=n,Le}var xe={},ra;function Gv(){if(ra)return xe;ra=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.VoiceProfileCancellationDetails=xe.VoiceProfileResult=void 0;const r=_(),e=T,t=R();let n=class{constructor(c,s){this.privReason=c,this.privProperties=new t.PropertyCollection,c===t.ResultReason.Canceled&&(e.Contracts.throwIfNullOrUndefined(s,"statusText"),this.privErrorDetails=s,this.privProperties.setProperty(r.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}};xe.VoiceProfileResult=n;class p extends t.CancellationDetailsBase{constructor(c,s,i){super(c,s,i)}static fromResult(c){const s=t.CancellationReason.Error;let i=t.CancellationErrorCode.NoError;return c.properties&&(i=t.CancellationErrorCode[c.properties.getProperty(r.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.NoError])]),new p(s,c.errorDetails,i)}}return xe.VoiceProfileCancellationDetails=p,xe}var Kt={},ia;function Qv(){if(ia)return Kt;ia=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.VoiceProfilePhraseResult=void 0;const r=T,e=R();let t=class extends e.VoiceProfileResult{constructor(p,u,c,s){super(p,u),this.privPhrases=[],r.Contracts.throwIfNullOrUndefined(s,"phrase array"),this.privType=c,s&&s[0]&&(this.privPhrases=s)}get phrases(){return this.privPhrases}get type(){return this.privType}};return Kt.VoiceProfilePhraseResult=t,Kt}var Jt={},na;function Zv(){if(na)return Jt;na=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.VoiceProfileClient=void 0;const e=_(),t=vu(),n=T,p=R();let u=class extends p.Recognizer{constructor(s){n.Contracts.throwIfNullOrUndefined(s,"speechConfig");const i=s;n.Contracts.throwIfNull(i,"speechConfig"),super(t.AudioConfig.fromStreamInput(p.AudioInputStream.createPushStream()),i.properties,new e.VoiceProfileConnectionFactory),this.privProperties=i.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){n.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,s)}createProfileAsync(s,i){return r(this,void 0,void 0,function*(){const o=yield this.privVoiceAdapter.createProfile(s,i);return new p.VoiceProfile(o[0],s)})}retrieveEnrollmentResultAsync(s){return r(this,void 0,void 0,function*(){return this.privVoiceAdapter.retrieveEnrollmentResult(s)})}getAllProfilesAsync(s){return r(this,void 0,void 0,function*(){return this.privVoiceAdapter.getAllProfiles(s)})}getActivationPhrasesAsync(s,i){return r(this,void 0,void 0,function*(){return this.privVoiceAdapter.getActivationPhrases(s,i)})}enrollProfileAsync(s,i){return r(this,void 0,void 0,function*(){const o=i;return n.Contracts.throwIfNullOrUndefined(o,"audioConfig"),this.audioConfig=i,this.privVoiceAdapter.SpeakerAudioSource=o,this.privVoiceAdapter.enrollProfile(s)})}deleteProfileAsync(s){return r(this,void 0,void 0,function*(){return this.privVoiceAdapter.deleteProfile(s)})}resetProfileAsync(s){return r(this,void 0,void 0,function*(){return this.privVoiceAdapter.resetProfile(s)})}close(){return r(this,void 0,void 0,function*(){yield this.dispose(!0)})}createServiceRecognizer(s,i,o,a){const h=o;return new e.VoiceServiceRecognizer(s,i,h,a,this)}dispose(s){const i=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,s&&(yield i.dispose.call(this,s)))})}createRecognizerConfig(s){return new e.RecognizerConfig(s,this.properties)}getResult(s,i){return new p.VoiceProfileResult(s.ok?i:p.ResultReason.Canceled,s.statusText)}};return Jt.VoiceProfileClient=u,Jt}var Gt={},oa;function Xv(){if(oa)return Gt;oa=1;var r=C&&C.__awaiter||function(u,c,s,i){function o(a){return a instanceof s?a:new s(function(h){h(a)})}return new(s||(s=Promise))(function(a,h){function d(f){try{v(i.next(f))}catch(m){h(m)}}function l(f){try{v(i.throw(f))}catch(m){h(m)}}function v(f){f.done?a(f.value):o(f.value).then(d,l)}v((i=i.apply(u,c||[])).next())})};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.SpeakerRecognizer=void 0;const e=_(),t=T,n=R();let p=class extends n.Recognizer{constructor(c,s){t.Contracts.throwIfNullOrUndefined(c,"speechConfig");const i=c;t.Contracts.throwIfNullOrUndefined(i,"speechConfig"),super(s,i.properties,new e.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=s,t.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=i.properties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(c){t.Contracts.throwIfNullOrWhitespace(c,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,c)}get properties(){return this.privProperties}recognizeOnceAsync(c){return r(this,void 0,void 0,function*(){return t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(c)})}close(){return r(this,void 0,void 0,function*(){t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.dispose(!0)})}recognizeSpeakerOnceAsyncImpl(c){return r(this,void 0,void 0,function*(){t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.implRecognizerStop();const s=yield this.privReco.recognizeSpeaker(c);return yield this.implRecognizerStop(),s})}implRecognizerStop(){return r(this,void 0,void 0,function*(){this.privReco&&(yield this.privReco.stopRecognizing())})}createRecognizerConfig(c){return new e.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,s,i,o){const a=i;return new e.SpeakerServiceRecognizer(c,s,a,o,this)}dispose(c){const s=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedSpeakerRecognizer||c&&(this.privDisposedSpeakerRecognizer=!0,yield s.dispose.call(this,c))})}};return Gt.SpeakerRecognizer=p,Gt}var Qt={},sa;function Yv(){if(sa)return Qt;sa=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.SpeakerIdentificationModel=void 0;const r=T,e=R();let t=class Nu{constructor(p){if(this.privVoiceProfiles=[],this.privProfileIds=[],r.Contracts.throwIfNullOrUndefined(p,"VoiceProfiles"),p.length===0)throw new Error("Empty Voice Profiles array");for(const u of p){if(u.profileType!==e.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+u.profileId);this.privVoiceProfiles.push(u),this.privProfileIds.push(u.profileId)}}static fromProfiles(p){return new Nu(p)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}};return Qt.SpeakerIdentificationModel=t,Qt}var Zt={},aa;function ef(){if(aa)return Zt;aa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.SpeakerVerificationModel=void 0;const r=T,e=R();let t=class ju{constructor(p){if(r.Contracts.throwIfNullOrUndefined(p,"VoiceProfile"),p.profileType===e.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=p}static fromProfile(p){return new ju(p)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===e.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}};return Zt.SpeakerVerificationModel=t,Zt}var Xt={},Mo={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.LanguageIdMode=void 0,function(e){e[e.AtStart=0]="AtStart",e[e.Continuous=1]="Continuous"}(r.LanguageIdMode||(r.LanguageIdMode={}))})(Mo);var ca;function tf(){if(ca)return Xt;ca=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.AutoDetectSourceLanguageConfig=void 0;const r=_(),e=T,t=R(),n=Mo;let p=class Ri{constructor(){this.privProperties=new t.PropertyCollection,this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=n.LanguageIdMode.AtStart}static fromOpenRange(){const c=new Ri;return c.properties.setProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,r.AutoDetectSourceLanguagesOpenRangeOptionName),c}static fromLanguages(c){e.Contracts.throwIfArrayEmptyOrWhitespace(c,"languages");const s=new Ri;return s.properties.setProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,c.join()),s}static fromSourceLanguageConfigs(c){if(c.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const s=new Ri,i=[];return c.forEach(o=>{if(i.push(o.language),o.endpointId!==void 0&&o.endpointId!==""){const a=o.language+t.PropertyId.SpeechServiceConnection_EndpointId.toString();s.properties.setProperty(a,o.endpointId)}}),s.properties.setProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,i.join()),s}get properties(){return this.privProperties}set mode(c){c===n.LanguageIdMode.Continuous?(this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=c}};return Xt.AutoDetectSourceLanguageConfig=p,Xt}var ln={};Object.defineProperty(ln,"__esModule",{value:!0});ln.AutoDetectSourceLanguageResult=void 0;const ua=T;class Ei{constructor(e,t){ua.Contracts.throwIfNullOrUndefined(e,"language"),ua.Contracts.throwIfNullOrUndefined(t,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=t}static fromResult(e){return new Ei(e.language,e.languageDetectionConfidence)}static fromConversationTranscriptionResult(e){return new Ei(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}ln.AutoDetectSourceLanguageResult=Ei;var vn={};Object.defineProperty(vn,"__esModule",{value:!0});vn.SourceLanguageConfig=void 0;const rf=T;class Do{constructor(e,t){rf.Contracts.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=t}static fromLanguage(e,t){return new Do(e,t)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}vn.SourceLanguageConfig=Do;var ro={},pa;function nf(){return pa||(pa=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SpeakerRecognitionCancellationDetails=r.SpeakerRecognitionResult=r.SpeakerRecognitionResultType=void 0;const e=_(),t=R();var n;(function(c){c[c.Verify=0]="Verify",c[c.Identify=1]="Identify"})(n=r.SpeakerRecognitionResultType||(r.SpeakerRecognitionResultType={}));class p{constructor(s,i=t.ResultReason.RecognizedSpeaker,o=t.CancellationErrorCode.NoError,a=""){this.privProperties=new t.PropertyCollection;const h=s.scenario==="TextIndependentIdentification"?n.Identify:n.Verify;this.privReason=i,this.privReason!==t.ResultReason.Canceled?h===n.Identify?(this.privProfileId=s.identificationResult.identifiedProfile.profileId,this.privScore=s.identificationResult.identifiedProfile.score,this.privReason=t.ResultReason.RecognizedSpeakers):(this.privScore=s.verificationResult.score,s.verificationResult.recognitionResult.toLowerCase()!=="accept"&&(this.privReason=t.ResultReason.NoMatch),s.verificationResult.profileId!==void 0&&s.verificationResult.profileId!==""&&(this.privProfileId=s.verificationResult.profileId)):(this.privErrorDetails=a,this.privProperties.setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[o])),this.privProperties.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(s))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}r.SpeakerRecognitionResult=p;class u extends t.CancellationDetailsBase{constructor(s,i,o){super(s,i,o)}static fromResult(s){const i=t.CancellationReason.Error;let o=t.CancellationErrorCode.NoError;return s.properties&&(o=t.CancellationErrorCode[s.properties.getProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.NoError])]),new u(i,s.errorDetails,o)}}r.SpeakerRecognitionCancellationDetails=u}(ro)),ro}var io={},Be={},da;function Lu(){if(da)return Be;da=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Be,"__esModule",{value:!0}),Be.ConversationImpl=Be.Conversation=void 0;const e=_(),t=I(),n=T,p=R();let u=class{constructor(){}static createConversationAsync(i,o,a,h){n.Contracts.throwIfNullOrUndefined(i,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(i.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!i.subscriptionKey&&!i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(i.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let d,l,v;return typeof o=="string"?(d=new c(i,o),t.marshalPromiseToCallbacks(r(this,void 0,void 0,function*(){}),a,h)):(d=new c(i),l=o,v=a,d.createConversationAsync(()=>{l&&l()},f=>{v&&v(f)})),d}};Be.Conversation=u;class c extends u{constructor(i,o){if(super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=d=>{var l;this.privIsConnected=!0;try{!((l=this.privConversationTranslator)===null||l===void 0)&&l.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,d)}catch{}},this.onDisconnected=d=>{var l;try{!((l=this.privConversationTranslator)===null||l===void 0)&&l.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,d)}catch{}finally{this.close(!1)}},this.onCanceled=(d,l)=>{var v;try{!((v=this.privConversationTranslator)===null||v===void 0)&&v.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,l)}catch{}},this.onParticipantUpdateCommandReceived=(d,l)=>{try{const v=this.privParticipants.getParticipant(l.id);if(v!==void 0){switch(l.key){case e.ConversationTranslatorCommandTypes.changeNickname:v.displayName=l.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:v.isUsingTts=l.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:v.profanity=l.value;break;case e.ConversationTranslatorCommandTypes.setMute:v.isMuted=l.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:v.translateToLanguages=l.value;break}this.privParticipants.addOrUpdateParticipant(v),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.Updated,[this.toParticipant(v)],l.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(d,l)=>{try{this.privParticipants.participants.forEach(v=>v.isMuted=v.isHost?!1:l.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.Updated,this.toParticipants(!1),l.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(d,l)=>{try{const v=this.privParticipants.addOrUpdateParticipant(l.participant);v!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.JoinedConversation,[this.toParticipant(v)],l.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(d,l)=>{try{const v=this.privParticipants.getParticipant(l.participant.id);v!==void 0&&(this.privParticipants.deleteParticipant(l.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.LeftConversation,[this.toParticipant(v)],l.sessionId)))}catch{}},this.onTranslationReceived=(d,l)=>{try{switch(l.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break}}catch{}},this.onParticipantsListReceived=(d,l)=>{var v;try{if(l.sessionToken!==void 0&&l.sessionToken!==null&&(this.privRoom.token=l.sessionToken),this.privParticipants.participants=[...l.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),l.sessionId)),this.me.isHost){const f=(v=this.privConversationTranslator)===null||v===void 0?void 0:v.properties.getProperty(p.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(d,l)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,l)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new p.PropertyCollection,this.privManager=new e.ConversationManager,i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage])||i.setProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage]),o)this.privConversationId=o;else{i.targetLanguages.length===0&&i.addTargetLanguage(this.privLanguage),i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceResponse_ProfanityOption])||i.setProfanity(p.ProfanityOption.Masked);let l=i.getProperty(p.PropertyId[p.PropertyId.ConversationTranslator_Name]);l==null&&(l="Host"),n.Contracts.throwIfNullOrTooLong(l,"nickname",50),n.Contracts.throwIfNullOrTooShort(l,"nickname",2),i.setProperty(p.PropertyId[p.PropertyId.ConversationTranslator_Name],l)}this.privConfig=i;const h=i;n.Contracts.throwIfNull(h,"speechConfig"),this.privProperties=h.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var i,o;return!((i=this.privParticipants.me)===null||i===void 0)&&i.isHost?!1:(o=this.privParticipants.me)===null||o===void 0?void 0:o.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const i=this.conversationId,o=this.participants.map(d=>({id:d.id,preferredLanguage:d.preferredLanguage,voice:d.voice})),a={};for(const d of e.ConversationConnectionConfig.transcriptionEventKeys){const l=this.properties.getProperty(d,"");l!==""&&(a[d]=l)}return{id:i,participants:o,conversationProperties:a}}get canSend(){var i;return this.privIsConnected&&!(!((i=this.privParticipants.me)===null||i===void 0)&&i.isMuted)}get canSendAsHost(){var i;return this.privIsConnected&&((i=this.privParticipants.me)===null||i===void 0?void 0:i.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(i){n.Contracts.throwIfNullOrWhitespace(i,"authorizationToken"),this.privToken=i}set conversationTranslator(i){this.privConversationTranslator=i}onToken(i){this.privConversationTranslator.onToken(i)}createConversationAsync(i,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,a=>{a||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=a,this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}startConversationAsync(i,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=e.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}addParticipantAsync(i,o,a){n.Contracts.throwIfNullOrUndefined(i,"Participant"),t.marshalPromiseToCallbacks(this.addParticipantImplAsync(i),o,a)}joinConversationAsync(i,o,a,h,d){try{n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,i,l=>{n.Contracts.throwIfNullOrUndefined(l,this.privErrors.permissionDeniedConnect),this.privRoom=l,this.privConfig.authorizationToken=l.cognitiveSpeechAuthToken,h&&h(l.cognitiveSpeechAuthToken)},l=>{this.handleError(l,d)})}catch(l){this.handleError(l,d)}}deleteConversationAsync(i,o){t.marshalPromiseToCallbacks(this.deleteConversationImplAsync(),i,o)}deleteConversationImplAsync(){return r(this,void 0,void 0,function*(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),yield this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()})}endConversationAsync(i,o){t.marshalPromiseToCallbacks(this.endConversationImplAsync(),i,o)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}muteAllParticipantsAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}muteParticipantAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),!this.me.isHost&&this.me.id!==i&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),a),this.privParticipants.getParticipantIndex(i)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(i,!0),()=>{this.handleCallback(o,a)},d=>{this.handleError(d,a)})}catch(h){this.handleError(h,a)}}removeParticipantAsync(i,o,a){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&i.hasOwnProperty("id"))t.marshalPromiseToCallbacks(this.removeParticipantImplAsync(i),o,a);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),a);let h="";typeof i=="string"?h=i:i.hasOwnProperty("id")?h=i.id:i.hasOwnProperty("userId")&&(h=i.userId),n.Contracts.throwIfNullOrWhitespace(h,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(l=>l.id===h)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(h),()=>{this.handleCallback(o,a)},l=>{this.handleError(l,a)})}}catch(h){this.handleError(h,a)}}unlockConversationAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}unmuteAllParticipantsAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}unmuteParticipantAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),!this.me.isHost&&this.me.id!==i&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),a),this.privParticipants.getParticipantIndex(i)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(i,!1),()=>{this.handleCallback(o,a)},d=>{this.handleError(d,a)})}catch(h){this.handleError(h,a)}}sendTextMessageAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),i.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}setTranslatedLanguagesAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}changeNicknameAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}connectTranscriberRecognizer(i){return r(this,void 0,void 0,function*(){this.privTranscriberRecognizer&&(yield this.privTranscriberRecognizer.close()),yield i.enforceAudioGating(),this.privTranscriberRecognizer=i,this.privTranscriberRecognizer.conversation=this})}getKeepAlive(){const i=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:i,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(i){if(this.privParticipants.addOrUpdateParticipant(i)!==void 0&&this.privTranscriberRecognizer){const a=this.conversationInfo;return a.participants=[i],this.privTranscriberRecognizer.pushConversationEvent(a,"join")}}removeParticipantImplAsync(i){this.privParticipants.deleteParticipant(i.id);const o=this.conversationInfo;return o.participants=[i],this.privTranscriberRecognizer.pushConversationEvent(o,"leave")}close(i){var o;return r(this,void 0,void 0,function*(){try{this.privIsConnected=!1,yield(o=this.privConversationRecognizer)===null||o===void 0?void 0:o.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(a){throw a}i&&this.dispose()})}handleCallback(i,o){if(i){try{i()}catch(a){o&&o(a)}i=void 0}}handleError(i,o){if(o)if(i instanceof Error){const a=i;o(a.name+": "+a.message)}else o(i)}toParticipants(i){const o=this.privParticipants.participants.map(a=>this.toParticipant(a));return i?o:o.filter(a=>a.isHost===!1)}toParticipant(i){return new p.Participant(i.id,i.avatar,i.displayName,i.isHost,i.isMuted,i.isUsingTts,i.preferredLanguage,i.voice)}getMuteAllCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getMuteCommand(i,o){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(i,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:i,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getEjectCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(i,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:i,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getChangeNicknameCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(i,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:i,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getMessageCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(i,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:i,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return Be.ConversationImpl=c,Be}var fn={};Object.defineProperty(fn,"__esModule",{value:!0});fn.ConversationCommon=void 0;class of{constructor(e){this.privAudioConfig=e}handleCallback(e,t){if(e){try{e()}catch(n){t&&t(n)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const n=e;t(n.name+": "+n.message)}else t(e)}}fn.ConversationCommon=of;var Yt={},ha;function sf(){if(ha)return Yt;ha=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.ConversationExpirationEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{constructor(n,p){super(p),this.privExpirationTime=n}get expirationTime(){return this.privExpirationTime}};return Yt.ConversationExpirationEventArgs=e,Yt}var er={},la;function af(){if(la)return er;la=1,Object.defineProperty(er,"__esModule",{value:!0}),er.ConversationParticipantsChangedEventArgs=void 0;const r=R();let e=class extends r.SessionEventArgs{constructor(n,p,u){super(u),this.privReason=n,this.privParticipant=p}get reason(){return this.privReason}get participants(){return this.privParticipant}};return er.ConversationParticipantsChangedEventArgs=e,er}var tr={},va;function cf(){if(va)return tr;va=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.ConversationTranslationCanceledEventArgs=void 0;const r=pi();let e=class extends r.CancellationEventArgsBase{};return tr.ConversationTranslationCanceledEventArgs=e,tr}var rr={},fa;function uf(){if(fa)return rr;fa=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.ConversationTranslationEventArgs=void 0;const r=R();let e=class extends r.RecognitionEventArgs{constructor(n,p,u){super(p,u),this.privResult=n}get result(){return this.privResult}};return rr.ConversationTranslationEventArgs=e,rr}var ir={},ga;function pf(){if(ga)return ir;ga=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.ConversationTranslationResult=void 0;const r=Cu();let e=class extends r.TranslationRecognitionResult{constructor(n,p,u,c,s,i,o,a,h,d,l){super(p,c,s,i,o,a,void 0,void 0,h,d,l),this.privId=n,this.privOrigLang=u}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};return ir.ConversationTranslationResult=e,ir}var no={},nr={},hi={};Object.defineProperty(hi,"__esModule",{value:!0});hi.StringUtils=void 0;class df{static formatString(e,t){if(!e)return"";if(!t)return e;let n="",p="";const u=i=>{n+=i},c=i=>{p+=i};let s=u;for(let i=0;i<e.length;i++){const o=e[i],a=i+1<e.length?e[i+1]:"";switch(o){case"{":a==="{"?(s("{"),i++):s=c;break;case"}":a==="}"?(s("}"),i++):(t.hasOwnProperty(p)&&(n+=t[p]),s=u,p="");break;default:s(o);break}}return n}}hi.StringUtils=df;var ma;function hf(){if(ma)return nr;ma=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.ConversationTranslatorConnectionFactory=void 0;const r=F(),e=hi,t=T,n=R(),p=q,u=pe,c=de(),s=_();let i=class xu extends c.ConnectionFactoryBase{constructor(a){super(),t.Contracts.throwIfNullOrUndefined(a,"convGetter"),this.privConvGetter=a}create(a,h,d){const l=a.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",v=this.privConvGetter().room,f=v.cognitiveSpeechRegion||a.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,""),m={hostSuffix:c.ConnectionFactoryBase.getHostSuffix(f),path:xu.CTS_VIRT_MIC_PATH,region:encodeURIComponent(f)};m[u.QueryParameterNames.Language]=encodeURIComponent(a.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,"")),m[u.QueryParameterNames.CtsMeetingId]=encodeURIComponent(v.roomId),m[u.QueryParameterNames.CtsDeviceId]=encodeURIComponent(v.participantId),m[u.QueryParameterNames.CtsIsParticipant]=v.isHost?"":"&"+u.QueryParameterNames.CtsIsParticipant;let g="";const S={},y={};if(l){g=a.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint),g||(g="wss://"+a.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),g=e.StringUtils.formatString(g,m);const P=new URL(g);P.searchParams.forEach((O,z)=>{S[z]=O}),new s.TranscriberConnectionFactory().setQueryParams(S,a,g),S[u.QueryParameterNames.CtsMeetingId]=m[u.QueryParameterNames.CtsMeetingId],S[u.QueryParameterNames.CtsDeviceId]=m[u.QueryParameterNames.CtsDeviceId],v.isHost||(S[u.QueryParameterNames.CtsIsParticipant]=""),u.QueryParameterNames.Format in S||(S[u.QueryParameterNames.Format]="simple"),P.searchParams.forEach((O,z)=>{P.searchParams.set(z,S[z]),delete S[z]}),g=P.toString()}else{const P=new s.TranslationConnectionFactory;g=P.getEndpointUrl(a,!0),g=e.StringUtils.formatString(g,m),P.setQueryParams(S,a,g)}y[p.HeaderNames.ConnectionId]=d,y[r.RestConfigBase.configParams.token]=v.token,h.token&&(y[h.headerName]=h.token);const E=a.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return new r.WebsocketConnection(g,S,y,new s.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(a),E,d)}};return nr.ConversationTranslatorConnectionFactory=i,i.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio",nr}var Sa;function lf(){return Sa||(Sa=1,function(r){var e=C&&C.__awaiter||function(d,l,v,f){function m(g){return g instanceof v?g:new v(function(S){S(g)})}return new(v||(v=Promise))(function(g,S){function y(b){try{P(f.next(b))}catch(O){S(O)}}function E(b){try{P(f.throw(b))}catch(O){S(O)}}function P(b){b.done?g(b.value):m(b.value).then(y,E)}P((f=f.apply(d,l||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.ConversationTranslator=r.SpeechState=void 0;const t=_(),n=hf(),p=I(),u=T,c=R(),s=Lu(),i=ko();var o;(function(d){d[d.Inactive=0]="Inactive",d[d.Connecting=1]="Connecting",d[d.Connected=2]="Connected"})(o=r.SpeechState||(r.SpeechState={}));class a extends c.TranslationRecognizer{constructor(l,v,f,m){super(l,v,new n.ConversationTranslatorConnectionFactory(m)),this.privSpeechState=o.Inactive,f&&(this.privTranslator=f,this.sessionStarted=()=>{this.privSpeechState=o.Connected},this.sessionStopped=()=>{this.privSpeechState=o.Inactive},this.recognizing=(g,S)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,S)},this.recognized=(g,S)=>e(this,void 0,void 0,function*(){var y;!((y=S.result)===null||y===void 0)&&y.errorDetails?(yield this.cancelSpeech(),this.fireCancelEvent(S.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,S)}),this.canceled=()=>e(this,void 0,void 0,function*(){if(this.privSpeechState!==o.Inactive)try{yield this.cancelSpeech()}catch{this.privSpeechState=o.Inactive}}))}get state(){return this.privSpeechState}set state(l){this.privSpeechState=l}set authentication(l){this.privReco.authentication=l}onConnection(){this.privSpeechState=o.Connected}onCancelSpeech(){return e(this,void 0,void 0,function*(){this.privSpeechState=o.Inactive,yield this.cancelSpeech()})}fireCancelEvent(l){try{if(this.privTranslator.canceled){const v=new i.ConversationTranslationCanceledEventArgs(c.CancellationReason.Error,l,c.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,v)}}catch{}}cancelSpeech(){var l;return e(this,void 0,void 0,function*(){try{this.stopContinuousRecognitionAsync(),yield(l=this.privReco)===null||l===void 0?void 0:l.disconnect(),this.privSpeechState=o.Inactive}catch{}})}}class h extends i.ConversationCommon{constructor(l){super(l),this.privErrors=t.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new c.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var l;return(l=this.privConversation)===null||l===void 0?void 0:l.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===o.Connected||this.privCTRecognizer.state===o.Connecting||this.privConversation.isMutedByHost)}onToken(l){this.privCTRecognizer.authentication=l}setServiceProperty(l,v){const f=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));f[l]=v,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(f))}joinConversationAsync(l,v,f,m,g){try{if(typeof l=="string"){u.Contracts.throwIfNullOrUndefined(l,this.privErrors.invalidArgs.replace("{arg}","conversation id")),u.Contracts.throwIfNullOrWhitespace(v,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),g);let S=f;(S==null||S==="")&&(S=t.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=c.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(c.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(S),this.privSpeechTranslationConfig.setProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage],S),this.privSpeechTranslationConfig.setProperty(c.PropertyId[c.PropertyId.ConversationTranslator_Name],v);const y=[c.PropertyId.SpeechServiceConnection_Host,c.PropertyId.ConversationTranslator_Host,c.PropertyId.SpeechServiceConnection_Endpoint,c.PropertyId.SpeechServiceConnection_ProxyHostName,c.PropertyId.SpeechServiceConnection_ProxyPassword,c.PropertyId.SpeechServiceConnection_ProxyPort,c.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const P of y){const b=this.privProperties.getProperty(P);if(b){const O=typeof P=="string"?P:c.PropertyId[P];this.privSpeechTranslationConfig.setProperty(O,b)}}const E=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));for(const P of Object.keys(E))this.privSpeechTranslationConfig.setServiceProperty(P,E[P],c.ServicePropertyChannel.UriQueryParameter);this.privConversation=new s.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(l,v,S,P=>{P||this.handleError(new Error(this.privErrors.permissionDeniedConnect),g),this.privSpeechTranslationConfig.authorizationToken=P,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync(()=>{this.handleCallback(m,g)},b=>{this.handleError(b,g)})},P=>{this.handleError(P,g)})}else typeof l=="object"?(u.Contracts.throwIfNullOrUndefined(l,this.privErrors.invalidArgs.replace("{arg}","conversation id")),u.Contracts.throwIfNullOrWhitespace(v,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(c.PropertyId.ConversationTranslator_Name,v),this.privConversation=l,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,u.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),u.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=l.config,this.handleCallback(f,m)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),m)}catch(S){this.handleError(S,typeof f=="string"?g:m)}}leaveConversationAsync(l,v){p.marshalPromiseToCallbacks(e(this,void 0,void 0,function*(){yield this.cancelSpeech(),yield this.privConversation.endConversationImplAsync(),yield this.privConversation.deleteConversationImplAsync(),this.dispose()}),l,v)}sendTextMessageAsync(l,v,f){try{u.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),u.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}",l)),this.privConversation.sendTextMessageAsync(l,v,f)}catch(m){this.handleError(m,f)}}startTranscribingAsync(l,v){p.marshalPromiseToCallbacks(e(this,void 0,void 0,function*(){try{u.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),u.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&(yield this.connectTranslatorRecognizer()),u.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),v),yield this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(f){throw this.privIsSpeaking=!1,yield this.cancelSpeech(),f}}),l,v)}stopTranscribingAsync(l,v){p.marshalPromiseToCallbacks(e(this,void 0,void 0,function*(){try{if(!this.privIsSpeaking){yield this.cancelSpeech();return}this.privIsSpeaking=!1,yield new Promise((f,m)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(f,m)})}catch{yield this.cancelSpeech()}}),l,v)}isDisposed(){return this.privIsDisposed}dispose(l,v,f){p.marshalPromiseToCallbacks(e(this,void 0,void 0,function*(){this.isDisposed&&!this.privIsSpeaking||(yield this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)}),v,f)}cancelSpeech(){var l;return e(this,void 0,void 0,function*(){try{this.privIsSpeaking=!1,yield(l=this.privCTRecognizer)===null||l===void 0?void 0:l.onCancelSpeech(),this.privCTRecognizer=void 0}catch{}})}connectTranslatorRecognizer(){return e(this,void 0,void 0,function*(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=c.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_Key],"");const l=()=>this.privConversation;this.privCTRecognizer=new a(this.privSpeechTranslationConfig,this.privAudioConfig,this,l)}catch(l){throw yield this.cancelSpeech(),l}})}startContinuousRecognition(){return new Promise((l,v)=>{this.privCTRecognizer.startContinuousRecognitionAsync(l,v)})}}r.ConversationTranslator=h}(no)),no}var or={},Ca;function vf(){if(Ca)return or;Ca=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(or,"__esModule",{value:!0}),or.ConversationTranscriber=void 0;const e=_(),t=I(),n=T,p=R();let u=class Bu extends p.Recognizer{constructor(s,i){const o=s;n.Contracts.throwIfNull(o,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(o.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage),p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage]),super(i,o.properties,new e.ConversationTranscriberConnectionFactory),this.privProperties.setProperty(p.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(s,i,o){const a=s;return i.properties.mergeTo(a.properties),new Bu(s,o)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){n.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,s)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,p.OutputFormat[p.OutputFormat.Simple])===p.OutputFormat[p.OutputFormat.Simple]?p.OutputFormat.Simple:p.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(s,i){t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(e.RecognitionMode.Conversation),s,i)}stopTranscribingAsync(s,i){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),s,i)}close(s,i){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),t.marshalPromiseToCallbacks(this.dispose(!0),s,i)}dispose(s){const i=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedRecognizer||(s&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield i.dispose.call(this,s))})}createRecognizerConfig(s){return new e.RecognizerConfig(s,this.privProperties)}createServiceRecognizer(s,i,o,a){const h=o;return a.isSpeakerDiarizationEnabled=!0,new e.ConversationTranscriptionServiceRecognizer(s,i,h,a,this)}};return or.ConversationTranscriber=u,or}var qe={},ya;function ff(){if(ya)return qe;ya=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Participant=qe.User=void 0;const r=R();class e{constructor(p){this.privUserId=p}get userId(){return this.privUserId}}qe.User=e;class t{constructor(p,u,c,s,i,o,a,h){this.privId=p,this.privAvatar=u,this.privDisplayName=c,this.privIsHost=s,this.privIsMuted=i,this.privIsUsingTts=o,this.privPreferredLanguage=a,this.privVoice=h,this.privProperties=new r.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(p,u,c){return new t(p,"",p,!1,!1,!1,u,c)}}return qe.Participant=t,qe}var qu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ParticipantChangedReason=void 0,function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(r.ParticipantChangedReason||(r.ParticipantChangedReason={}))})(qu);var Fe={},Ra;function gf(){if(Ra)return Fe;Ra=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.MeetingImpl=Fe.Meeting=void 0;const e=_(),t=I(),n=T,p=R();let u=class{constructor(){}static createMeetingAsync(i,o,a,h){if(n.Contracts.throwIfNullOrUndefined(i,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(i.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),n.Contracts.throwIfNull(o,"meetingId"),o.length===0)throw new Error("meetingId cannot be empty");!i.subscriptionKey&&!i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(i.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const d=new c(i,o);return t.marshalPromiseToCallbacks(r(this,void 0,void 0,function*(){}),a,h),d}};Fe.Meeting=u;class c extends u{constructor(i,o){super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=d=>{var l;this.privIsConnected=!0;try{!((l=this.privConversationTranslator)===null||l===void 0)&&l.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,d)}catch{}},this.onDisconnected=d=>{var l;try{!((l=this.privConversationTranslator)===null||l===void 0)&&l.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,d)}catch{}finally{this.close(!1)}},this.onCanceled=(d,l)=>{var v;try{!((v=this.privConversationTranslator)===null||v===void 0)&&v.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,l)}catch{}},this.onParticipantUpdateCommandReceived=(d,l)=>{try{const v=this.privParticipants.getParticipant(l.id);if(v!==void 0){switch(l.key){case e.ConversationTranslatorCommandTypes.changeNickname:v.displayName=l.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:v.isUsingTts=l.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:v.profanity=l.value;break;case e.ConversationTranslatorCommandTypes.setMute:v.isMuted=l.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:v.translateToLanguages=l.value;break}this.privParticipants.addOrUpdateParticipant(v),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.Updated,[this.toParticipant(v)],l.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(d,l)=>{try{this.privParticipants.participants.forEach(v=>v.isMuted=v.isHost?!1:l.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.Updated,this.toParticipants(!1),l.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(d,l)=>{try{const v=this.privParticipants.addOrUpdateParticipant(l.participant);v!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.JoinedConversation,[this.toParticipant(v)],l.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(d,l)=>{try{const v=this.privParticipants.getParticipant(l.participant.id);v!==void 0&&(this.privParticipants.deleteParticipant(l.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.LeftConversation,[this.toParticipant(v)],l.sessionId)))}catch{}},this.onTranslationReceived=(d,l)=>{try{switch(l.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new p.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break}}catch{}},this.onParticipantsListReceived=(d,l)=>{var v;try{if(l.sessionToken!==void 0&&l.sessionToken!==null&&(this.privRoom.token=l.sessionToken),this.privParticipants.participants=[...l.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(p.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),l.sessionId)),this.me.isHost){const f=(v=this.privConversationTranslator)===null||v===void 0?void 0:v.properties.getProperty(p.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(d,l)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,l)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new p.PropertyCollection,this.privManager=new e.ConversationManager,i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage])||i.setProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=i.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=o,this.privConfig=i;const h=i;n.Contracts.throwIfNull(h,"speechConfig"),this.privProperties=h.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var i,o;return!((i=this.privParticipants.me)===null||i===void 0)&&i.isHost?!1:(o=this.privParticipants.me)===null||o===void 0?void 0:o.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const i=this.meetingId,o=this.participants.map(d=>({id:d.id,preferredLanguage:d.preferredLanguage,voice:d.voice})),a={};for(const d of e.ConversationConnectionConfig.transcriptionEventKeys){const l=this.properties.getProperty(d,"");l!==""&&(a[d]=l)}return{id:i,participants:o,meetingProperties:a}}get canSend(){var i;return this.privIsConnected&&!(!((i=this.privParticipants.me)===null||i===void 0)&&i.isMuted)}get canSendAsHost(){var i;return this.privIsConnected&&((i=this.privParticipants.me)===null||i===void 0?void 0:i.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(i){n.Contracts.throwIfNullOrWhitespace(i,"authorizationToken"),this.privToken=i}createMeetingAsync(i,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,a=>{a||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=a,this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}startMeetingAsync(i,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}addParticipantAsync(i,o,a){n.Contracts.throwIfNullOrUndefined(i,"Participant"),t.marshalPromiseToCallbacks(this.addParticipantImplAsync(i),o,a)}joinMeetingAsync(i,o,a,h,d){try{n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,i,l=>{n.Contracts.throwIfNullOrUndefined(l,this.privErrors.permissionDeniedConnect),this.privRoom=l,this.privConfig.authorizationToken=l.cognitiveSpeechAuthToken,h&&h(l.cognitiveSpeechAuthToken)},l=>{this.handleError(l,d)})}catch(l){this.handleError(l,d)}}deleteMeetingAsync(i,o){t.marshalPromiseToCallbacks(this.deleteMeetingImplAsync(),i,o)}deleteMeetingImplAsync(){return r(this,void 0,void 0,function*(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),yield this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()})}endMeetingAsync(i,o){t.marshalPromiseToCallbacks(this.endMeetingImplAsync(),i,o)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}muteAllParticipantsAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}muteParticipantAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),!this.me.isHost&&this.me.id!==i&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),a),this.privParticipants.getParticipantIndex(i)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(i,!0),()=>{this.handleCallback(o,a)},d=>{this.handleError(d,a)})}catch(h){this.handleError(h,a)}}removeParticipantAsync(i,o,a){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&i.hasOwnProperty("id"))t.marshalPromiseToCallbacks(this.removeParticipantImplAsync(i),o,a);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),a);let h="";typeof i=="string"?h=i:i.hasOwnProperty("id")?h=i.id:i.hasOwnProperty("userId")&&(h=i.userId),n.Contracts.throwIfNullOrWhitespace(h,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(l=>l.id===h)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(h),()=>{this.handleCallback(o,a)},l=>{this.handleError(l,a)})}}catch(h){this.handleError(h,a)}}unlockMeetingAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}unmuteAllParticipantsAsync(i,o){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(i,o)},a=>{this.handleError(a,o)})}catch(a){this.handleError(a,o)}}unmuteParticipantAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),!this.me.isHost&&this.me.id!==i&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),a),this.privParticipants.getParticipantIndex(i)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(i,!1),()=>{this.handleCallback(o,a)},d=>{this.handleError(d,a)})}catch(h){this.handleError(h,a)}}sendTextMessageAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),i.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}setTranslatedLanguagesAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}changeNicknameAsync(i,o,a){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),a),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(i),()=>{this.handleCallback(o,a)},h=>{this.handleError(h,a)})}catch(h){this.handleError(h,a)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}connectTranscriberRecognizer(i){return r(this,void 0,void 0,function*(){this.privTranscriberRecognizer&&(yield this.privTranscriberRecognizer.close()),yield i.enforceAudioGating(),this.privTranscriberRecognizer=i,this.privTranscriberRecognizer.meeting=this})}getKeepAlive(){const i=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:i,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(i){if(this.privParticipants.addOrUpdateParticipant(i)!==void 0&&this.privTranscriberRecognizer){const a=this.meetingInfo;return a.participants=[i],this.privTranscriberRecognizer.pushMeetingEvent(a,"join")}}removeParticipantImplAsync(i){this.privParticipants.deleteParticipant(i.id);const o=this.meetingInfo;return o.participants=[i],this.privTranscriberRecognizer.pushMeetingEvent(o,"leave")}close(i){var o;return r(this,void 0,void 0,function*(){try{this.privIsConnected=!1,yield(o=this.privConversationRecognizer)===null||o===void 0?void 0:o.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(a){throw a}i&&this.dispose()})}handleCallback(i,o){if(i){try{i()}catch(a){o&&o(a)}i=void 0}}handleError(i,o){if(o)if(i instanceof Error){const a=i;o(a.name+": "+a.message)}else o(i)}toParticipants(i){const o=this.privParticipants.participants.map(a=>this.toParticipant(a));return i?o:o.filter(a=>a.isHost===!1)}toParticipant(i){return new p.Participant(i.id,i.avatar,i.displayName,i.isHost,i.isMuted,i.isUsingTts,i.preferredLanguage,i.voice)}getMuteAllCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getMuteCommand(i,o){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(i,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:i,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getEjectCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(i,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:i,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getChangeNicknameCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(i,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:i,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:i})}getMessageCommand(i){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(i,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:i,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return Fe.MeetingImpl=c,Fe}var sr={},Pa;function mf(){if(Pa)return sr;Pa=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.MeetingTranscriptionCanceledEventArgs=void 0;const r=pi();class e extends r.CancellationEventArgsBase{}return sr.MeetingTranscriptionCanceledEventArgs=e,sr}var ar={},Ea;function Sf(){if(Ea)return ar;Ea=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(ar,"__esModule",{value:!0}),ar.MeetingTranscriber=void 0;const e=_(),t=I(),n=T,p=R(),u=ko();let c=class{constructor(i){this.privAudioConfig=i,this.privProperties=new p.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(p.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return p.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(i){n.Contracts.throwIfNullOrWhitespace(i,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,i)}joinMeetingAsync(i,o,a){const h=i;n.Contracts.throwIfNullOrUndefined(u.MeetingImpl,"Meeting"),this.privRecognizer=new e.TranscriberRecognizer(i.config,this.privAudioConfig),n.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),t.marshalPromiseToCallbacks(h.connectTranscriberRecognizer(this.privRecognizer),o,a)}startTranscribingAsync(i,o){this.privRecognizer.startContinuousRecognitionAsync(i,o)}stopTranscribingAsync(i,o){this.privRecognizer.stopContinuousRecognitionAsync(i,o)}leaveMeetingAsync(i,o){this.privRecognizer.disconnectCallbacks(),t.marshalPromiseToCallbacks(r(this,void 0,void 0,function*(){}),i,o)}close(i,o){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),t.marshalPromiseToCallbacks(this.dispose(!0),i,o)}dispose(i){return r(this,void 0,void 0,function*(){this.privDisposedRecognizer||(this.privRecognizer&&(yield this.privRecognizer.close(),this.privRecognizer=void 0),i&&(this.privDisposedRecognizer=!0))})}};return ar.MeetingTranscriber=c,ar}var cr={},_a;function Cf(){if(_a)return cr;_a=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.ConversationTranscriptionResult=void 0;const r=R();let e=class extends r.RecognitionResult{constructor(n,p,u,c,s,i,o,a,h,d,l){super(n,p,u,c,s,i,o,h,d,l),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}};return cr.ConversationTranscriptionResult=e,cr}var Ia;function ko(){return Ia||(Ia=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Lu();Object.defineProperty(r,"Conversation",{enumerable:!0,get:function(){return e.Conversation}}),Object.defineProperty(r,"ConversationImpl",{enumerable:!0,get:function(){return e.ConversationImpl}});var t=fn;Object.defineProperty(r,"ConversationCommon",{enumerable:!0,get:function(){return t.ConversationCommon}});var n=sf();Object.defineProperty(r,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return n.ConversationExpirationEventArgs}});var p=af();Object.defineProperty(r,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return p.ConversationParticipantsChangedEventArgs}});var u=cf();Object.defineProperty(r,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return u.ConversationTranslationCanceledEventArgs}});var c=uf();Object.defineProperty(r,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return c.ConversationTranslationEventArgs}});var s=pf();Object.defineProperty(r,"ConversationTranslationResult",{enumerable:!0,get:function(){return s.ConversationTranslationResult}});var i=lf();Object.defineProperty(r,"ConversationTranslator",{enumerable:!0,get:function(){return i.ConversationTranslator}});var o=vf();Object.defineProperty(r,"ConversationTranscriber",{enumerable:!0,get:function(){return o.ConversationTranscriber}});var a=ff();Object.defineProperty(r,"Participant",{enumerable:!0,get:function(){return a.Participant}}),Object.defineProperty(r,"User",{enumerable:!0,get:function(){return a.User}});var h=qu;Object.defineProperty(r,"ParticipantChangedReason",{enumerable:!0,get:function(){return h.ParticipantChangedReason}});var d=gf();Object.defineProperty(r,"Meeting",{enumerable:!0,get:function(){return d.Meeting}}),Object.defineProperty(r,"MeetingImpl",{enumerable:!0,get:function(){return d.MeetingImpl}});var l=mf();Object.defineProperty(r,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return l.MeetingTranscriptionCanceledEventArgs}});var v=Sf();Object.defineProperty(r,"MeetingTranscriber",{enumerable:!0,get:function(){return v.MeetingTranscriber}});var f=Cf();Object.defineProperty(r,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return f.ConversationTranscriptionResult}})}(io)),io}var Ue={},Ta;function zo(){if(Ta)return Ue;Ta=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.SynthesisRequest=Ue.Synthesizer=void 0;const e=_(),t=I(),n=T,p=R();let u=class Fu{constructor(i){const o=i;n.Contracts.throwIfNull(o,"speechConfig"),this.privProperties=o.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new t.Queue}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(i){n.Contracts.throwIfNullOrWhitespace(i,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,i)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(p.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===e.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(i){const o={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-JennyNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let a=this.properties.getProperty(p.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),h=this.properties.getProperty(p.PropertyId.SpeechServiceConnection_SynthVoice,""),d=Fu.XMLEncode(i);return this.autoDetectSourceLanguage?a="en-US":h=h||o[a],h&&(d=`<voice name='${h}'>${d}</voice>`),d=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${a}'>${d}</speak>`,d}dispose(i){return r(this,void 0,void 0,function*(){this.privDisposed||(i&&this.privAdapter&&(yield this.privAdapter.dispose()),this.privDisposed=!0)})}adapterSpeak(){return r(this,void 0,void 0,function*(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const i=yield this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(i.text,i.isSSML,i.requestId,i.cb,i.err,i.dataStream)}})}createSynthesizerConfig(i){return new e.SynthesizerConfig(i,this.privProperties)}implCommonSynthesizeSetup(){let i=typeof window<"u"?"Browser":"Node",o="unknown",a="unknown";typeof navigator<"u"&&(i=i+"/"+navigator.platform,o=navigator.userAgent,a=navigator.appVersion);const h=this.createSynthesizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(i,o,a)))),d=this.privProperties.getProperty(p.PropertyId.SpeechServiceConnection_Key,void 0),l=d&&d!==""?new e.CognitiveSubscriptionKeyAuthentication(d):new e.CognitiveTokenAuthentication(()=>{const v=this.privProperties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(v)},()=>{const v=this.privProperties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(v)});this.privAdapter=this.createSynthesisAdapter(l,this.privConnectionFactory,h),this.privRestAdapter=this.createRestSynthesisAdapter(l,h)}static XMLEncode(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};Ue.Synthesizer=u;class c{constructor(i,o,a,h,d,l){this.requestId=i,this.text=o,this.isSSML=a,this.cb=h,this.err=d,this.dataStream=l}}return Ue.SynthesisRequest=c,Ue}var ur={},Aa;function yf(){if(Aa)return ur;Aa=1;var r=C&&C.__awaiter||function(a,h,d,l){function v(f){return f instanceof d?f:new d(function(m){m(f)})}return new(d||(d=Promise))(function(f,m){function g(E){try{y(l.next(E))}catch(P){m(P)}}function S(E){try{y(l.throw(E))}catch(P){m(P)}}function y(E){E.done?f(E.value):v(E.value).then(g,S)}y((l=l.apply(a,h||[])).next())})};Object.defineProperty(ur,"__esModule",{value:!0}),ur.SpeechSynthesizer=void 0;const e=_(),t=I(),n=ui,p=De,u=$,c=T,s=R(),i=zo();let o=class Uu extends s.Synthesizer{constructor(h,d){super(h),d!==null&&(d===void 0?this.audioConfig=typeof window>"u"?void 0:s.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=d),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(h,d,l){const v=h;return d.properties.mergeTo(v.properties),new Uu(h,l)}speakTextAsync(h,d,l,v){this.speakImpl(h,!1,d,l,v)}speakSsmlAsync(h,d,l,v){this.speakImpl(h,!0,d,l,v)}getVoicesAsync(h=""){return r(this,void 0,void 0,function*(){return this.getVoices(h)})}close(h,d){c.Contracts.throwIfDisposed(this.privDisposed),t.marshalPromiseToCallbacks(this.dispose(!0),h,d)}get internalData(){return this.privAdapter}createSynthesisAdapter(h,d,l){return new e.SpeechSynthesisAdapter(h,d,l,this,this.audioConfig)}createRestSynthesisAdapter(h,d){return new e.SynthesisRestAdapter(d,h)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=p.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(s.SpeechSynthesisOutputFormat[this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(h,d,l,v,f){try{c.Contracts.throwIfDisposed(this.privDisposed);const m=t.createNoDashGuid();let g;f instanceof s.PushAudioOutputStreamCallback?g=new u.PushAudioOutputStreamImpl(f):f instanceof s.PullAudioOutputStream?g=f:f!==void 0?g=new n.AudioFileWriter(f):g=void 0,this.synthesisRequestQueue.enqueue(new i.SynthesisRequest(m,h,d,S=>{if(this.privSynthesizing=!1,l)try{l(S)}catch(y){v&&v(y)}l=void 0,this.adapterSpeak().catch(()=>{})},S=>{v&&v(S)},g)),this.adapterSpeak().catch(()=>{})}catch(m){if(v)if(m instanceof Error){const g=m;v(g.name+": "+g.message)}else v(m);this.dispose(!0).catch(()=>{})}}getVoices(h){return r(this,void 0,void 0,function*(){const d=t.createNoDashGuid(),l=yield this.privRestAdapter.getVoicesList(d);if(l.ok&&Array.isArray(l.json)){let v=l.json;return h&&h.length>0&&(v=v.filter(f=>!!f.Locale&&f.Locale.toLowerCase()===h.toLowerCase())),new s.SynthesisVoicesResult(d,v,void 0)}else return new s.SynthesisVoicesResult(d,void 0,`Error: ${l.status}: ${l.statusText}`)})}};return ur.SpeechSynthesizer=o,ur}var gn={};Object.defineProperty(gn,"__esModule",{value:!0});gn.SynthesisResult=void 0;class Rf{constructor(e,t,n,p){this.privResultId=e,this.privReason=t,this.privErrorDetails=n,this.privProperties=p}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}gn.SynthesisResult=Rf;var pr={},wa;function Pf(){if(wa)return pr;wa=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.SpeechSynthesisResult=void 0;const r=R();let e=class extends r.SynthesisResult{constructor(n,p,u,c,s,i){super(n,p,c,s),this.privAudioData=u,this.privAudioDuration=i}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};return pr.SpeechSynthesisResult=e,pr}var mn={};Object.defineProperty(mn,"__esModule",{value:!0});mn.SpeechSynthesisEventArgs=void 0;class Ef{constructor(e){this.privResult=e}get result(){return this.privResult}}mn.SpeechSynthesisEventArgs=Ef;var Sn={};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.SpeechSynthesisWordBoundaryEventArgs=void 0;class _f{constructor(e,t,n,p,u,c){this.privAudioOffset=e,this.privDuration=t,this.privText=n,this.privWordLength=p,this.privTextOffset=u,this.privBoundaryType=c}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}Sn.SpeechSynthesisWordBoundaryEventArgs=_f;var Cn={};Object.defineProperty(Cn,"__esModule",{value:!0});Cn.SpeechSynthesisBookmarkEventArgs=void 0;class If{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}Cn.SpeechSynthesisBookmarkEventArgs=If;var yn={};Object.defineProperty(yn,"__esModule",{value:!0});yn.SpeechSynthesisVisemeEventArgs=void 0;class Tf{constructor(e,t,n){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=n}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}yn.SpeechSynthesisVisemeEventArgs=Tf;var $u={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SpeechSynthesisBoundaryType=void 0,function(e){e.Word="WordBoundary",e.Punctuation="PunctuationBoundary",e.Sentence="SentenceBoundary"}(r.SpeechSynthesisBoundaryType||(r.SpeechSynthesisBoundaryType={}))})($u);var dr={},ba;function Af(){if(ba)return dr;ba=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.SynthesisVoicesResult=void 0;const r=R();let e=class extends r.SynthesisResult{constructor(n,p,u){if(Array.isArray(p)){super(n,r.ResultReason.VoicesListRetrieved,void 0,new r.PropertyCollection),this.privVoices=[];for(const c of p)this.privVoices.push(new r.VoiceInfo(c))}else super(n,r.ResultReason.Canceled,u||"Error information unavailable",new r.PropertyCollection)}get voices(){return this.privVoices}};return dr.SynthesisVoicesResult=e,dr}var Wu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.VoiceInfo=r.SynthesisVoiceType=r.SynthesisVoiceGender=void 0;var e;(function(p){p[p.Unknown=0]="Unknown",p[p.Female=1]="Female",p[p.Male=2]="Male"})(e=r.SynthesisVoiceGender||(r.SynthesisVoiceGender={}));var t;(function(p){p[p.OnlineNeural=1]="OnlineNeural",p[p.OnlineStandard=2]="OnlineStandard",p[p.OfflineNeural=3]="OfflineNeural",p[p.OfflineStandard=4]="OfflineStandard"})(t=r.SynthesisVoiceType||(r.SynthesisVoiceType={}));class n{constructor(u){if(this.privStyleList=[],this.privVoicePath="",u&&(this.privName=u.Name,this.privLocale=u.Locale,this.privShortName=u.ShortName,this.privLocaleName=u.LocaleName,this.privDisplayName=u.DisplayName,this.privLocalName=u.LocalName,this.privVoiceType=u.VoiceType.endsWith("Standard")?t.OnlineStandard:t.OnlineNeural,this.privGender=u.Gender==="Male"?e.Male:u.Gender==="Female"?e.Female:e.Unknown,u.StyleList&&Array.isArray(u.StyleList)))for(const c of u.StyleList)this.privStyleList.push(c)}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get voicePath(){return this.privVoicePath}}r.VoiceInfo=n})(Wu);var Rn={},oo=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(Rn,"__esModule",{value:!0});Rn.SpeakerAudioDestination=void 0;const $e=I(),wf=$,se=Me,bf=60*30,Oa={[se.AudioFormatTag.PCM]:"audio/wav",[se.AudioFormatTag.MuLaw]:"audio/x-wav",[se.AudioFormatTag.MP3]:"audio/mpeg",[se.AudioFormatTag.OGG_OPUS]:"audio/ogg",[se.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[se.AudioFormatTag.ALaw]:"audio/x-wav",[se.AudioFormatTag.FLAC]:"audio/flac"};class Of{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||$e.createNoDashGuid(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,n){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{t&&t()},p=>{n&&n(p)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,t){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{e&&e()},n=>{t&&t(n)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===se.AudioFormatTag.PCM||this.privFormat.formatTag===se.AudioFormatTag.MuLaw||this.privFormat.formatTag===se.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let n=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(n).then(()=>{n=this.privFormat.addHeader(n);const p=new Blob([n],{type:Oa[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(p),this.notifyPlayback().then(()=>{e&&e()},u=>{t&&t(u)})},p=>{t&&t(p)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=e;const t=Oa[this.privFormat.formatTag];t===void 0?console.warn(`Unknown mimeType for format ${se.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(t)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=bf,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(t),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(n=>{$e.Events.instance.onEvent(new $e.BackgroundEvent(n))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(n=>{$e.Events.instance.onEvent(new $e.BackgroundEvent(n))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(n=>{$e.Events.instance.onEvent(new $e.BackgroundEvent(n))})):(console.warn(`Format ${se.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new wf.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e,t;return(t=(e=this.privAudio)===null||e===void 0?void 0:e.volume)!==null&&t!==void 0?t:-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{e&&e()},n=>{t&&t(n)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}updateSourceBuffer(){return oo(this,void 0,void 0,function*(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch{this.privAudioBuffer.unshift(e),console.log("buffer filled, pausing addition of binaries until space is made");return}yield this.notifyPlayback()}else this.canEndStream()&&(yield this.handleSourceBufferUpdateEnd())})}handleSourceBufferUpdateEnd(){return oo(this,void 0,void 0,function*(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),yield this.notifyPlayback())})}notifyPlayback(){return oo(this,void 0,void 0,function*(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||(yield this.privAudio.play()))})}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}}Rn.SpeakerAudioDestination=Of;var hr={},Ma;function Mf(){if(Ma)return hr;Ma=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.ConversationTranscriptionCanceledEventArgs=void 0;const r=pi();let e=class extends r.CancellationEventArgsBase{};return hr.ConversationTranscriptionCanceledEventArgs=e,hr}var lr={},Da;function Df(){if(Da)return lr;Da=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.MeetingTranscriptionCanceledEventArgs=void 0;const r=pi();let e=class extends r.CancellationEventArgsBase{};return lr.MeetingTranscriptionCanceledEventArgs=e,lr}var Hu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PronunciationAssessmentGradingSystem=void 0,function(e){e[e.FivePoint=1]="FivePoint",e[e.HundredMark=2]="HundredMark"}(r.PronunciationAssessmentGradingSystem||(r.PronunciationAssessmentGradingSystem={}))})(Hu);var Vu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PronunciationAssessmentGranularity=void 0,function(e){e[e.Phoneme=1]="Phoneme",e[e.Word=2]="Word",e[e.FullText=3]="FullText"}(r.PronunciationAssessmentGranularity||(r.PronunciationAssessmentGranularity={}))})(Vu);var vr={},ka;function kf(){if(ka)return vr;ka=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.PronunciationAssessmentConfig=void 0;const r=T,e=R();let t=class Ku{constructor(p,u=e.PronunciationAssessmentGradingSystem.FivePoint,c=e.PronunciationAssessmentGranularity.Phoneme,s=!1){r.Contracts.throwIfNullOrUndefined(p,"referenceText"),this.privProperties=new e.PropertyCollection,this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,p),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_GradingSystem,e.PronunciationAssessmentGradingSystem[u]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Granularity,e.PronunciationAssessmentGranularity[c]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,String(s))}static fromJSON(p){r.Contracts.throwIfNullOrUndefined(p,"json");const u=new Ku("");return u.privProperties=new e.PropertyCollection,u.properties.setProperty(e.PropertyId.PronunciationAssessment_Json,p),u}toJSON(){return this.updateJson(),this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Params)}applyTo(p){this.updateJson();const u=p.internalData;u.expectContentAssessmentResponse=!!this.privContentAssessmentTopic,u.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(e.PropertyId.PronunciationAssessment_Params),this.privContentAssessmentTopic,u.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(p){r.Contracts.throwIfNullOrWhitespace(p,"referenceText"),this.properties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,p)}set phonemeAlphabet(p){r.Contracts.throwIfNullOrWhitespace(p,"phonemeAlphabet"),this.privPhonemeAlphabet=p}set enableMiscue(p){const u=p?"true":"false";this.properties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,u)}get enableMiscue(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(p){this.privNBestPhonemeCount=p}set enableProsodyAssessment(p){this.privEnableProsodyAssessment=p}enableContentAssessmentWithTopic(p){this.privContentAssessmentTopic=p}get properties(){return this.privProperties}updateJson(){const p=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Json,"{}"),u=JSON.parse(p),c=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText);c&&(u.referenceText=c);const s=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_GradingSystem);s&&(u.gradingSystem=s);const i=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Granularity);i&&(u.granularity=i),this.privPhonemeAlphabet&&(u.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(u.nbestPhonemeCount=this.privNBestPhonemeCount),u.enableProsodyAssessment=this.privEnableProsodyAssessment,u.dimension="Comprehensive",this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue)&&(u.enableMiscue=this.enableMiscue),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Params,JSON.stringify(u))}};return vr.PronunciationAssessmentConfig=t,vr}var We={},za;function zf(){if(za)return We;za=1,Object.defineProperty(We,"__esModule",{value:!0}),We.PronunciationAssessmentResult=We.ContentAssessmentResult=void 0;const r=T,e=R();class t{constructor(u){this.privPronJson=u}get grammarScore(){return this.privPronJson.ContentAssessment.GrammarScore}get vocabularyScore(){return this.privPronJson.ContentAssessment.VocabularyScore}get topicScore(){return this.privPronJson.ContentAssessment.TopicScore}}We.ContentAssessmentResult=t;let n=class Ju{constructor(u){const c=JSON.parse(u);r.Contracts.throwIfNullOrUndefined(c.NBest[0],"NBest"),this.privPronJson=c.NBest[0]}static fromResult(u){r.Contracts.throwIfNullOrUndefined(u,"result");const c=u.properties.getProperty(e.PropertyId.SpeechServiceResponse_JsonResult);return r.Contracts.throwIfNullOrUndefined(c,"json"),new Ju(c)}get detailResult(){return this.privPronJson}get accuracyScore(){var u;return(u=this.detailResult.PronunciationAssessment)===null||u===void 0?void 0:u.AccuracyScore}get pronunciationScore(){var u;return(u=this.detailResult.PronunciationAssessment)===null||u===void 0?void 0:u.PronScore}get completenessScore(){var u;return(u=this.detailResult.PronunciationAssessment)===null||u===void 0?void 0:u.CompletenessScore}get fluencyScore(){var u;return(u=this.detailResult.PronunciationAssessment)===null||u===void 0?void 0:u.FluencyScore}get prosodyScore(){var u;return(u=this.detailResult.PronunciationAssessment)===null||u===void 0?void 0:u.ProsodyScore}get contentAssessmentResult(){if(this.detailResult.ContentAssessment!==void 0)return new t(this.detailResult)}};return We.PronunciationAssessmentResult=n,We}var fr={},Na;function Nf(){if(Na)return fr;Na=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.AvatarConfig=void 0;const r=T,e=R();let t=class{constructor(p,u,c){this.privCustomized=!1,r.Contracts.throwIfNullOrWhitespace(p,"character"),this.character=p,this.style=u,c===void 0&&(c=new e.AvatarVideoFormat),this.videoFormat=c}get customized(){return this.privCustomized}set customized(p){this.privCustomized=p}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(p){this.privBackgroundColor=p}};return fr.AvatarConfig=t,fr}var Gu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.AvatarEventArgs=r.AvatarEventTypes=void 0,function(t){t.SwitchedToSpeaking="SwitchedToSpeaking",t.SwitchedToIdle="SwitchedToIdle",t.SessionClosed="SessionClosed"}(r.AvatarEventTypes||(r.AvatarEventTypes={}));class e{constructor(n,p){this.privOffset=n,this.privDescription=p}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}r.AvatarEventArgs=e})(Gu);var gr={},mr={},ja;function Qu(){if(ja)return mr;ja=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.SpeechSynthesisConnectionFactory=void 0;const r=F(),e=R(),t=de(),n=_(),p=q,u=pe;let c=class{constructor(){this.synthesisUri="/cognitiveservices/websocket/v1"}create(i,o,a){let h=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),l=t.ConnectionFactoryBase.getHostSuffix(d),v=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),f=v===void 0?"tts":"voice",m=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+d+"."+f+".speech"+l),g={},S={};o.token!==void 0&&o.token!==""&&(S[o.headerName]=o.token),S[p.HeaderNames.ConnectionId]=a,v!==void 0&&v!==""&&(!h||h.search(u.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(g[u.QueryParameterNames.CustomVoiceDeploymentId]=v),i.avatarEnabled&&(!h||h.search(u.QueryParameterNames.EnableAvatar)===-1)&&(g[u.QueryParameterNames.EnableAvatar]="true"),h||(h=m+this.synthesisUri),i.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const y=i.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(h,g,S,new n.WebsocketMessageFormatter,r.ProxyInfo.fromParameters(i.parameters),y,a)}};return mr.SpeechSynthesisConnectionFactory=c,mr}var La;function jf(){if(La)return gr;La=1;var r=C&&C.__awaiter||function(o,a,h,d){function l(v){return v instanceof h?v:new h(function(f){f(v)})}return new(h||(h=Promise))(function(v,f){function m(y){try{S(d.next(y))}catch(E){f(E)}}function g(y){try{S(d.throw(y))}catch(E){f(E)}}function S(y){y.done?v(y.value):l(y.value).then(m,g)}S((d=d.apply(o,a||[])).next())})};Object.defineProperty(gr,"__esModule",{value:!0}),gr.AvatarSynthesizer=void 0;const e=Qu(),t=_(),n=I(),p=De,u=R(),c=T,s=zo();let i=class extends u.Synthesizer{constructor(a,h){super(a),c.Contracts.throwIfNullOrUndefined(h,"avatarConfig"),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.privAvatarConfig=h,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=p.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(u.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}startAvatarAsync(a){return r(this,void 0,void 0,function*(){c.Contracts.throwIfNullOrUndefined(a,"peerConnection"),this.privIceServers=a.getConfiguration().iceServers,c.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const h=new n.Deferred;a.onicegatheringstatechange=()=>{n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering state: "+a.iceGatheringState,n.EventType.Debug)),a.iceGatheringState==="complete"&&(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering complete.",n.EventType.Info)),h.resolve())};const d=yield a.createOffer();yield a.setLocalDescription(d),yield h.promise,n.Events.instance.onEvent(new n.PlatformEvent("peer connection: got local SDP.",n.EventType.Info)),this.privProperties.setProperty(u.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(a.localDescription));const l=yield this.speak("",!1);if(l.reason!==u.ResultReason.SynthesizingAudioCompleted)return new u.SynthesisResult(l.resultId,l.reason,l.errorDetails,l.properties);const v=atob(l.properties.getProperty(u.PropertyId.TalkingAvatarService_WebRTC_SDP)),f=new RTCSessionDescription(JSON.parse(v));return yield a.setRemoteDescription(f),new u.SynthesisResult(l.resultId,l.reason,void 0,l.properties)})}speakTextAsync(a){return r(this,void 0,void 0,function*(){const h=yield this.speak(a,!1);return new u.SynthesisResult(h.resultId,h.reason,h.errorDetails,h.properties)})}speakSsmlAsync(a){return r(this,void 0,void 0,function*(){const h=yield this.speak(a,!0);return new u.SynthesisResult(h.resultId,h.reason,h.errorDetails,h.properties)})}stopSpeakingAsync(){return r(this,void 0,void 0,function*(){for(;this.synthesisRequestQueue.length()>0;)(yield this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()})}stopAvatarAsync(){return r(this,void 0,void 0,function*(){return c.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)})}close(){return r(this,void 0,void 0,function*(){if(!this.privDisposed)return this.dispose(!0)})}get iceServers(){return this.privIceServers}createSynthesisAdapter(a,h,d){return new t.AvatarSynthesisAdapter(a,h,d,this,this.privAvatarConfig)}createRestSynthesisAdapter(a,h){}createSynthesizerConfig(a){const h=super.createSynthesizerConfig(a);return h.avatarEnabled=!0,h}speak(a,h){return r(this,void 0,void 0,function*(){const d=n.createNoDashGuid(),l=new n.Deferred;return this.synthesisRequestQueue.enqueue(new s.SynthesisRequest(d,a,h,v=>{l.resolve(v),this.privSynthesizing=!1,this.adapterSpeak()},v=>{l.reject(v),this.privSynthesizing=!1})),this.adapterSpeak(),l.promise})}};return gr.AvatarSynthesizer=i,gr}var it={};Object.defineProperty(it,"__esModule",{value:!0});it.AvatarVideoFormat=it.Coordinate=void 0;class Lf{constructor(e,t){this.x=e,this.y=t}}it.Coordinate=Lf;class xf{constructor(e="H264",t=2e6,n=1920,p=1080){this.codec=e,this.bitrate=t,this.width=n,this.height=p}setCropRange(e,t){this.cropRange={bottomRight:t,topLeft:e}}}it.AvatarVideoFormat=xf;var Sr={},xa;function Bf(){if(xa)return Sr;xa=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.AvatarWebRTCConnectionResult=void 0;const r=R();let e=class extends r.SynthesisResult{constructor(n,p,u,c,s){super(p,u,c,s),this.privSDPAnswer=n}get SDPAnswer(){return this.privSDPAnswer}};return Sr.AvatarWebRTCConnectionResult=e,Sr}var Cr={},Ba;function qf(){if(Ba)return Cr;Ba=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.Diagnostics=void 0;const r=F(),e=I();let t=class{static SetLoggingLevel(p){this.privListener=new r.ConsoleLoggingListener(p),e.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(p){if(typeof window>"u")this.privListener&&(this.privListener.logPath=p);else throw new Error("File system logging not available in browser.")}};return Cr.Diagnostics=t,t.privListener=void 0,Cr}var qa;function R(){return qa||(qa=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=vu();Object.defineProperty(r,"AudioConfig",{enumerable:!0,get:function(){return e.AudioConfig}});var t=Me;Object.defineProperty(r,"AudioStreamFormat",{enumerable:!0,get:function(){return t.AudioStreamFormat}}),Object.defineProperty(r,"AudioFormatTag",{enumerable:!0,get:function(){return t.AudioFormatTag}});var n=uu();Object.defineProperty(r,"AudioInputStream",{enumerable:!0,get:function(){return n.AudioInputStream}}),Object.defineProperty(r,"PullAudioInputStream",{enumerable:!0,get:function(){return n.PullAudioInputStream}}),Object.defineProperty(r,"PushAudioInputStream",{enumerable:!0,get:function(){return n.PushAudioInputStream}});var p=$;Object.defineProperty(r,"AudioOutputStream",{enumerable:!0,get:function(){return p.AudioOutputStream}}),Object.defineProperty(r,"PullAudioOutputStream",{enumerable:!0,get:function(){return p.PullAudioOutputStream}}),Object.defineProperty(r,"PushAudioOutputStream",{enumerable:!0,get:function(){return p.PushAudioOutputStream}});var u=fu;Object.defineProperty(r,"CancellationReason",{enumerable:!0,get:function(){return u.CancellationReason}});var c=Xi;Object.defineProperty(r,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return c.PullAudioInputStreamCallback}});var s=Yi;Object.defineProperty(r,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return s.PushAudioOutputStreamCallback}});var i=en;Object.defineProperty(r,"KeywordRecognitionModel",{enumerable:!0,get:function(){return i.KeywordRecognitionModel}});var o=tn;Object.defineProperty(r,"SessionEventArgs",{enumerable:!0,get:function(){return o.SessionEventArgs}});var a=vv();Object.defineProperty(r,"RecognitionEventArgs",{enumerable:!0,get:function(){return a.RecognitionEventArgs}});var h=gu;Object.defineProperty(r,"OutputFormat",{enumerable:!0,get:function(){return h.OutputFormat}});var d=fv();Object.defineProperty(r,"IntentRecognitionEventArgs",{enumerable:!0,get:function(){return d.IntentRecognitionEventArgs}});var l=rn;Object.defineProperty(r,"RecognitionResult",{enumerable:!0,get:function(){return l.RecognitionResult}});var v=mv();Object.defineProperty(r,"SpeechRecognitionResult",{enumerable:!0,get:function(){return v.SpeechRecognitionResult}});var f=Sv();Object.defineProperty(r,"IntentRecognitionResult",{enumerable:!0,get:function(){return f.IntentRecognitionResult}});var m=rt;Object.defineProperty(r,"LanguageUnderstandingModel",{enumerable:!0,get:function(){return m.LanguageUnderstandingModel}});var g=Cv();Object.defineProperty(r,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return g.SpeechRecognitionEventArgs}}),Object.defineProperty(r,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return g.ConversationTranscriptionEventArgs}}),Object.defineProperty(r,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return g.MeetingTranscriptionEventArgs}});var S=yv();Object.defineProperty(r,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return S.SpeechRecognitionCanceledEventArgs}});var y=Rv();Object.defineProperty(r,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return y.TranslationRecognitionEventArgs}});var E=Pv();Object.defineProperty(r,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return E.TranslationSynthesisEventArgs}});var P=Cu();Object.defineProperty(r,"TranslationRecognitionResult",{enumerable:!0,get:function(){return P.TranslationRecognitionResult}});var b=nn;Object.defineProperty(r,"TranslationSynthesisResult",{enumerable:!0,get:function(){return b.TranslationSynthesisResult}});var O=yu;Object.defineProperty(r,"ResultReason",{enumerable:!0,get:function(){return O.ResultReason}});var z=_v();Object.defineProperty(r,"SpeechConfig",{enumerable:!0,get:function(){return z.SpeechConfig}}),Object.defineProperty(r,"SpeechConfigImpl",{enumerable:!0,get:function(){return z.SpeechConfigImpl}});var N=Iv();Object.defineProperty(r,"SpeechTranslationConfig",{enumerable:!0,get:function(){return N.SpeechTranslationConfig}}),Object.defineProperty(r,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return N.SpeechTranslationConfigImpl}});var ye=Pu();Object.defineProperty(r,"PropertyCollection",{enumerable:!0,get:function(){return ye.PropertyCollection}});var dt=on;Object.defineProperty(r,"PropertyId",{enumerable:!0,get:function(){return dt.PropertyId}});var fi=Tv();Object.defineProperty(r,"Recognizer",{enumerable:!0,get:function(){return fi.Recognizer}});var gi=Av();Object.defineProperty(r,"SpeechRecognizer",{enumerable:!0,get:function(){return gi.SpeechRecognizer}});var ie=wv();Object.defineProperty(r,"IntentRecognizer",{enumerable:!0,get:function(){return ie.IntentRecognizer}});var Go=Iu;Object.defineProperty(r,"VoiceProfileType",{enumerable:!0,get:function(){return Go.VoiceProfileType}});var lp=bv();Object.defineProperty(r,"TranslationRecognizer",{enumerable:!0,get:function(){return lp.TranslationRecognizer}});var vp=Ov();Object.defineProperty(r,"Translations",{enumerable:!0,get:function(){return vp.Translations}});var fp=bu;Object.defineProperty(r,"NoMatchReason",{enumerable:!0,get:function(){return fp.NoMatchReason}});var gp=Mv();Object.defineProperty(r,"NoMatchDetails",{enumerable:!0,get:function(){return gp.NoMatchDetails}});var mp=sn;Object.defineProperty(r,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return mp.TranslationRecognitionCanceledEventArgs}});var Sp=kv();Object.defineProperty(r,"IntentRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return Sp.IntentRecognitionCanceledEventArgs}});var Cp=di;Object.defineProperty(r,"CancellationDetailsBase",{enumerable:!0,get:function(){return Cp.CancellationDetailsBase}});var yp=Nv();Object.defineProperty(r,"CancellationDetails",{enumerable:!0,get:function(){return yp.CancellationDetails}});var Rp=Du;Object.defineProperty(r,"CancellationErrorCode",{enumerable:!0,get:function(){return Rp.CancellationErrorCode}});var Pp=jv();Object.defineProperty(r,"ConnectionEventArgs",{enumerable:!0,get:function(){return Pp.ConnectionEventArgs}});var Ep=Lv();Object.defineProperty(r,"ServiceEventArgs",{enumerable:!0,get:function(){return Ep.ServiceEventArgs}});var _p=Au();Object.defineProperty(r,"Connection",{enumerable:!0,get:function(){return _p.Connection}});var Ip=an;Object.defineProperty(r,"PhraseListGrammar",{enumerable:!0,get:function(){return Ip.PhraseListGrammar}});var Tp=bo();Object.defineProperty(r,"DialogServiceConfig",{enumerable:!0,get:function(){return Tp.DialogServiceConfig}});var Ap=xv();Object.defineProperty(r,"BotFrameworkConfig",{enumerable:!0,get:function(){return Ap.BotFrameworkConfig}});var wp=Bv();Object.defineProperty(r,"CustomCommandsConfig",{enumerable:!0,get:function(){return wp.CustomCommandsConfig}});var bp=Fv();Object.defineProperty(r,"DialogServiceConnector",{enumerable:!0,get:function(){return bp.DialogServiceConnector}});var Op=cn;Object.defineProperty(r,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return Op.ActivityReceivedEventArgs}});var Mp=un;Object.defineProperty(r,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return Mp.TurnStatusReceivedEventArgs}});var Dp=ku;Object.defineProperty(r,"ServicePropertyChannel",{enumerable:!0,get:function(){return Dp.ServicePropertyChannel}});var kp=zu;Object.defineProperty(r,"ProfanityOption",{enumerable:!0,get:function(){return kp.ProfanityOption}});var zp=Hv();Object.defineProperty(r,"BaseAudioPlayer",{enumerable:!0,get:function(){return zp.BaseAudioPlayer}});var Np=dn;Object.defineProperty(r,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return Np.ConnectionMessageEventArgs}});var jp=Tu();Object.defineProperty(r,"ConnectionMessage",{enumerable:!0,get:function(){return jp.ConnectionMessage}});var Lp=hn;Object.defineProperty(r,"VoiceProfile",{enumerable:!0,get:function(){return Lp.VoiceProfile}});var Qo=Jv();Object.defineProperty(r,"VoiceProfileEnrollmentResult",{enumerable:!0,get:function(){return Qo.VoiceProfileEnrollmentResult}}),Object.defineProperty(r,"VoiceProfileEnrollmentCancellationDetails",{enumerable:!0,get:function(){return Qo.VoiceProfileEnrollmentCancellationDetails}});var Zo=Gv();Object.defineProperty(r,"VoiceProfileResult",{enumerable:!0,get:function(){return Zo.VoiceProfileResult}}),Object.defineProperty(r,"VoiceProfileCancellationDetails",{enumerable:!0,get:function(){return Zo.VoiceProfileCancellationDetails}});var xp=Qv();Object.defineProperty(r,"VoiceProfilePhraseResult",{enumerable:!0,get:function(){return xp.VoiceProfilePhraseResult}});var Bp=Zv();Object.defineProperty(r,"VoiceProfileClient",{enumerable:!0,get:function(){return Bp.VoiceProfileClient}});var qp=Xv();Object.defineProperty(r,"SpeakerRecognizer",{enumerable:!0,get:function(){return qp.SpeakerRecognizer}});var Fp=Yv();Object.defineProperty(r,"SpeakerIdentificationModel",{enumerable:!0,get:function(){return Fp.SpeakerIdentificationModel}});var Up=ef();Object.defineProperty(r,"SpeakerVerificationModel",{enumerable:!0,get:function(){return Up.SpeakerVerificationModel}});var $p=tf();Object.defineProperty(r,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return $p.AutoDetectSourceLanguageConfig}});var Wp=ln;Object.defineProperty(r,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return Wp.AutoDetectSourceLanguageResult}});var Hp=vn;Object.defineProperty(r,"SourceLanguageConfig",{enumerable:!0,get:function(){return Hp.SourceLanguageConfig}});var Fn=nf();Object.defineProperty(r,"SpeakerRecognitionResult",{enumerable:!0,get:function(){return Fn.SpeakerRecognitionResult}}),Object.defineProperty(r,"SpeakerRecognitionResultType",{enumerable:!0,get:function(){return Fn.SpeakerRecognitionResultType}}),Object.defineProperty(r,"SpeakerRecognitionCancellationDetails",{enumerable:!0,get:function(){return Fn.SpeakerRecognitionCancellationDetails}});var te=ko();Object.defineProperty(r,"Conversation",{enumerable:!0,get:function(){return te.Conversation}}),Object.defineProperty(r,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return te.ConversationExpirationEventArgs}}),Object.defineProperty(r,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return te.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(r,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return te.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(r,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return te.ConversationTranslationEventArgs}}),Object.defineProperty(r,"ConversationTranslationResult",{enumerable:!0,get:function(){return te.ConversationTranslationResult}}),Object.defineProperty(r,"ConversationTranslator",{enumerable:!0,get:function(){return te.ConversationTranslator}}),Object.defineProperty(r,"ConversationTranscriber",{enumerable:!0,get:function(){return te.ConversationTranscriber}}),Object.defineProperty(r,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return te.ConversationTranscriptionResult}}),Object.defineProperty(r,"Meeting",{enumerable:!0,get:function(){return te.Meeting}}),Object.defineProperty(r,"MeetingTranscriber",{enumerable:!0,get:function(){return te.MeetingTranscriber}}),Object.defineProperty(r,"Participant",{enumerable:!0,get:function(){return te.Participant}}),Object.defineProperty(r,"ParticipantChangedReason",{enumerable:!0,get:function(){return te.ParticipantChangedReason}}),Object.defineProperty(r,"User",{enumerable:!0,get:function(){return te.User}});var Vp=zo();Object.defineProperty(r,"Synthesizer",{enumerable:!0,get:function(){return Vp.Synthesizer}});var Kp=Io;Object.defineProperty(r,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return Kp.SpeechSynthesisOutputFormat}});var Jp=yf();Object.defineProperty(r,"SpeechSynthesizer",{enumerable:!0,get:function(){return Jp.SpeechSynthesizer}});var Gp=gn;Object.defineProperty(r,"SynthesisResult",{enumerable:!0,get:function(){return Gp.SynthesisResult}});var Qp=Pf();Object.defineProperty(r,"SpeechSynthesisResult",{enumerable:!0,get:function(){return Qp.SpeechSynthesisResult}});var Zp=mn;Object.defineProperty(r,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return Zp.SpeechSynthesisEventArgs}});var Xp=Sn;Object.defineProperty(r,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return Xp.SpeechSynthesisWordBoundaryEventArgs}});var Yp=Cn;Object.defineProperty(r,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return Yp.SpeechSynthesisBookmarkEventArgs}});var ed=yn;Object.defineProperty(r,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return ed.SpeechSynthesisVisemeEventArgs}});var td=$u;Object.defineProperty(r,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return td.SpeechSynthesisBoundaryType}});var rd=Af();Object.defineProperty(r,"SynthesisVoicesResult",{enumerable:!0,get:function(){return rd.SynthesisVoicesResult}});var id=Wu;Object.defineProperty(r,"VoiceInfo",{enumerable:!0,get:function(){return id.VoiceInfo}});var nd=Rn;Object.defineProperty(r,"SpeakerAudioDestination",{enumerable:!0,get:function(){return nd.SpeakerAudioDestination}});var od=Mf();Object.defineProperty(r,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return od.ConversationTranscriptionCanceledEventArgs}});var sd=Df();Object.defineProperty(r,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return sd.MeetingTranscriptionCanceledEventArgs}});var ad=Hu;Object.defineProperty(r,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return ad.PronunciationAssessmentGradingSystem}});var cd=Vu;Object.defineProperty(r,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return cd.PronunciationAssessmentGranularity}});var ud=kf();Object.defineProperty(r,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return ud.PronunciationAssessmentConfig}});var pd=zf();Object.defineProperty(r,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return pd.PronunciationAssessmentResult}});var dd=Mo;Object.defineProperty(r,"LanguageIdMode",{enumerable:!0,get:function(){return dd.LanguageIdMode}});var hd=Nf();Object.defineProperty(r,"AvatarConfig",{enumerable:!0,get:function(){return hd.AvatarConfig}});var ld=Gu;Object.defineProperty(r,"AvatarEventArgs",{enumerable:!0,get:function(){return ld.AvatarEventArgs}});var vd=jf();Object.defineProperty(r,"AvatarSynthesizer",{enumerable:!0,get:function(){return vd.AvatarSynthesizer}});var Xo=it;Object.defineProperty(r,"AvatarVideoFormat",{enumerable:!0,get:function(){return Xo.AvatarVideoFormat}}),Object.defineProperty(r,"Coordinate",{enumerable:!0,get:function(){return Xo.Coordinate}});var fd=Bf();Object.defineProperty(r,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return fd.AvatarWebRTCConnectionResult}});var gd=qf();Object.defineProperty(r,"Diagnostics",{enumerable:!0,get:function(){return gd.Diagnostics}});var md=Eo;Object.defineProperty(r,"LogLevel",{enumerable:!0,get:function(){return md.LogLevel}})}(eo)),eo}var Fa;function Ff(){if(Fa)return St;Fa=1,Object.defineProperty(St,"__esModule",{value:!0}),St.ProxyInfo=void 0;const r=R();let e=class Zu{constructor(n,p,u,c){this.privProxyHostName=n,this.privProxyPort=p,this.privProxyUserName=u,this.privProxyPassword=c}static fromParameters(n){return new Zu(n.getProperty(r.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(n.getProperty(r.PropertyId.SpeechServiceConnection_ProxyPort),10),n.getProperty(r.PropertyId.SpeechServiceConnection_ProxyUserName),n.getProperty(r.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(n){return this.fromParameters(n.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};return St.ProxyInfo=e,St}var Xu={};const Uf=new Set(["json","buffer","string"]);var $f=r=>(...e)=>{const t=new Set;let n,p,u,c="";return e.forEach(s=>{if(typeof s=="string")if(s.toUpperCase()===s)if(n){const i=`Can't set method to ${s}, already set to ${n}.`;throw new Error(i)}else n=s;else if(s.startsWith("http:")||s.startsWith("https:"))c=s;else if(Uf.has(s))p=s;else throw new Error(`Unknown encoding, ${s}`);else if(typeof s=="number")t.add(s);else if(typeof s=="object")if(Array.isArray(s)||s instanceof Set)s.forEach(i=>t.add(i));else{if(u)throw new Error("Cannot set headers twice.");u=s}else throw new Error(`Unknown type: ${typeof s}`)}),n||(n="GET"),t.size===0&&t.add(200),r(t,n,p,u,c)};const Wf=$f;class No extends Error{constructor(e,...t){super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,No),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e);let n;Object.defineProperty(this,"responseBody",{get:()=>(n||(n=this.arrayBuffer()),n)}),this.headers={};for(const[u,c]of e.headers.entries())this.headers[u.toLowerCase()]=c}}const Hf=(r,e,t,n,p)=>async(u,c,s={})=>{u=p+(u||"");let i=new URL(u);if(n||(n={}),i.username&&(n.Authorization="Basic "+btoa(i.username+":"+i.password),i=new URL(i.protocol+"//"+i.host+i.pathname+i.search)),i.protocol!=="https:"&&i.protocol!=="http:")throw new Error(`Unknown protocol, ${i.protocol}`);if(c&&!(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="string"))if(typeof c=="object")c=JSON.stringify(c),n["Content-Type"]="application/json";else throw new Error("Unknown body type.");s=new Headers({...n||{},...s});const o=await fetch(i,{method:e,headers:s,body:c});if(o.statusCode=o.status,!r.has(o.status))throw new No(o);return t==="json"?o.json():t==="buffer"?o.arrayBuffer():t==="string"?o.text():o};var Vf=Wf(Hf);(function(r){var e=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})},t=C&&C.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(r,"__esModule",{value:!0}),r.RestMessageAdapter=r.RestRequestType=void 0;const n=t(Vf),p=I();var u;(function(s){s.Get="GET",s.Post="POST",s.Delete="DELETE",s.File="file"})(u=r.RestRequestType||(r.RestRequestType={}));class c{constructor(i){if(!i)throw new p.ArgumentNullError("configParams");this.privHeaders=i.headers,this.privIgnoreCache=i.ignoreCache}static extractHeaderValue(i,o){let a="";try{const h=o.trim().split(/[\r\n]+/),d={};h.forEach(l=>{const v=l.split(": "),f=v.shift().toLowerCase(),m=v.join(": ");d[f]=m}),a=d[i.toLowerCase()]}catch{}return a}set options(i){this.privHeaders=i.headers,this.privIgnoreCache=i.ignoreCache}setHeaders(i,o){this.privHeaders[i]=o}request(i,o,a={},h=null){const d=new p.Deferred,l=i===u.File?"POST":i,v=(m,g={})=>{const S=m;return{data:JSON.stringify(g),headers:JSON.stringify(m.headers),json:g,ok:m.statusCode>=200&&m.statusCode<300,status:m.statusCode,statusText:g.error?g.error.message:S.statusText?S.statusText:S.statusMessage}},f=m=>{const g=n.default(o,l,this.privHeaders,200,201,202,204,400,401,402,403,404),S=this.queryParams(a)===""?"":`?${this.queryParams(a)}`;g(S,m).then(y=>e(this,void 0,void 0,function*(){if(i===u.Delete||y.statusCode===204)d.resolve(v(y));else try{const E=yield y.json();d.resolve(v(y,E))}catch{d.resolve(v(y))}})).catch(y=>{d.reject(y)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),i===u.Post&&h&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),f(h),d.promise}queryParams(i={}){return Object.keys(i).map(o=>encodeURIComponent(o)+"="+encodeURIComponent(i[o])).join("&")}}r.RestMessageAdapter=c})(Xu);var li={};Object.defineProperty(li,"__esModule",{value:!0});li.RestConfigBase=void 0;class Ae{static get requestOptions(){return Ae.privDefaultRequestOptions}static get configParams(){return Ae.privDefaultParams}static get restErrors(){return Ae.privRestErrors}}li.RestConfigBase=Ae;Ae.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4};Ae.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."};Ae.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"};var Ua;function F(){return Ua||(Ua=1,function(r){var e=C&&C.__createBinding||(Object.create?function(n,p,u,c){c===void 0&&(c=u),Object.defineProperty(n,c,{enumerable:!0,get:function(){return p[u]}})}:function(n,p,u,c){c===void 0&&(c=u),n[c]=p[u]}),t=C&&C.__exportStar||function(n,p){for(var u in n)u!=="default"&&!p.hasOwnProperty(u)&&e(p,n,u)};Object.defineProperty(r,"__esModule",{value:!0}),t(Ji,r),t(au,r),t(ql(),r),t(Fl(),r),t(Gi,r),t(Qi,r),t(ci,r),t(Zi,r),t(Ff(),r),t(Xu,r),t(li,r)}(Zn)),Zn}var $a;function Kf(){if($a)return ft;$a=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.IntentConnectionFactory=void 0;const r=F(),e=R(),t=de(),n=_(),p=q;let u=class extends t.ConnectionFactoryBase{create(s,i,o){let a=s.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!a){const v=s.parameters.getProperty(e.PropertyId.SpeechServiceConnection_IntentRegion),f=t.ConnectionFactoryBase.getHostSuffix(v);a=s.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+v+".sr.speech"+f)+"/speech/recognition/interactive/cognitiveservices/v1"}const h={format:"simple",language:s.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(s,h,a);const d={};i.token!==void 0&&i.token!==""&&(d[i.headerName]=i.token),d[p.HeaderNames.ConnectionId]=o,s.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,a);const l=s.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(a,h,d,new n.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(s),l,o)}getSpeechRegionFromIntentRegion(s){switch(s){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return s}}};return ft.IntentConnectionFactory=u,ft}var He={},Wa;function Jf(){if(Wa)return He;Wa=1,Object.defineProperty(He,"__esModule",{value:!0}),He.VoiceProfileConnectionFactory=He.SpeakerRecognitionConnectionFactory=void 0;const r=F(),e=R(),t=de(),n=_(),p=q;class u extends t.ConnectionFactoryBase{create(o,a,h,d){let l=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!l){const g=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region),S=t.ConnectionFactoryBase.getHostSuffix(g),y=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`wss://${g}.spr-frontend.speech${S}`),E=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");l=`${y}/speaker/ws/${this.scenarioToPath(E)}/${h}`}const v={format:"simple",language:o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(o,v,l);const f={};a.token!==void 0&&a.token!==""&&(f[a.headerName]=a.token),f[p.HeaderNames.ConnectionId]=d,f[p.HeaderNames.SpIDAuthKey]=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Key),o.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,l);const m=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(l,v,f,new n.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),m,d)}scenarioToPath(o){switch(o){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}let c=class extends u{create(o,a,h){return super.create(o,a,"recognition",h)}};He.SpeakerRecognitionConnectionFactory=c;class s extends u{create(o,a,h){return super.create(o,a,"profile",h)}}return He.VoiceProfileConnectionFactory=s,He}var Pn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RecognitionEndedEvent=r.RecognitionCompletionStatus=r.RecognitionStartedEvent=r.ConnectingToServiceEvent=r.ListeningStartedEvent=r.RecognitionTriggeredEvent=r.SpeechRecognitionEvent=void 0;const e=I();class t extends e.PlatformEvent{constructor(a,h,d,l=e.EventType.Info){super(a,l),this.privRequestId=h,this.privSessionId=d}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}r.SpeechRecognitionEvent=t;class n extends t{constructor(a,h,d,l){super("RecognitionTriggeredEvent",a,h),this.privAudioSourceId=d,this.privAudioNodeId=l}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}r.RecognitionTriggeredEvent=n;class p extends t{constructor(a,h,d,l){super("ListeningStartedEvent",a,h),this.privAudioSourceId=d,this.privAudioNodeId=l}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}r.ListeningStartedEvent=p;class u extends t{constructor(a,h,d){super("ConnectingToServiceEvent",a,d),this.privAuthFetchEventid=h}get authFetchEventid(){return this.privAuthFetchEventid}}r.ConnectingToServiceEvent=u;class c extends t{constructor(a,h,d,l,v){super("RecognitionStartedEvent",a,v),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=l}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}r.RecognitionStartedEvent=c;var s;(function(o){o[o.Success=0]="Success",o[o.AudioSourceError=1]="AudioSourceError",o[o.AudioSourceTimeout=2]="AudioSourceTimeout",o[o.AuthTokenFetchError=3]="AuthTokenFetchError",o[o.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",o[o.UnAuthorized=5]="UnAuthorized",o[o.ConnectTimeout=6]="ConnectTimeout",o[o.ConnectError=7]="ConnectError",o[o.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",o[o.UnknownError=9]="UnknownError"})(s=r.RecognitionCompletionStatus||(r.RecognitionCompletionStatus={}));class i extends t{constructor(a,h,d,l,v,f,m,g){super("RecognitionEndedEvent",a,v,m===s.Success?e.EventType.Info:e.EventType.Error),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=l,this.privStatus=m,this.privError=g,this.privServiceTag=f}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}r.RecognitionEndedEvent=i})(Pn);var yr={},Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.SpeechConnectionMessage=void 0;const so=I(),ge=q;class jo extends so.ConnectionMessage{constructor(e,t,n,p,u,c,s,i){if(!t)throw new so.ArgumentNullError("path");if(!n)throw new so.ArgumentNullError("requestId");const o={};if(o[ge.HeaderNames.Path]=t,o[ge.HeaderNames.RequestId]=n,o[ge.HeaderNames.RequestTimestamp]=new Date().toISOString(),p&&(o[ge.HeaderNames.ContentType]=p),c&&(o[ge.HeaderNames.RequestStreamId]=c),s)for(const a in s)a&&(o[a]=s[a]);i?super(e,u,o,i):super(e,u,o),this.privPath=t,this.privRequestId=n,this.privContentType=p,this.privStreamId=c,this.privAdditionalHeaders=s}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let t=null,n=null,p=null,u=null;const c={};if(e.headers)for(const s in e.headers)s&&(s.toLowerCase()===ge.HeaderNames.Path.toLowerCase()?t=e.headers[s]:s.toLowerCase()===ge.HeaderNames.RequestId.toLowerCase()?n=e.headers[s]:s.toLowerCase()===ge.HeaderNames.ContentType.toLowerCase()?p=e.headers[s]:s.toLowerCase()===ge.HeaderNames.RequestStreamId.toLowerCase()?u=e.headers[s]:c[s]=e.headers[s]);return new jo(e.messageType,t,n,p,e.body,u,c,e.id)}}Ce.SpeechConnectionMessage=jo;var Ha;function Gf(){if(Ha)return yr;Ha=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(yr,"__esModule",{value:!0}),yr.ServiceRecognizerBase=void 0;const e=F(),t=I(),n=R(),p=_(),u=Ce;let c=class Zr{constructor(i,o,a,h,d){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!i)throw new t.ArgumentNullError("authentication");if(!o)throw new t.ArgumentNullError("connectionFactory");if(!a)throw new t.ArgumentNullError("audioSource");if(!h)throw new t.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=h.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=i,this.privConnectionFactory=o,this.privAudioSource=a,this.privRecognizerConfig=h,this.privIsDisposed=!1,this.privRecognizer=d,this.privRequestSession=new p.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privDynamicGrammar=new p.DynamicGrammarBuilder,this.privSpeechContext=new p.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new p.AgentConfig,this.privRecognizerConfig.parameters.getProperty(n.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=t.Timeout.setTimeout:typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),this.connectionEvents.attach(v=>{if(v.name==="ConnectionClosedEvent"){const f=v;(f.statusCode===1003||f.statusCode===1007||f.statusCode===1002||f.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(n.CancellationReason.Error,f.statusCode===1007?n.CancellationErrorCode.BadRequestParameters:n.CancellationErrorCode.ConnectionFailure,`${f.reason} websocket error code: ${f.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=t.createNoDashGuid()),this.setLanguageIdJson(),this.setOutputDetailLevelJson()}setTranslationJson(){const i=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(i!==void 0){const o=i.split(","),a=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),h=a!==void 0?"Synthesize":"None";if(this.privSpeechContext.setSection("translation",{onSuccess:{action:h},output:{interimResults:{mode:"Always"}},targetLanguages:o}),a!==void 0){const d={};for(const l of o)d[l]=a;this.privSpeechContext.setSection("synthesis",{defaultVoices:d})}}}setSpeechSegmentationTimeoutJson(){const i=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0);if(i!==void 0){const o=this.recognitionMode===p.RecognitionMode.Conversation?"CONVERSATION":this.recognitionMode===p.RecognitionMode.Dictation?"DICTATION":"INTERACTIVE",a=parseInt(i,10),h=this.privSpeechContext.getSection("phraseDetection");h.mode=o,h[o]={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:a}},this.privSpeechContext.setSection("phraseDetection",h)}}setLanguageIdJson(){const i=this.privSpeechContext.getSection("phraseDetection");if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){const a=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");let h;this.privRecognizerConfig.languageIdMode==="Continuous"?h="DetectContinuous":h="DetectAtAudioStart",this.privSpeechContext.setSection("languageId",{Priority:"PrioritizeLatency",languages:a,mode:h,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}});const d=this.privRecognizerConfig.sourceLanguageModels;d!==void 0&&(i.customModels=d,i.onInterim={action:"None"},i.onSuccess={action:"None"})}this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&(i.onInterim={action:"Translate"},i.onSuccess={action:"Translate"},this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"None"},phraseResults:{resultType:"None"}})),this.privSpeechContext.setSection("phraseDetection",i)}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(p.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase()===n.OutputFormat[n.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(i){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.ConversationTranslator_Token,i)}set voiceProfileType(i){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.SpeechServiceConnection_SpeakerIdMode,i)}set authentication(i){this.privAuthentication=i}isDisposed(){return this.privIsDisposed}dispose(i){return r(this,void 0,void 0,function*(){if(this.privIsDisposed=!0,this.privConnectionConfigurationPromise!==void 0)try{yield(yield this.privConnectionConfigurationPromise).dispose(i)}catch{return}})}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}recognize(i,o,a){return r(this,void 0,void 0,function*(){if(this.recognizeOverride!==void 0){yield this.recognizeOverride(i,o,a);return}this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=i,this.setSpeechSegmentationTimeoutJson(),this.setTranslationJson(),this.privSuccessCallback=o,this.privErrorCallback=a,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const h=this.connectImpl();let d;try{const f=yield this.audioSource.attach(this.privRequestSession.audioNodeId),m=yield this.audioSource.format,g=yield this.audioSource.deviceInfo;this.privIsLiveAudio=g.type&&g.type===p.type.Microphones,d=new e.ReplayableAudioNode(f,m.avgBytesPerSec),yield this.privRequestSession.onAudioSourceAttachCompleted(d,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:g}}catch(f){throw yield this.privRequestSession.onStopRecognizing(),f}try{yield h}catch(f){yield this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,f);return}const l=new n.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,l),this.receiveMessage(),this.sendAudio(d).catch(f=>r(this,void 0,void 0,function*(){yield this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,f)}))})}stopRecognizing(){return r(this,void 0,void 0,function*(){if(this.privRequestSession.isRecognizing)try{yield this.audioSource.turnOff(),yield this.sendFinalAudio(),yield this.privRequestSession.onStopRecognizing(),yield this.privRequestSession.turnCompletionPromise}finally{yield this.privRequestSession.dispose()}})}connect(){return r(this,void 0,void 0,function*(){return yield this.connectImpl(),Promise.resolve()})}connectAsync(i,o){this.connectImpl().then(()=>{try{i&&i()}catch(a){o&&o(a)}},a=>{try{o&&o(a)}catch{}})}disconnect(){return r(this,void 0,void 0,function*(){if(yield this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&(yield this.disconnectOverride()),this.privConnectionPromise!==void 0)try{yield(yield this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0})}sendMessage(i){}sendNetworkMessage(i,o){return r(this,void 0,void 0,function*(){const a=typeof o=="string"?t.MessageType.Text:t.MessageType.Binary,h=typeof o=="string"?"application/json":"";return(yield this.fetchConnection()).send(new u.SpeechConnectionMessage(a,i,this.privRequestSession.requestId,h,o))})}set activityTemplate(i){this.privActivityTemplate=i}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(i){this.privExpectContentAssessmentResponse=i}sendTelemetryData(){return r(this,void 0,void 0,function*(){const i=this.privRequestSession.getTelemetry();if(Zr.telemetryDataEnabled!==!0||this.privIsDisposed||i===null)return;if(Zr.telemetryData)try{Zr.telemetryData(i)}catch{}yield(yield this.fetchConnection()).send(new u.SpeechConnectionMessage(t.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",i))})}cancelRecognitionLocal(i,o,a){return r(this,void 0,void 0,function*(){this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,i,o,a))})}receiveMessage(){return r(this,void 0,void 0,function*(){try{if(this.privIsDisposed)return;let i=yield this.fetchConnection();const o=yield i.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!o)return this.receiveMessage();this.privServiceHasSentMessage=!0;const a=u.SpeechConnectionMessage.fromConnectionMessage(o);if(a.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(a.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const h=p.SpeechDetected.fromJSON(a.textBody),d=new n.RecognitionEventArgs(h.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,d);break;case"speech.enddetected":let l;a.textBody.length>0?l=a.textBody:l="{ Offset: 0 }";const v=p.SpeechDetected.fromJSON(l),f=new n.RecognitionEventArgs(v.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,f);break;case"turn.end":yield this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,yield this.cancelRecognitionLocal(n.CancellationReason.EndOfStream,n.CancellationErrorCode.NoError,void 0));const m=new n.SessionEventArgs(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,m);return}else i=yield this.fetchConnection(),yield this.sendPrePayloadJSON(i);break;default:(yield this.processTypeSpecificMessages(a))||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(a.path.toLowerCase(),a.textBody))}return this.receiveMessage()}catch{return null}})}updateSpeakerDiarizationAudioOffset(){const o=this.privRequestSession.recognitionBytesSent/this.privAverageBytesPerMs;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(o)}sendSpeechContext(i,o){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const a=this.speechContext.toJSON();if(o&&this.privRequestSession.onSpeechContext(),a)return i.send(new u.SpeechConnectionMessage(t.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",a))}noOp(){}sendPrePayloadJSON(i,o=!0){return r(this,void 0,void 0,function*(){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(i);yield this.sendSpeechContext(i,o),yield this.sendWaveHeader(i)})}sendWaveHeader(i){return r(this,void 0,void 0,function*(){const o=yield this.audioSource.format;return i.send(new u.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",o.header))})}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(i=>i.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(i,o,a){if(o.onSpeechContext(),Zr.telemetryDataEnabled!==!0){const d={context:{system:JSON.parse(a).context.system}};a=JSON.stringify(d)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){const h=JSON.parse(a);h.context.DisableReferenceChannel="True",h.context.MicSpec="1_0_0",a=JSON.stringify(h)}if(a)return i.send(new u.SpeechConnectionMessage(t.MessageType.Text,"speech.config",o.requestId,"application/json",a))}fetchConnection(){return r(this,void 0,void 0,function*(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(i=>i.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)})}sendAudio(i){return r(this,void 0,void 0,function*(){const o=yield this.audioSource.format;this.privAverageBytesPerMs=o.avgBytesPerSec/1e3;let a=Date.now();const h=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),d=o.avgBytesPerSec/1e3*parseInt(h,10),l=this.privRequestSession.recogNumber,v=()=>r(this,void 0,void 0,function*(){if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===l){const f=yield this.fetchConnection(),m=yield i.read();if(this.privRequestSession.isSpeechEnded)return;let g,S;if(!m||m.isEnd?(g=null,S=0):(g=m.buffer,this.privRequestSession.onAudioSent(g.byteLength),d>=this.privRequestSession.bytesSent?S=0:S=Math.max(0,a-Date.now())),S!==0&&(yield this.delay(S)),g!==null&&(a=Date.now()+g.byteLength*1e3/(o.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===l)if(f.send(new u.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,g)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),m!=null&&m.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return v()}});return v()})}retryableConnect(){return r(this,void 0,void 0,function*(){let i=!1;this.privAuthFetchEventId=t.createNoDashGuid();const o=this.privRequestSession.sessionId;this.privConnectionId=o!==void 0?o:t.createNoDashGuid(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let a=0,h="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){const l=yield i?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);yield this.privRequestSession.onAuthCompleted(!1);const v=this.privConnectionFactory.create(this.privRecognizerConfig,l,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(v.events),v.events.attach(m=>{this.connectionEvents.onEvent(m)});const f=yield v.open();if(f.statusCode===200)return yield this.privRequestSession.onConnectionEstablishCompleted(f.statusCode),Promise.resolve(v);f.statusCode===1006&&(i=!0),a=f.statusCode,h=f.reason,this.privRequestSession.onRetryConnection()}return yield this.privRequestSession.onConnectionEstablishCompleted(a,h),Promise.reject(`Unable to contact server. StatusCode: ${a}, ${this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${h}`)})}delay(i){return new Promise(o=>this.privSetTimeout(o,i))}writeBufferToConsole(i){let o="Buffer Size: ";if(i===null)o+="null";else{const a=new Uint8Array(i);o+=`${i.byteLength}\r
`;for(let h=0;h<i.byteLength;h++)o+=a[h].toString(16).padStart(2,"0")+" ",(h+1)%16===0&&(console.info(o),o="")}console.info(o)}sendFinalAudio(){return r(this,void 0,void 0,function*(){yield(yield this.fetchConnection()).send(new u.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))})}configureConnection(){return r(this,void 0,void 0,function*(){const i=yield this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(i):(yield this.sendSpeechServiceConfig(i,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendPrePayloadJSON(i,!1),i)})}};return yr.ServiceRecognizerBase=c,c.telemetryDataEnabled=!0,yr}var Rr={},Va;function Qf(){if(Va)return Rr;Va=1;var r=C&&C.__awaiter||function(p,u,c,s){function i(o){return o instanceof c?o:new c(function(a){a(o)})}return new(c||(c=Promise))(function(o,a){function h(v){try{l(s.next(v))}catch(f){a(f)}}function d(v){try{l(s.throw(v))}catch(f){a(f)}}function l(v){v.done?o(v.value):i(v.value).then(h,d)}l((s=s.apply(p,u||[])).next())})};Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.ConversationServiceRecognizer=void 0;const e=R(),t=_();let n=class extends t.ServiceRecognizerBase{constructor(u,c,s,i,o){super(u,c,s,i,o),this.handleSpeechPhraseMessage=a=>r(this,void 0,void 0,function*(){return this.handleSpeechPhrase(a)}),this.handleSpeechHypothesisMessage=a=>this.handleSpeechHypothesis(a)}processTypeSpecificMessages(u){}handleRecognizedCallback(u,c,s){}handleRecognizingCallback(u,c,s){}processSpeechMessages(u){return r(this,void 0,void 0,function*(){let c=!1;switch(u.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(u.textBody),c=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&(yield this.handleSpeechPhraseMessage(u.textBody)),c=!0;break}return c})}cancelRecognition(u,c,s,i,o){}handleSpeechPhrase(u){return r(this,void 0,void 0,function*(){const c=t.SimpleSpeechPhrase.fromJSON(u),s=t.EnumTranslation.implTranslateRecognitionResult(c.RecognitionStatus);let i;const o=new e.PropertyCollection;o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,u);const a=c.Offset+this.privRequestSession.currentTurnAudioOffset;let h=a;if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+c.Offset+c.Duration),e.ResultReason.Canceled===s){const d=t.EnumTranslation.implTranslateCancelResult(c.RecognitionStatus),l=t.EnumTranslation.implTranslateCancelErrorCode(c.RecognitionStatus);yield this.cancelRecognitionLocal(d,l,t.EnumTranslation.implTranslateErrorDetails(l))}else if(!(this.privRequestSession.isSpeechEnded&&s===e.ResultReason.NoMatch&&c.RecognitionStatus!==t.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])i=new e.SpeechRecognitionResult(this.privRequestSession.requestId,s,c.DisplayText,c.Duration,a,c.Language,c.LanguageDetectionConfidence,c.SpeakerId,void 0,u,o);else{const d=t.DetailedSpeechPhrase.fromJSON(u),l=d.Offset+this.privRequestSession.currentTurnAudioOffset,v=d.getJsonWithCorrectedOffsets(l);i=new e.SpeechRecognitionResult(this.privRequestSession.requestId,s,d.Text,d.Duration,l,d.Language,d.LanguageDetectionConfidence,d.SpeakerId,void 0,v,o),h=i.offset}this.handleRecognizedCallback(i,h,this.privRequestSession.sessionId)}})}handleSpeechHypothesis(u){const c=t.SpeechHypothesis.fromJSON(u),s=c.Offset+this.privRequestSession.currentTurnAudioOffset,i=new e.PropertyCollection;i.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,u);const o=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,c.Text,c.Duration,s,c.Language,c.LanguageDetectionConfidence,c.SpeakerId,void 0,u,i);this.privRequestSession.onHypothesis(s),this.handleRecognizingCallback(o,c.Duration,this.privRequestSession.sessionId)}};return Rr.ConversationServiceRecognizer=n,Rr}var ao={},Ka;function Zf(){return Ka||(Ka=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RecognizerConfig=r.SpeechResultFormat=r.RecognitionMode=void 0;const e=R(),t=_();var n;(function(u){u[u.Interactive=0]="Interactive",u[u.Conversation=1]="Conversation",u[u.Dictation=2]="Dictation"})(n=r.RecognitionMode||(r.RecognitionMode={})),function(u){u[u.Simple=0]="Simple",u[u.Detailed=1]="Detailed"}(r.SpeechResultFormat||(r.SpeechResultFormat={}));class p{constructor(c,s){this.privSpeechServiceConfig=c||new t.SpeechServiceConfig(new t.Context(null)),this.privParameters=s,this.privMaxRetryCount=parseInt(s.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=s.getProperty(e.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(c){this.privRecognitionMode=c,this.privRecognitionActivityTimeout=c===n.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=n[c]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==n.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){const c=[];let s=!1;if(this.autoDetectSourceLanguages!==void 0)for(const i of this.autoDetectSourceLanguages.split(",")){const o=i+e.PropertyId.SpeechServiceConnection_EndpointId.toString(),a=this.parameters.getProperty(o,void 0);a!==void 0?(c.push({language:i,endpoint:a}),s=!0):c.push({language:i,endpoint:""})}return s?c:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(c){this.privEnableSpeakerId=c}}r.RecognizerConfig=p}(ao)),ao}var Yu={};Object.defineProperty(Yu,"__esModule",{value:!0});var En={};Object.defineProperty(En,"__esModule",{value:!0});En.WebsocketMessageFormatter=void 0;const oe=I(),Ja=`\r
`;class Xf{toConnectionMessage(e){const t=new oe.Deferred;try{if(e.messageType===oe.MessageType.Text){const n=e.textContent;let p={},u=null;if(n){const c=n.split(`\r
\r
`);c&&c.length>0&&(p=this.parseHeaders(c[0]),c.length>1&&(u=c[1]))}t.resolve(new oe.ConnectionMessage(e.messageType,u,p,e.id))}else if(e.messageType===oe.MessageType.Binary){const n=e.binaryContent;let p={},u=null;if(!n||n.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const c=new DataView(n),s=c.getInt16(0);if(n.byteLength<s+2)throw new Error("Invalid binary message format. Header content missing.");let i="";for(let o=0;o<s;o++)i+=String.fromCharCode(c.getInt8(o+2));p=this.parseHeaders(i),n.byteLength>s+2&&(u=n.slice(2+s)),t.resolve(new oe.ConnectionMessage(e.messageType,u,p,e.id))}}catch(n){t.reject(`Error formatting the message. Error: ${n}`)}return t.promise}fromConnectionMessage(e){const t=new oe.Deferred;try{if(e.messageType===oe.MessageType.Text){const n=`${this.makeHeaders(e)}${Ja}${e.textBody?e.textBody:""}`;t.resolve(new oe.RawWebsocketMessage(oe.MessageType.Text,n,e.id))}else if(e.messageType===oe.MessageType.Binary){const n=this.makeHeaders(e),p=e.binaryBody,u=this.stringToArrayBuffer(n),c=new Int8Array(u),s=c.byteLength,i=new Int8Array(2+s+(p?p.byteLength:0));if(i[0]=s>>8&255,i[1]=s&255,i.set(c,2),p){const a=new Int8Array(p);i.set(a,2+s)}const o=i.buffer;t.resolve(new oe.RawWebsocketMessage(oe.MessageType.Binary,o,e.id))}}catch(n){t.reject(`Error formatting the message. ${n}`)}return t.promise}makeHeaders(e){let t="";if(e.headers)for(const n in e.headers)n&&(t+=`${n}: ${e.headers[n]}${Ja}`);return t}parseHeaders(e){const t={};if(e){const n=e.match(/[^\r\n]+/g);if(t){for(const p of n)if(p){const u=p.indexOf(":"),c=u>0?p.substr(0,u).trim().toLowerCase():p,s=u>0&&p.length>u+1?p.substr(u+1).trim():"";t[c]=s}}}return t}stringToArrayBuffer(e){const t=new ArrayBuffer(e.length),n=new DataView(t);for(let p=0;p<e.length;p++)n.setUint8(p,e.charCodeAt(p));return t}}En.WebsocketMessageFormatter=Xf;var Pr={},Ga;function Yf(){if(Ga)return Pr;Ga=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.SpeechConnectionFactory=void 0;const r=F(),e=_(),t=R(),n=de(),p=_(),u=q,c=pe;let s=class extends n.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(o,a,h){let d=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,void 0),v=n.ConnectionFactoryBase.getHostSuffix(l),f=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+l+".stt.speech"+v),m={},g=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),S=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(g?(!d||d.search(c.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(m[c.QueryParameterNames.CustomSpeechDeploymentId]=g):S&&(!d||d.search(c.QueryParameterNames.Language)===-1)&&(m[c.QueryParameterNames.Language]=S),(!d||d.search(c.QueryParameterNames.Format)===-1)&&(m[c.QueryParameterNames.Format]=o.parameters.getProperty(e.OutputFormatPropertyName,t.OutputFormat[t.OutputFormat.Simple]).toLowerCase()),o.autoDetectSourceLanguages!==void 0&&(m[c.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(o,m,d),!d)switch(o.recognitionMode){case p.RecognitionMode.Conversation:o.parameters.getProperty(e.ForceDictationPropertyName,"false")==="true"?d=f+this.dictationRelativeUri:o.recognitionEndpointVersion!==void 0&&parseInt(o.recognitionEndpointVersion,10)>1?d=`${f}${this.universalUri}${o.recognitionEndpointVersion}`:d=f+this.conversationRelativeUri;break;case p.RecognitionMode.Dictation:d=f+this.dictationRelativeUri;break;default:o.recognitionEndpointVersion!==void 0&&parseInt(o.recognitionEndpointVersion,10)>1?d=`${f}${this.universalUri}${o.recognitionEndpointVersion}`:d=f+this.interactiveRelativeUri;break}const y={};a.token!==void 0&&a.token!==""&&(y[a.headerName]=a.token),y[u.HeaderNames.ConnectionId]=h;const E=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",P=new r.WebsocketConnection(d,m,y,new p.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),E,h),b=P.uri;return o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,b),P}};return Pr.SpeechConnectionFactory=s,Pr}var Er={},Qa;function eg(){if(Qa)return Er;Qa=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.ConversationTranscriberConnectionFactory=void 0;const r=F(),e=R(),t=_(),n=de(),p=_(),u=q,c=pe;let s=class extends n.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/speech/universal/v2"}create(o,a,h){let d=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const l=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),v=n.ConnectionFactoryBase.getHostSuffix(l),f=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+l+".stt.speech"+v),m={},g=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),S=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);g?(!d||d.search(c.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(m[c.QueryParameterNames.CustomSpeechDeploymentId]=g):S&&(!d||d.search(c.QueryParameterNames.Language)===-1)&&(m[c.QueryParameterNames.Language]=S),o.autoDetectSourceLanguages!==void 0&&(m[c.QueryParameterNames.EnableLanguageId]="true"),this.setV2UrlParams(o,m,d),d||(d=`${f}${this.universalUri}`);const y={};a.token!==void 0&&a.token!==""&&(y[a.headerName]=a.token),y[u.HeaderNames.ConnectionId]=h;const E=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",P=new r.WebsocketConnection(d,m,y,new p.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),E,h),b=P.uri;return o.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,b),P}setV2UrlParams(o,a,h){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,c.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,c.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,c.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,c.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,c.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,c.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,c.QueryParameterNames.StableIntermediateThreshold]]).forEach((v,f)=>{this.setUrlParameter(f,v,o,a,h)});const l=JSON.parse(o.parameters.getProperty(t.ServicePropertiesPropertyName,"{}"));Object.keys(l).forEach(v=>{a[v]=l[v]})}};return Er.ConversationTranscriberConnectionFactory=s,Er}var _r={},Za;function tg(){if(Za)return _r;Za=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.TranscriberConnectionFactory=void 0;const r=F(),e=R(),t=de(),n=_(),p=q,u=pe;let c=class extends t.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(i,o,a){let h=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"centralus"),l=t.ConnectionFactoryBase.getHostSuffix(d),v="wss://transcribe."+d+".cts.speech"+l+this.multiaudioRelativeUri,f=i.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,v),m={};this.setQueryParams(m,i,h),h||(h=f);const g={};o.token!==void 0&&o.token!==""&&(g[o.headerName]=o.token),g[p.HeaderNames.ConnectionId]=a,i.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const S=i.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(h,m,g,new n.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(i),S,a)}setQueryParams(i,o,a){const h=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),d=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);h&&!(u.QueryParameterNames.CustomSpeechDeploymentId in i)&&(i[u.QueryParameterNames.CustomSpeechDeploymentId]=h),d&&!(u.QueryParameterNames.Language in i)&&(i[u.QueryParameterNames.Language]=d);const l=o.parameters.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",v=o.parameters.getProperty(n.OutputFormatPropertyName,e.OutputFormat[e.OutputFormat.Simple])!==e.OutputFormat[e.OutputFormat.Simple];(l||v)&&(i[u.QueryParameterNames.Format]=e.OutputFormat[e.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(o,i,a)}};return _r.TranscriberConnectionFactory=c,_r}var Ir={},Xa;function rg(){if(Xa)return Ir;Xa=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.TranslationConnectionFactory=void 0;const r=F(),e=hi,t=R(),n=de(),p=_(),u=q,c=pe;let s=class extends n.ConnectionFactoryBase{create(o,a,h){const d=this.getEndpointUrl(o),l={};o.autoDetectSourceLanguages!==void 0&&(l[c.QueryParameterNames.EnableLanguageId]="true"),this.setQueryParams(l,o,d);const v={};a.token!==void 0&&a.token!==""&&(v[a.headerName]=a.token),v[u.HeaderNames.ConnectionId]=h,o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,d);const f=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(d,l,v,new p.WebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),f,h)}getEndpointUrl(o,a){const h=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region),d=n.ConnectionFactoryBase.getHostSuffix(h);let l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);return l||(o.autoDetectSourceLanguages!==void 0?l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+d)+"/speech/universal/v2":l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+d)+"/speech/translation/cognitiveservices/v1"),a===!0?l:e.StringUtils.formatString(l,{region:h})}setQueryParams(o,a,h){o.from=a.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage),o.to=a.parameters.getProperty(t.PropertyId.SpeechServiceConnection_TranslationToLanguages),o.scenario=a.recognitionMode===p.RecognitionMode.Interactive?"interactive":a.recognitionMode===p.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(a,o,h),this.setUrlParameter(t.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,c.QueryParameterNames.StableTranslation,a,o,h);const d=a.parameters.getProperty(t.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);d!==void 0&&(o.voice=d,o.features="texttospeech")}};return Ir.TranslationConnectionFactory=s,Ir}var Tr={},Ya;function ig(){if(Ya)return Tr;Ya=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.EnumTranslation=void 0;const r=R(),e=_();let t=class{static implTranslateRecognitionResult(p,u=!1){let c=r.ResultReason.Canceled;switch(p){case e.RecognitionStatus.Success:c=r.ResultReason.RecognizedSpeech;break;case e.RecognitionStatus.EndOfDictation:c=u?r.ResultReason.RecognizedSpeech:r.ResultReason.NoMatch;break;case e.RecognitionStatus.NoMatch:case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:c=r.ResultReason.NoMatch;break;case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:c=r.ResultReason.Canceled;break}return c}static implTranslateCancelResult(p){let u=r.CancellationReason.EndOfStream;switch(p){case e.RecognitionStatus.Success:case e.RecognitionStatus.EndOfDictation:case e.RecognitionStatus.NoMatch:u=r.CancellationReason.EndOfStream;break;case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:u=r.CancellationReason.Error;break}return u}static implTranslateCancelErrorCode(p){let u=r.CancellationErrorCode.NoError;switch(p){case e.RecognitionStatus.Error:u=r.CancellationErrorCode.ServiceError;break;case e.RecognitionStatus.TooManyRequests:u=r.CancellationErrorCode.TooManyRequests;break;case e.RecognitionStatus.BadRequest:u=r.CancellationErrorCode.BadRequestParameters;break;case e.RecognitionStatus.Forbidden:u=r.CancellationErrorCode.Forbidden;break;default:u=r.CancellationErrorCode.NoError;break}return u}static implTranslateErrorDetails(p){let u="The speech service encountered an internal error and could not continue.";switch(p){case r.CancellationErrorCode.Forbidden:u="The recognizer is using a free subscription that ran out of quota.";break;case r.CancellationErrorCode.BadRequestParameters:u="Invalid parameter or unsupported audio format in the request.";break;case r.CancellationErrorCode.TooManyRequests:u="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break}return u}};return Tr.EnumTranslation=t,Tr}var ep={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RecognitionStatus=r.SynthesisStatus=void 0,function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(r.SynthesisStatus||(r.SynthesisStatus={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests",e[e.BadRequest=7]="BadRequest",e[e.Forbidden=8]="Forbidden"}(r.RecognitionStatus||(r.RecognitionStatus={}))})(ep);var Ar={},ec;function ng(){if(ec)return Ar;ec=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.TranslationSynthesisEnd=void 0;const r=_();let e=class tp{constructor(n){this.privSynthesisEnd=JSON.parse(n),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=r.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=r.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(n){return new tp(n)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};return Ar.TranslationSynthesisEnd=e,Ar}var _n={};Object.defineProperty(_n,"__esModule",{value:!0});_n.TranslationHypothesis=void 0;const og=T,sg=Hi;class _i{constructor(e){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Translation.TranslationStatus=sg.TranslationStatus[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new _i(JSON.parse(e))}static fromTranslationResponse(e){og.Contracts.throwIfNullOrUndefined(e,"translationHypothesis");const t=e.SpeechHypothesis;return e.SpeechHypothesis=void 0,t.Translation=e,new _i(t)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){var e;return(e=this.privTranslationHypothesis.PrimaryLanguage)===null||e===void 0?void 0:e.Language}}_n.TranslationHypothesis=_i;var wr={},tc;function ag(){if(tc)return wr;tc=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.TranslationPhrase=void 0;const r=T,e=_(),t=Hi;let n=class mo{constructor(u){this.privTranslationPhrase=u,this.privTranslationPhrase.RecognitionStatus=e.RecognitionStatus[this.privTranslationPhrase.RecognitionStatus],this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=t.TranslationStatus[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(u){return new mo(JSON.parse(u))}static fromTranslationResponse(u){r.Contracts.throwIfNullOrUndefined(u,"translationResponse");const c=u.SpeechPhrase;return u.SpeechPhrase=void 0,c.Translation=u,c.Text=c.DisplayText,new mo(c)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var u;return(u=this.privTranslationPhrase.PrimaryLanguage)===null||u===void 0?void 0:u.Language}get Confidence(){var u;return(u=this.privTranslationPhrase.PrimaryLanguage)===null||u===void 0?void 0:u.Confidence}get Translation(){return this.privTranslationPhrase.Translation}};return wr.TranslationPhrase=n,wr}var br={},rc;function cg(){if(rc)return br;rc=1;var r=C&&C.__awaiter||function(u,c,s,i){function o(a){return a instanceof s?a:new s(function(h){h(a)})}return new(s||(s=Promise))(function(a,h){function d(f){try{v(i.next(f))}catch(m){h(m)}}function l(f){try{v(i.throw(f))}catch(m){h(m)}}function v(f){f.done?a(f.value):o(f.value).then(d,l)}v((i=i.apply(u,c||[])).next())})};Object.defineProperty(br,"__esModule",{value:!0}),br.TranslationServiceRecognizer=void 0;const e=I(),t=R(),n=_();let p=class extends n.ConversationServiceRecognizer{constructor(c,s,i,o,a){super(c,s,i,o,a),this.privTranslationRecognizer=a,this.connectionEvents.attach(h=>{h.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}processTypeSpecificMessages(c){return r(this,void 0,void 0,function*(){const s=new t.PropertyCollection;let i=yield this.processSpeechMessages(c);if(i)return!0;const o=h=>r(this,void 0,void 0,function*(){if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+h.Offset+h.Duration),h.RecognitionStatus===n.RecognitionStatus.Success){const d=this.fireEventForResult(h,s);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,d)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(d.result)}catch(l){this.privErrorCallback&&this.privErrorCallback(l)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const d=n.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus),l=new t.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,d,h.Text,h.Duration,this.privRequestSession.currentTurnAudioOffset+h.Offset,h.Language,h.Confidence,void 0,c.textBody,s);if(d===t.ResultReason.Canceled){const v=n.EnumTranslation.implTranslateCancelResult(h.RecognitionStatus),f=n.EnumTranslation.implTranslateCancelErrorCode(h.RecognitionStatus);yield this.cancelRecognitionLocal(v,f,n.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&d===t.ResultReason.NoMatch&&h.RecognitionStatus!==n.RecognitionStatus.InitialSilenceTimeout)){const v=new t.TranslationRecognitionEventArgs(l,l.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,v)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(l)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0}}),a=(h,d)=>{const l=this.fireEventForResult(h,d);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+l.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,l)}catch{}i=!0};switch(c.messageType===e.MessageType.Text&&s.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,c.textBody),c.path.toLowerCase()){case"translation.hypothesis":a(n.TranslationHypothesis.fromJSON(c.textBody),s);break;case"translation.response":const h=JSON.parse(c.textBody);if(h.SpeechPhrase)yield o(n.TranslationPhrase.fromTranslationResponse(h));else{const l=JSON.parse(c.textBody);l.SpeechHypothesis&&a(n.TranslationHypothesis.fromTranslationResponse(l),s)}break;case"translation.phrase":yield o(n.TranslationPhrase.fromJSON(c.textBody));break;case"translation.synthesis":this.sendSynthesisAudio(c.binaryBody,this.privRequestSession.sessionId),i=!0;break;case"audio.end":case"translation.synthesis.end":const d=n.TranslationSynthesisEnd.fromJSON(c.textBody);switch(d.SynthesisStatus){case n.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const l=new t.TranslationSynthesisResult(t.ResultReason.Canceled,void 0),v=new t.TranslationSynthesisEventArgs(l,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,v)}catch{}}if(this.privTranslationRecognizer.canceled){const l=new t.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,t.CancellationReason.Error,d.FailureReason,t.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,l)}catch{}}break;case n.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break}i=!0;break}return i})}cancelRecognition(c,s,i,o,a){const h=new t.PropertyCollection;if(h.setProperty(n.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]),this.privTranslationRecognizer.canceled){const d=new t.TranslationRecognitionCanceledEventArgs(c,i,a,o,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,d)}catch{}}if(this.privSuccessCallback){const d=new t.TranslationRecognitionResult(void 0,s,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,a,void 0,h);try{this.privSuccessCallback(d),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(c,s,i){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(c),s,i);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,o)}catch{}}handleRecognizedCallback(c,s,i){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(c),s,i);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,o)}catch{}}fireEventForResult(c,s){let i;if(c.Translation.Translations!==void 0){i=new t.Translations;for(const f of c.Translation.Translations)i.set(f.Language,f.Text||f.DisplayText)}let o,a;c instanceof n.TranslationPhrase?(c.Translation&&c.Translation.TranslationStatus===e.TranslationStatus.Success?o=t.ResultReason.TranslatedSpeech:o=t.ResultReason.RecognizedSpeech,a=c.Confidence):o=t.ResultReason.TranslatingSpeech;const h=c.Language,d=c.Offset+this.privRequestSession.currentTurnAudioOffset,l=new t.TranslationRecognitionResult(i,this.privRequestSession.requestId,o,c.Text,c.Duration,d,h,a,c.Translation.FailureReason,JSON.stringify(c),s);return new t.TranslationRecognitionEventArgs(l,d,this.privRequestSession.sessionId)}sendSynthesisAudio(c,s){const i=c===void 0?t.ResultReason.SynthesizingAudioCompleted:t.ResultReason.SynthesizingAudio,o=new t.TranslationSynthesisResult(i,c),a=new t.TranslationSynthesisEventArgs(o,s);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,a)}catch{}}};return br.TranslationServiceRecognizer=p,br}var In={};Object.defineProperty(In,"__esModule",{value:!0});In.SpeechDetected=void 0;class Lo{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new Lo(e)}get Offset(){return this.privSpeechStartDetected.Offset}}In.SpeechDetected=Lo;var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0});Tn.SpeechHypothesis=void 0;class xo{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new xo(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}Tn.SpeechHypothesis=xo;var An={};Object.defineProperty(An,"__esModule",{value:!0});An.SpeechKeyword=void 0;class Bo{constructor(e){this.privSpeechKeyword=JSON.parse(e)}static fromJSON(e){return new Bo(e)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}}An.SpeechKeyword=Bo;var Or={},ic;function ug(){if(ic)return Or;ic=1;var r=C&&C.__awaiter||function(p,u,c,s){function i(o){return o instanceof c?o:new c(function(a){a(o)})}return new(c||(c=Promise))(function(o,a){function h(v){try{l(s.next(v))}catch(f){a(f)}}function d(v){try{l(s.throw(v))}catch(f){a(f)}}function l(v){v.done?o(v.value):i(v.value).then(h,d)}l((s=s.apply(p,u||[])).next())})};Object.defineProperty(Or,"__esModule",{value:!0}),Or.SpeechServiceRecognizer=void 0;const e=R(),t=_();let n=class extends t.ServiceRecognizerBase{constructor(u,c,s,i,o){super(u,c,s,i,o),this.privSpeechRecognizer=o}processTypeSpecificMessages(u){return r(this,void 0,void 0,function*(){let c;const s=new e.PropertyCollection;s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,u.textBody);let i=!1;switch(u.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const o=t.SpeechHypothesis.fromJSON(u.textBody),a=o.Offset+this.privRequestSession.currentTurnAudioOffset;c=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,o.Text,o.Duration,a,o.Language,o.LanguageDetectionConfidence,void 0,void 0,u.textBody,s),this.privRequestSession.onHypothesis(a);const h=new e.SpeechRecognitionEventArgs(c,o.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,h)}catch{}i=!0;break;case"speech.phrase":const d=t.SimpleSpeechPhrase.fromJSON(u.textBody),l=t.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+d.Offset+d.Duration),e.ResultReason.Canceled===l){const v=t.EnumTranslation.implTranslateCancelResult(d.RecognitionStatus),f=t.EnumTranslation.implTranslateCancelErrorCode(d.RecognitionStatus);yield this.cancelRecognitionLocal(v,f,t.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&l===e.ResultReason.NoMatch&&d.RecognitionStatus!==t.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])c=new e.SpeechRecognitionResult(this.privRequestSession.requestId,l,d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,u.textBody,s);else{const f=t.DetailedSpeechPhrase.fromJSON(u.textBody),m=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(m);c=new e.SpeechRecognitionResult(this.privRequestSession.requestId,l,f.RecognitionStatus===t.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,m,f.Language,f.LanguageDetectionConfidence,void 0,void 0,g,s)}const v=new e.SpeechRecognitionEventArgs(c,c.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,v)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(c)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0;break}return i})}cancelRecognition(u,c,s,i,o){const a=new e.PropertyCollection;if(a.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[i]),this.privSpeechRecognizer.canceled){const h=new e.SpeechRecognitionCanceledEventArgs(s,o,i,void 0,u);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.SpeechRecognitionResult(c,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,o,void 0,a);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}};return Or.SpeechServiceRecognizer=n,Or}var Mr={},nc;function pg(){if(nc)return Mr;nc=1;var r=C&&C.__awaiter||function(p,u,c,s){function i(o){return o instanceof c?o:new c(function(a){a(o)})}return new(c||(c=Promise))(function(o,a){function h(v){try{l(s.next(v))}catch(f){a(f)}}function d(v){try{l(s.throw(v))}catch(f){a(f)}}function l(v){v.done?o(v.value):i(v.value).then(h,d)}l((s=s.apply(p,u||[])).next())})};Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.ConversationTranscriptionServiceRecognizer=void 0;const e=R(),t=_();let n=class extends t.ServiceRecognizerBase{constructor(u,c,s,i,o){super(u,c,s,i,o),this.privConversationTranscriber=o,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const u=this.privSpeechContext.getSection("phraseDetection");u.mode="Conversation";const c={};c.mode="Anonymous",c.audioSessionId=this.privDiarizationSessionId,c.audioOffsetMs=0,u.speakerDiarization=c,this.privSpeechContext.setSection("phraseDetection",u)}}processTypeSpecificMessages(u){return r(this,void 0,void 0,function*(){let c;const s=new e.PropertyCollection;s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,u.textBody);let i=!1;switch(u.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const o=t.SpeechHypothesis.fromJSON(u.textBody),a=o.Offset+this.privRequestSession.currentTurnAudioOffset;c=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,o.Text,o.Duration,a,o.Language,o.LanguageDetectionConfidence,void 0,void 0,u.textBody,s),this.privRequestSession.onHypothesis(a);const h=new e.ConversationTranscriptionEventArgs(c,o.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,h)}catch{}i=!0;break;case"speech.phrase":const d=t.SimpleSpeechPhrase.fromJSON(u.textBody),l=t.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+d.Offset+d.Duration),e.ResultReason.Canceled===l){const v=t.EnumTranslation.implTranslateCancelResult(d.RecognitionStatus),f=t.EnumTranslation.implTranslateCancelErrorCode(d.RecognitionStatus);yield this.cancelRecognitionLocal(v,f,t.EnumTranslation.implTranslateErrorDetails(f))}else if(!(this.privRequestSession.isSpeechEnded&&l===e.ResultReason.NoMatch&&d.RecognitionStatus!==t.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])c=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,l,d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,d.SpeakerId,void 0,u.textBody,s);else{const f=t.DetailedSpeechPhrase.fromJSON(u.textBody),m=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(m);c=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,l,f.RecognitionStatus===t.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,m,f.Language,f.LanguageDetectionConfidence,d.SpeakerId,void 0,g,s)}const v=new e.ConversationTranscriptionEventArgs(c,c.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,v)}catch{}}i=!0;break}return i})}cancelRecognition(u,c,s,i,o){if(new e.PropertyCollection().setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[i]),this.privConversationTranscriber.canceled){const h=new e.ConversationTranscriptionCanceledEventArgs(s,o,i,void 0,u);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,h)}catch{}}}};return Mr.ConversationTranscriptionServiceRecognizer=n,Mr}var Dr={},oc;function dg(){if(oc)return Dr;oc=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.TranscriptionServiceRecognizer=void 0;const e=I(),t=R(),n=_(),p=Ce;let u=class extends n.ConversationServiceRecognizer{constructor(s,i,o,a,h){super(s,i,o,a,h),this.privTranscriberRecognizer=h,this.sendPrePayloadJSONOverride=d=>this.sendTranscriptionStartJSON(d),this.privRecognizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}sendSpeechEventAsync(s,i){return r(this,void 0,void 0,function*(){if(this.privRequestSession.isRecognizing){const o=yield this.fetchConnection();yield this.sendSpeechEvent(o,this.createSpeechEventPayload(s,i))}})}sendMeetingSpeechEventAsync(s,i){return r(this,void 0,void 0,function*(){if(this.privRequestSession.isRecognizing){const o=yield this.fetchConnection();yield this.sendSpeechEvent(o,this.createMeetingSpeechEventPayload(s,i))}})}processTypeSpecificMessages(s){return this.processSpeechMessages(s)}handleRecognizedCallback(s,i,o){try{const a=new t.SpeechRecognitionEventArgs(s,i,o);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,a),this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(s,i,o){try{const a=new t.SpeechRecognitionEventArgs(s,i,o);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,a)}catch{}}cancelRecognition(s,i,o,a,h){const d=new t.PropertyCollection;if(d.setProperty(n.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const l=new t.MeetingTranscriptionCanceledEventArgs(o,h,a,void 0,s);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,l)}catch{}}}else if(this.privTranscriberRecognizer.canceled){const l=new t.ConversationTranscriptionCanceledEventArgs(o,h,a,void 0,s);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,l)}catch{}}if(this.privSuccessCallback){const l=new t.SpeechRecognitionResult(i,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,h,void 0,d);try{this.privSuccessCallback(l),this.privSuccessCallback=void 0}catch{}}}sendTranscriptionStartJSON(s){return r(this,void 0,void 0,function*(){if(yield this.sendSpeechContext(s,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const i=this.privTranscriberRecognizer.getMeetingInfo(),o=this.createMeetingSpeechEventPayload(i,"start");yield this.sendSpeechEvent(s,o)}else{const i=this.privTranscriberRecognizer.getConversationInfo(),o=this.createSpeechEventPayload(i,"start");yield this.sendSpeechEvent(s,o)}yield this.sendWaveHeader(s)})}sendSpeechEvent(s,i){const o=JSON.stringify(i);if(o)return s.send(new p.SpeechConnectionMessage(e.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",o))}createSpeechEventPayload(s,i){const o={id:"meeting",name:i,meeting:s.conversationProperties};return o.meeting.id=s.id,o.meeting.attendees=s.participants,o}createMeetingSpeechEventPayload(s,i){const o={id:"meeting",name:i,meeting:s.meetingProperties};return o.meeting.id=s.id,o.meeting.attendees=s.participants,o}};return Dr.TranscriptionServiceRecognizer=u,Dr}var kr={},sc;function hg(){if(sc)return kr;sc=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.DetailedSpeechPhrase=void 0;const r=_();let e=class rp{constructor(n){this.privDetailedSpeechPhrase=JSON.parse(n),this.privDetailedSpeechPhrase.RecognitionStatus=r.RecognitionStatus[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(n){return new rp(n)}getJsonWithCorrectedOffsets(n){if(this.privDetailedSpeechPhrase.NBest){let p;for(const u of this.privDetailedSpeechPhrase.NBest)if(u.Words&&u.Words[0]){p=u.Words[0].Offset;break}if(p&&p<n){const u=n-p;for(const c of this.privDetailedSpeechPhrase.NBest){if(c.Words)for(const s of c.Words)s.Offset+=u;if(c.DisplayWords)for(const s of c.DisplayWords)s.Offset+=u}}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}};return kr.DetailedSpeechPhrase=e,kr}var zr={},ac;function lg(){if(ac)return zr;ac=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.SimpleSpeechPhrase=void 0;const r=_();let e=class ip{constructor(n){this.privSimpleSpeechPhrase=JSON.parse(n),this.privSimpleSpeechPhrase.RecognitionStatus=r.RecognitionStatus[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(n){return new ip(n)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}};return zr.SimpleSpeechPhrase=e,zr}var wn={};Object.defineProperty(wn,"__esModule",{value:!0});wn.AddedLmIntent=void 0;class vg{constructor(e,t){this.modelImpl=e,this.intentName=t}}wn.AddedLmIntent=vg;var Nr={},cc;function fg(){if(cc)return Nr;cc=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.IntentServiceRecognizer=void 0;const r=I(),e=R(),t=_();let n=class extends t.ServiceRecognizerBase{constructor(u,c,s,i,o){super(u,c,s,i,o),this.privIntentRecognizer=o,this.privIntentDataSent=!1}setIntents(u,c){this.privAddedLmIntents=u,this.privUmbrellaIntent=c,this.privIntentDataSent=!0}processTypeSpecificMessages(u){let c,s,i=!1;const o=new e.PropertyCollection;switch(u.messageType===r.MessageType.Text&&o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,u.textBody),u.path.toLowerCase()){case"speech.hypothesis":const h=t.SpeechHypothesis.fromJSON(u.textBody);if(c=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,e.ResultReason.RecognizingIntent,h.Text,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,void 0,u.textBody,o),this.privRequestSession.onHypothesis(c.offset),s=new e.IntentRecognitionEventArgs(c,h.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,s)}catch{}i=!0;break;case"speech.phrase":const d=t.SimpleSpeechPhrase.fromJSON(u.textBody);c=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,t.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,void 0,u.textBody,o),s=new e.IntentRecognitionEventArgs(c,c.offset,this.privRequestSession.sessionId);const l=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,s)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(c)}catch(f){this.privErrorCallback&&this.privErrorCallback(f)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};this.privIntentDataSent===!1||e.ResultReason.NoMatch===s.result.reason?(this.privRequestSession.onPhraseRecognized(s.offset+s.result.duration),l()):this.privPendingIntentArgs=s,i=!0;break;case"response":if(s=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,s===void 0){if(u.textBody==="")return;s=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult,0,this.privRequestSession.sessionId)}const v=t.IntentResponse.fromJSON(u.textBody);if(v!==null&&v.topScoringIntent&&v.topScoringIntent.intent){let f=this.privAddedLmIntents[v.topScoringIntent.intent];if(this.privUmbrellaIntent!==void 0&&(f=this.privUmbrellaIntent),f){const m=f===void 0||f.intentName===void 0?v.topScoringIntent.intent:f.intentName;let g=s.result.reason;m!==void 0&&(g=e.ResultReason.RecognizedIntent);const S=s.result.properties!==void 0?s.result.properties:new e.PropertyCollection;S.setProperty(e.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,u.textBody),s=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult(m,s.result.resultId,g,s.result.text,s.result.duration,s.result.offset,void 0,void 0,s.result.errorDetails,s.result.json,S),s.offset,s.sessionId)}}if(this.privRequestSession.onPhraseRecognized(s.offset+s.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,s)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(s.result)}catch(f){this.privErrorCallback&&this.privErrorCallback(f)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}i=!0;break}const a=new r.Deferred;return a.resolve(i),a.promise}cancelRecognition(u,c,s,i,o){const a=new e.PropertyCollection;if(a.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[i]),this.privIntentRecognizer.canceled){const h=new e.IntentRecognitionCanceledEventArgs(s,o,i,void 0,void 0,u);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.IntentRecognitionResult(void 0,c,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,o,void 0,a);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}};return Nr.IntentServiceRecognizer=n,Nr}var bn={};Object.defineProperty(bn,"__esModule",{value:!0});bn.IntentResponse=void 0;class qo{constructor(e){e===""?this.privIntentResponse={}:this.privIntentResponse=JSON.parse(e)}static fromJSON(e){return new qo(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}bn.IntentResponse=qo;var np={};Object.defineProperty(np,"__esModule",{value:!0});var On={},Mn={};Object.defineProperty(Mn,"__esModule",{value:!0});Mn.ServiceTelemetryListener=void 0;const me=I(),uc=Pn;class gg{constructor(e,t,n){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=n,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof uc.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof me.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof me.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof me.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof me.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof me.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof uc.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof me.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof me.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof me.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof me.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].length<50&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))}getTelemetry(){const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const t={Metrics:e,ReceivedMessages:this.privReceivedMessages},n=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],n}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}Mn.ServiceTelemetryListener=gg;var Pe=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(On,"__esModule",{value:!0});On.RequestSession=void 0;const et=I(),Ci=Pn,mg=Mn;class Sg{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=et.createNoDashGuid(),this.privAudioNodeId=et.createNoDashGuid(),this.privTurnDeferral=new et.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new mg.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new Ci.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onAudioSourceAttachCompleted(e,t){return Pe(this,void 0,void 0,function*(){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?yield this.onComplete():this.onEvent(new Ci.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))})}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new Ci.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}onAuthCompleted(e){return Pe(this,void 0,void 0,function*(){e&&(yield this.onComplete())})}onConnectionEstablishCompleted(e,t){return Pe(this,void 0,void 0,function*(){if(e===200){this.onEvent(new Ci.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else e===403&&(yield this.onComplete())})}onServiceTurnEndResponse(e){return Pe(this,void 0,void 0,function*(){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(yield this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())})}onSpeechContext(){this.privRequestId=et.createNoDashGuid()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new et.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}dispose(){return Pe(this,void 0,void 0,function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}})}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}onStopRecognizing(){return Pe(this,void 0,void 0,function*(){yield this.onComplete()})}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),et.Events.instance.onEvent(e)}onComplete(){return Pe(this,void 0,void 0,function*(){this.privIsRecognizing&&(this.privIsRecognizing=!1,yield this.detachAudioNode())})}detachAudioNode(){return Pe(this,void 0,void 0,function*(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&(yield this.privAudioNode.detach()))})}}On.RequestSession=Sg;var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0});Dn.SpeechContext=void 0;class Cg{constructor(e){this.privContext={},this.privDynamicGrammar=e}getSection(e){return this.privContext[e]||{}}setSection(e,t){this.privContext[e]=t}setPronunciationAssessmentParams(e,t,n=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),n&&(this.privContext.phraseDetection.mode="Conversation"),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),this.privContext.phraseOutput.detailed.options.indexOf("SNR")===-1&&this.privContext.phraseOutput.detailed.options.push("SNR"),t&&(this.privContext.phraseDetection.enrichment.contentAssessment={topic:t},this.privContext.phraseOutput.detailed.options.push("ContentAssessment"))}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed"}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")===-1&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();return this.setSection("dgi",e),JSON.stringify(this.privContext)}}Dn.SpeechContext=Cg;var kn={};Object.defineProperty(kn,"__esModule",{value:!0});kn.DynamicGrammarBuilder=void 0;class yg{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;const e={};if(e.ReferenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){const t=[];this.privPhrases.forEach(n=>{t.push({Text:n})}),e.Groups=[{Type:"Generic",Items:t}]}return e}}kn.DynamicGrammarBuilder=yg;var op={};Object.defineProperty(op,"__esModule",{value:!0});var jr={},zn={},Nn={},Fo={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MessageDataStreamType=r.ActivityPayloadResponse=void 0;class e{constructor(n){this.privActivityResponse=JSON.parse(n)}static fromJSON(n){return new e(n)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}r.ActivityPayloadResponse=e,function(t){t[t.None=0]="None",t[t.TextToSpeechAudio=1]="TextToSpeechAudio"}(r.MessageDataStreamType||(r.MessageDataStreamType={}))})(Fo);Object.defineProperty(Nn,"__esModule",{value:!0});Nn.DialogServiceTurnState=void 0;const Rg=De,Pg=$,Eg=Fo;class _g{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,t){return e.messageDataStreamType===Eg.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=Pg.AudioOutputStream.createPullStream(),this.privAudioStream.format=t!==void 0?t:Rg.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}}Nn.DialogServiceTurnState=_g;Object.defineProperty(zn,"__esModule",{value:!0});zn.DialogServiceTurnStateManager=void 0;const pc=W,Ig=Nn;class Tg{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new pc.InvalidOperationError("Service error: There is already a turn with id:"+e);const t=new Ig.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new pc.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);const t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t}}zn.DialogServiceTurnStateManager=Tg;var dc;function Ag(){if(dc)return jr;dc=1;var r=C&&C.__awaiter||function(h,d,l,v){function f(m){return m instanceof l?m:new l(function(g){g(m)})}return new(l||(l=Promise))(function(m,g){function S(P){try{E(v.next(P))}catch(b){g(b)}}function y(P){try{E(v.throw(P))}catch(b){g(b)}}function E(P){P.done?m(P.value):f(P.value).then(S,y)}E((v=v.apply(h,d||[])).next())})};Object.defineProperty(jr,"__esModule",{value:!0}),jr.DialogServiceAdapter=void 0;const e=F(),t=Qe,n=I(),p=De,u=R(),c=zn,s=_(),i=Fo,o=Ce;let a=class extends s.ServiceRecognizerBase{constructor(d,l,v,f,m){super(d,l,v,f,m),this.privEvents=new n.EventSource,this.privDialogServiceConnector=m,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new c.DialogServiceTurnStateManager,this.recognizeOverride=(g,S,y)=>this.listenOnce(g,S,y),this.postConnectImplOverride=g=>this.dialogConnectImpl(g),this.configConnectionOverride=g=>this.configConnection(g),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=v,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(g=>{g.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}sendMessage(d){return r(this,void 0,void 0,function*(){const l=n.createGuid(),v=n.createNoDashGuid(),f={context:{interactionId:l},messagePayload:JSON.parse(d),version:.5},m=JSON.stringify(f);yield(yield this.fetchConnection()).send(new o.SpeechConnectionMessage(n.MessageType.Text,"agent",v,"application/json",m))})}privDisconnect(){return r(this,void 0,void 0,function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,u.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1})}processTypeSpecificMessages(d){const l=new u.PropertyCollection;d.messageType===n.MessageType.Text&&l.setProperty(u.PropertyId.SpeechServiceResponse_JsonResult,d.textBody);let v,f;switch(d.path.toLowerCase()){case"speech.phrase":const g=s.SimpleSpeechPhrase.fromJSON(d.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+g.Offset+g.Duration),g.RecognitionStatus!==s.RecognitionStatus.TooManyRequests&&g.RecognitionStatus!==s.RecognitionStatus.Error){const O=this.fireEventForResult(g,l);if(this.privLastResult=O.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,O)}catch{}}f=!0;break;case"speech.hypothesis":const S=s.SpeechHypothesis.fromJSON(d.textBody),y=S.Offset+this.privRequestSession.currentTurnAudioOffset;v=new u.SpeechRecognitionResult(this.privRequestSession.requestId,u.ResultReason.RecognizingSpeech,S.Text,S.Duration,y,S.Language,S.LanguageDetectionConfidence,void 0,void 0,d.textBody,l),this.privRequestSession.onHypothesis(y);const E=new u.SpeechRecognitionEventArgs(v,S.Duration,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,E)}catch{}f=!0;break;case"speech.keyword":const P=s.SpeechKeyword.fromJSON(d.textBody);v=new u.SpeechRecognitionResult(this.privRequestSession.requestId,P.Status==="Accepted"?u.ResultReason.RecognizedKeyword:u.ResultReason.NoMatch,P.Text,P.Duration,P.Offset,void 0,void 0,void 0,void 0,d.textBody,l),P.Status!=="Accepted"&&(this.privLastResult=v);const b=new u.SpeechRecognitionEventArgs(v,v.duration,v.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,b)}catch{}f=!0;break;case"audio":{const O=d.requestId.toUpperCase(),z=this.privTurnStateManager.GetTurn(O);try{d.binaryBody?z.audioStream.write(d.binaryBody):z.endAudioStream()}catch{}}f=!0;break;case"response":this.handleResponseMessage(d),f=!0;break}const m=new n.Deferred;return m.resolve(f),m.promise}cancelRecognition(d,l,v,f,m){return r(this,void 0,void 0,function*(){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing()),this.privDialogServiceConnector.canceled){const g=new u.PropertyCollection;g.setProperty(s.CancellationErrorCodePropertyName,u.CancellationErrorCode[f]);const S=new u.SpeechRecognitionCanceledEventArgs(v,m,f,void 0,d);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,S)}catch{}if(this.privSuccessCallback){const y=new u.SpeechRecognitionResult(void 0,u.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,m,void 0,g);try{this.privSuccessCallback(y),this.privSuccessCallback=void 0}catch{}}}})}listenOnce(d,l,v){return r(this,void 0,void 0,function*(){this.privRecognizerConfig.recognitionMode=d,this.privSuccessCallback=l,this.privErrorCallback=v,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(u.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const f=this.connectImpl(),m=this.sendPreAudioMessages(),g=yield this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),S=yield this.privDialogAudioSource.format,y=yield this.privDialogAudioSource.deviceInfo,E=new e.ReplayableAudioNode(g,S.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(E,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:y};try{yield f,yield m}catch(O){return yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,u.CancellationErrorCode.ConnectionFailure,O),Promise.resolve()}const P=new u.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,P),this.sendAudio(E).then(()=>{},O=>r(this,void 0,void 0,function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,u.CancellationErrorCode.RuntimeError,O)}))})}dialogConnectImpl(d){return this.privConnectionLoop=this.startMessageLoop(),d}receiveDialogMessageOverride(){const d=new n.Deferred,l=()=>r(this,void 0,void 0,function*(){try{const v=this.isDisposed(),f=!this.isDisposed()&&this.terminateMessageLoop;if(v||f){d.resolve(void 0);return}const g=yield(yield this.fetchConnection()).read();if(!g)return l();const S=o.SpeechConnectionMessage.fromConnectionMessage(g);switch(S.path.toLowerCase()){case"turn.start":{const N=S.requestId.toUpperCase(),ye=this.privRequestSession.requestId.toUpperCase();N!==ye?this.privTurnStateManager.StartTurn(N):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const E=s.SpeechDetected.fromJSON(S.textBody),P=new u.RecognitionEventArgs(E.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,P);break;case"speech.enddetected":let b;S.textBody.length>0?b=S.textBody:b="{ Offset: 0 }";const O=s.SpeechDetected.fromJSON(b);this.privRequestSession.onServiceRecognized(O.Offset+this.privRequestSession.currentTurnAudioOffset);const z=new u.RecognitionEventArgs(O.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,z);break;case"turn.end":{const N=S.requestId.toUpperCase(),ye=this.privRequestSession.requestId.toUpperCase();if(N!==ye)this.privTurnStateManager.CompleteTurn(N);else{const dt=new u.SessionEventArgs(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,dt),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(fi){this.privErrorCallback&&this.privErrorCallback(fi)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{(yield this.processTypeSpecificMessages(S))||this.serviceEvents&&this.serviceEvents.onEvent(new n.ServiceEvent(S.path.toLowerCase(),S.textBody))}catch{}}return l()}catch{this.terminateMessageLoop=!0,d.resolve()}});return l().catch(v=>{n.Events.instance.onEvent(new n.BackgroundEvent(v))}),d.promise}startMessageLoop(){return r(this,void 0,void 0,function*(){this.terminateMessageLoop=!1;try{yield this.receiveDialogMessageOverride()}catch(d){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,u.CancellationErrorCode.RuntimeError,d)}return Promise.resolve()})}configConnection(d){return r(this,void 0,void 0,function*(){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(yield this.sendSpeechServiceConfig(d,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendAgentConfig(d),d)})}sendPreAudioMessages(){return r(this,void 0,void 0,function*(){const d=yield this.fetchConnection();this.addKeywordContextData(),yield this.sendSpeechContext(d,!0),yield this.sendAgentContext(d),yield this.sendWaveHeader(d)})}sendAgentConfig(d){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(u.PropertyId.Conversation_DialogType)===u.DialogServiceConfig.DialogTypes.CustomCommands){const v=this.agentConfig.get();v.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(v)}this.onEvent(new t.SendingAgentContextMessageEvent(this.agentConfig));const l=this.agentConfig.toJsonString();return this.agentConfigSent=!0,d.send(new o.SpeechConnectionMessage(n.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",l))}}sendAgentContext(d){const l=n.createGuid(),v=this.privDialogServiceConnector.properties.getProperty(u.PropertyId.Conversation_Speech_Activity_Template),m=JSON.stringify({channelData:"",context:{interactionId:l},messagePayload:typeof v===void 0?void 0:v,version:.5});return d.send(new o.SpeechConnectionMessage(n.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",m))}fireEventForResult(d,l){const v=s.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),f=d.Offset+this.privRequestSession.currentTurnAudioOffset,m=new u.SpeechRecognitionResult(this.privRequestSession.requestId,v,d.DisplayText,d.Duration,f,d.Language,d.LanguageDetectionConfidence,void 0,void 0,JSON.stringify(d),l);return new u.SpeechRecognitionEventArgs(m,f,this.privRequestSession.sessionId)}handleResponseMessage(d){const l=JSON.parse(d.textBody);switch(l.messageType.toLowerCase()){case"message":const v=d.requestId.toUpperCase(),f=i.ActivityPayloadResponse.fromJSON(d.textBody),m=this.privTurnStateManager.GetTurn(v);if(f.conversationId){const y=this.agentConfig.get();y.botInfo.conversationId=f.conversationId,this.agentConfig.set(y)}const g=m.processActivityPayload(f,p.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(u.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),S=new u.ActivityReceivedEventArgs(f.messagePayload,g);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,S)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new u.TurnStatusReceivedEventArgs(d.textBody))}catch{}break;default:n.Events.instance.onEvent(new n.BackgroundEvent(`Unexpected response of type ${l.messageType}. Ignoring.`));break}}onEvent(d){this.privEvents.onEvent(d),n.Events.instance.onEvent(d)}addKeywordContextData(){const d=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(d===void 0)return;const l=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),v=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),f=d.split(";"),m=l===void 0?[]:l.split(";"),g=v===void 0?[]:v.split(";"),S=[];for(let y=0;y<f.length;y++){const E={};E.text=f[y],y<m.length&&(E.offset=Number(m[y])),y<g.length&&(E.duration=Number(g[y])),S.push(E)}this.speechContext.setSection("invocationSource","VoiceActivationWithKeyword"),this.speechContext.setSection("keywordDetection",[{clientDetectedKeywords:S,onReject:{action:"EndOfTurn"},type:"startTrigger"}])}};return jr.DialogServiceAdapter=a,jr}var jn={};Object.defineProperty(jn,"__esModule",{value:!0});jn.AgentConfig=void 0;class wg{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}jn.AgentConfig=wg;var co={},Lr={},pt={};Object.defineProperty(pt,"__esModule",{value:!0});pt.ConversationConnectionConfig=void 0;const bg=li;class X extends bg.RestConfigBase{static get host(){return X.privHost}static get apiVersion(){return X.privApiVersion}static get clientAppId(){return X.privClientAppId}static get defaultLanguageCode(){return X.privDefaultLanguageCode}static get restPath(){return X.privRestPath}static get webSocketPath(){return X.privWebSocketPath}static get transcriptionEventKeys(){return X.privTranscriptionEventKeys}}pt.ConversationConnectionConfig=X;X.privHost="dev.microsofttranslator.com";X.privRestPath="/capito/room";X.privApiVersion="2.0";X.privDefaultLanguageCode="en-US";X.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15";X.privWebSocketPath="/capito/translate";X.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"];var hc;function Og(){if(hc)return Lr;hc=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.ConversationManager=void 0;const r=F(),e=T,t=R(),n=pt;let p=class{constructor(){this.privRequestParams=n.ConversationConnectionConfig.configParams,this.privErrors=n.ConversationConnectionConfig.restErrors,this.privHost=n.ConversationConnectionConfig.host,this.privApiVersion=n.ConversationConnectionConfig.apiVersion,this.privRestPath=n.ConversationConnectionConfig.restPath,this.privRestAdapter=new r.RestMessageAdapter({})}createOrJoin(c,s,i,o){try{e.Contracts.throwIfNullOrUndefined(c,"args");const a=c.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,n.ConversationConnectionConfig.defaultLanguageCode),h=c.getProperty(t.PropertyId.ConversationTranslator_Name,"conversation_host"),d=c.getProperty(t.PropertyId.ConversationTranslator_Host,this.privHost),l=c.getProperty(t.PropertyId.ConversationTranslator_CorrelationId),v=c.getProperty(t.PropertyId.SpeechServiceConnection_Key),f=c.getProperty(t.PropertyId.SpeechServiceConnection_Region),m=c.getProperty(t.PropertyId.SpeechServiceAuthorization_Token);e.Contracts.throwIfNullOrWhitespace(a,"languageCode"),e.Contracts.throwIfNullOrWhitespace(h,"nickname"),e.Contracts.throwIfNullOrWhitespace(d,"endpointHost");const g={};g[this.privRequestParams.apiVersion]=this.privApiVersion,g[this.privRequestParams.languageCode]=a,g[this.privRequestParams.nickname]=h;const S={};l&&(S[this.privRequestParams.correlationId]=l),S[this.privRequestParams.clientAppId]=n.ConversationConnectionConfig.clientAppId,s!==void 0?g[this.privRequestParams.roomId]=s:(e.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionRegion),S[this.privRequestParams.subscriptionRegion]=f,v?S[this.privRequestParams.subscriptionKey]=v:m?S[this.privRequestParams.authorization]=`Bearer ${m}`:e.Contracts.throwIfNullOrUndefined(v,this.privErrors.authInvalidSubscriptionKey));const y={};y.headers=S,this.privRestAdapter.options=y;const E=`https://${d}${this.privRestPath}`;this.privRestAdapter.request(r.RestRequestType.Post,E,g,null).then(P=>{const b=r.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,P.headers);if(!P.ok){if(o){let z=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",P.status.toString()),N;try{N=JSON.parse(P.data),z+=` [${N.error.code}: ${N.error.message}]`}catch{z+=` [${P.data}]`}b&&(z+=` ${b}`),o(z)}return}const O=JSON.parse(P.data);if(O&&(O.requestId=b),i){try{i(O)}catch(z){o&&o(z)}i=void 0}}).catch(()=>{})}catch(a){if(o)if(a instanceof Error){const h=a;o(h.name+": "+h.message)}else o(a)}}leave(c,s){return new Promise((i,o)=>{try{e.Contracts.throwIfNullOrUndefined(c,this.privErrors.invalidArgs.replace("{arg}","config")),e.Contracts.throwIfNullOrWhitespace(s,this.privErrors.invalidArgs.replace("{arg}","token"));const a=c.getProperty(t.PropertyId.ConversationTranslator_Host,this.privHost),h=c.getProperty(t.PropertyId.ConversationTranslator_CorrelationId),d={};d[this.privRequestParams.apiVersion]=this.privApiVersion,d[this.privRequestParams.sessionToken]=s;const l={};h&&(l[this.privRequestParams.correlationId]=h);const v={};v.headers=l,this.privRestAdapter.options=v;const f=`https://${a}${this.privRestPath}`;this.privRestAdapter.request(r.RestRequestType.Delete,f,d,null).then(m=>{m.ok,i()}).catch(()=>{})}catch(a){if(a instanceof Error){const h=a;o(h.name+": "+h.message)}else o(a)}})}};return Lr.ConversationManager=p,Lr}var Ve={},xr={},Ln={},vi={};Object.defineProperty(vi,"__esModule",{value:!0});vi.ConversationConnectionMessage=void 0;const Mg=I();class Dg extends Mg.ConnectionMessage{constructor(e,t,n,p){super(e,t,n,p);const u=JSON.parse(this.textBody);u.type!==void 0&&(this.privConversationMessageType=u.type)}get conversationMessageType(){return this.privConversationMessageType}}vi.ConversationConnectionMessage=Dg;Object.defineProperty(Ln,"__esModule",{value:!0});Ln.ConversationWebsocketMessageFormatter=void 0;const Ke=I(),lc=vi;class kg{toConnectionMessage(e){const t=new Ke.Deferred;try{if(e.messageType===Ke.MessageType.Text){const n=new lc.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);t.resolve(n)}else e.messageType===Ke.MessageType.Binary&&t.resolve(new lc.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(n){t.reject(`Error formatting the message. Error: ${n}`)}return t.promise}fromConnectionMessage(e){const t=new Ke.Deferred;try{if(e.messageType===Ke.MessageType.Text){const n=`${e.textBody?e.textBody:""}`;t.resolve(new Ke.RawWebsocketMessage(Ke.MessageType.Text,n,e.id))}}catch(n){t.reject(`Error formatting the message. ${n}`)}return t.promise}}Ln.ConversationWebsocketMessageFormatter=kg;var vc;function zg(){if(vc)return xr;vc=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.ConversationConnectionFactory=void 0;const r=F(),e=I(),t=T,n=R(),p=de(),u=pt,c=Ln;let s=class extends p.ConnectionFactoryBase{create(o,a,h){const d=o.parameters.getProperty(n.PropertyId.ConversationTranslator_Host,u.ConversationConnectionConfig.host),l=o.parameters.getProperty(n.PropertyId.ConversationTranslator_CorrelationId,e.createGuid()),v=`wss://${d}${u.ConversationConnectionConfig.webSocketPath}`,f=o.parameters.getProperty(n.PropertyId.ConversationTranslator_Token,void 0);t.Contracts.throwIfNullOrUndefined(f,"token");const m={};m[u.ConversationConnectionConfig.configParams.apiVersion]=u.ConversationConnectionConfig.apiVersion,m[u.ConversationConnectionConfig.configParams.token]=f,m[u.ConversationConnectionConfig.configParams.correlationId]=l;const g=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new r.WebsocketConnection(v,m,{},new c.ConversationWebsocketMessageFormatter,r.ProxyInfo.fromRecognizerConfig(o),g,h)}};return xr.ConversationConnectionFactory=s,xr}var Br={},xn={},Ng=C&&C.__awaiter||function(r,e,t,n){function p(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function s(a){try{o(n.next(a))}catch(h){c(h)}}function i(a){try{o(n.throw(a))}catch(h){c(h)}}function o(a){a.done?u(a.value):p(a.value).then(s,i)}o((n=n.apply(r,e||[])).next())})};Object.defineProperty(xn,"__esModule",{value:!0});xn.ConversationRequestSession=void 0;const uo=I();class jg{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=uo.createNoDashGuid(),this.privRequestCompletionDeferral=new uo.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,t){this.privSessionId=t}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){e!==200&&e===403&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=uo.createNoDashGuid():this.onComplete()}dispose(){return Ng(this,void 0,void 0,function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach()}})}onComplete(){}}xn.ConversationRequestSession=jg;var Y={},fc;function sp(){if(fc)return Y;fc=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.ConversationReceivedTranslationEventArgs=Y.ParticipantsListEventArgs=Y.ParticipantAttributeEventArgs=Y.ParticipantEventArgs=Y.LockRoomEventArgs=Y.MuteAllEventArgs=void 0;const r=R();class e extends r.SessionEventArgs{constructor(i,o){super(o),this.privIsMuted=i}get isMuted(){return this.privIsMuted}}Y.MuteAllEventArgs=e;class t extends r.SessionEventArgs{constructor(i,o){super(o),this.privIsLocked=i}get isMuted(){return this.privIsLocked}}Y.LockRoomEventArgs=t;class n extends r.SessionEventArgs{constructor(i,o){super(o),this.privParticipant=i}get participant(){return this.privParticipant}}Y.ParticipantEventArgs=n;class p extends r.SessionEventArgs{constructor(i,o,a,h){super(h),this.privKey=o,this.privValue=a,this.privParticipantId=i}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}Y.ParticipantAttributeEventArgs=p;class u extends r.SessionEventArgs{constructor(i,o,a,h,d,l,v,f,m){super(m),this.privRoomId=i,this.privSessionToken=o,this.privTranslateTo=a,this.privProfanityFilter=h,this.privRoomProfanityFilter=d,this.privIsRoomLocked=l,this.privIsRoomLocked=v,this.privParticipants=f}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}Y.ParticipantsListEventArgs=u;class c{constructor(i,o,a){this.privPayload=o,this.privCommand=i,this.privSessionId=a}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}return Y.ConversationReceivedTranslationEventArgs=c,Y}var Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.ConversationTranslatorCommandTypes=Se.ConversationTranslatorMessageTypes=Se.InternalParticipants=void 0;class Lg{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(e===void 0)return;const t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(t=>t.id===e)}getParticipant(e){return this.participants.find(t=>t.id===e)}deleteParticipant(e){this.participants=this.participants.filter(t=>t.id!==e)}get host(){return this.participants.find(e=>e.isHost===!0)}get me(){return this.getParticipant(this.meId)}}Se.InternalParticipants=Lg;Se.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"};Se.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"};var ap={},Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.CommandResponsePayload=void 0;const xg=r=>JSON.parse(r);class Uo{constructor(e){this.privCommandResponse=xg(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new Uo(e)}}Bn.CommandResponsePayload=Uo;var nt={};Object.defineProperty(nt,"__esModule",{value:!0});nt.ParticipantPayloadResponse=nt.ParticipantsListPayloadResponse=void 0;const Bg=r=>JSON.parse(r),qg=r=>JSON.parse(r);class $o{constructor(e){this.privParticipantsPayloadResponse=Bg(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new $o(e)}}nt.ParticipantsListPayloadResponse=$o;class Wo{constructor(e){this.privParticipantPayloadResponse=qg(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new Wo(e)}}nt.ParticipantPayloadResponse=Wo;var ot={};Object.defineProperty(ot,"__esModule",{value:!0});ot.TextResponsePayload=ot.SpeechResponsePayload=void 0;const Fg=r=>JSON.parse(r),Ug=r=>JSON.parse(r);class Ho{constructor(e){this.privSpeechResponse=Fg(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(e){return new Ho(e)}}ot.SpeechResponsePayload=Ho;class Vo{constructor(e){this.privTextResponse=Ug(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new Vo(e)}}ot.TextResponsePayload=Vo;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Bn;Object.defineProperty(r,"CommandResponsePayload",{enumerable:!0,get:function(){return e.CommandResponsePayload}});var t=nt;Object.defineProperty(r,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return t.ParticipantsListPayloadResponse}}),Object.defineProperty(r,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return t.ParticipantPayloadResponse}});var n=ot;Object.defineProperty(r,"SpeechResponsePayload",{enumerable:!0,get:function(){return n.SpeechResponsePayload}}),Object.defineProperty(r,"TextResponsePayload",{enumerable:!0,get:function(){return n.TextResponsePayload}})})(ap);var gc;function $g(){if(gc)return Br;gc=1;var r=C&&C.__awaiter||function(a,h,d,l){function v(f){return f instanceof d?f:new d(function(m){m(f)})}return new(d||(d=Promise))(function(f,m){function g(E){try{y(l.next(E))}catch(P){m(P)}}function S(E){try{y(l.throw(E))}catch(P){m(P)}}function y(E){E.done?f(E.value):v(E.value).then(g,S)}y((l=l.apply(a,h||[])).next())})};Object.defineProperty(Br,"__esModule",{value:!0}),Br.ConversationServiceAdapter=void 0;const e=I(),t=R(),n=_(),p=vi,u=xn,c=sp(),s=Se,i=ap;let o=class extends n.ServiceRecognizerBase{constructor(h,d,l,v,f){super(h,d,l,v,f),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=f,this.privConversationAuthentication=h,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=m=>this.conversationConnectImpl(m),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new u.ConversationRequestSession(e.createNoDashGuid()),this.privConversationConnectionFactory=d,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}dispose(h){const d=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&(yield(yield this.privConnectionConfigPromise).dispose(h)),yield d.dispose.call(this,h)})}sendMessage(h){return r(this,void 0,void 0,function*(){return(yield this.fetchConnection()).send(new p.ConversationConnectionMessage(e.MessageType.Text,h))})}sendMessageAsync(h){return r(this,void 0,void 0,function*(){yield(yield this.fetchConnection()).send(new p.ConversationConnectionMessage(e.MessageType.Text,h))})}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,t.CancellationReason.Error,t.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}processTypeSpecificMessages(){return r(this,void 0,void 0,function*(){return!0})}cancelRecognition(h,d,l,v,f){this.terminateMessageLoop=!0;const m=new t.ConversationTranslationCanceledEventArgs(l,f,v,void 0,h);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,m)}catch{}}conversationConnectImpl(h){return r(this,void 0,void 0,function*(){return this.privConnectionLoop=this.startMessageLoop(),h})}receiveConversationMessageOverride(){return r(this,void 0,void 0,function*(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const h=new e.Deferred;try{const l=yield(yield this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return h.resolve(),Promise.resolve();if(!l)return this.receiveConversationMessageOverride();const v=this.privConversationRequestSession.sessionId,f=l.conversationMessageType.toLowerCase();let m=!1;try{switch(f){case"info":case"participant_command":case"command":const g=i.CommandResponsePayload.fromJSON(l.textBody);switch(g.command.toLowerCase()){case"participantlist":const O=i.ParticipantsListPayloadResponse.fromJSON(l.textBody),z=O.participants.map(ie=>({avatar:ie.avatar,displayName:ie.nickname,id:ie.participantId,isHost:ie.ishost,isMuted:ie.ismuted,isUsingTts:ie.usetts,preferredLanguage:ie.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new c.ParticipantsListEventArgs(O.roomid,O.token,O.translateTo,O.profanityFilter,O.roomProfanityFilter,O.roomLocked,O.muteAll,z,v));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new c.ParticipantAttributeEventArgs(g.participantId,s.ConversationTranslatorCommandTypes.setTranslateToLanguages,g.value,v));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new c.ParticipantAttributeEventArgs(g.participantId,s.ConversationTranslatorCommandTypes.setProfanityFiltering,g.value,v));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new c.ParticipantAttributeEventArgs(g.participantId,s.ConversationTranslatorCommandTypes.setMute,g.value,v));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new c.MuteAllEventArgs(g.value,v));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new t.ConversationExpirationEventArgs(g.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new c.ParticipantAttributeEventArgs(g.participantId,s.ConversationTranslatorCommandTypes.setUseTTS,g.value,v));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new c.LockRoomEventArgs(g.value,v));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new c.ParticipantAttributeEventArgs(g.participantId,s.ConversationTranslatorCommandTypes.changeNickname,g.value,v));break;case"joinsession":const N=i.ParticipantPayloadResponse.fromJSON(l.textBody),ye={avatar:N.avatar,displayName:N.nickname,id:N.participantId,isHost:N.ishost,isMuted:N.ismuted,isUsingTts:N.usetts,preferredLanguage:N.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new c.ParticipantEventArgs(ye,v));break;case"leavesession":const dt={id:g.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new c.ParticipantEventArgs(dt,v));break;case"disconnectsession":const fi={id:g.participantId};break;case"token":const gi=new n.CognitiveTokenAuthentication(()=>{const ie=g.token;return Promise.resolve(ie)},()=>{const ie=g.token;return Promise.resolve(ie)});this.authentication=gi,this.privConversationServiceConnector.onToken(gi);break;default:break}break;case"partial":case"final":const S=i.SpeechResponsePayload.fromJSON(l.textBody),y=f==="final"?t.ResultReason.TranslatedParticipantSpeech:t.ResultReason.TranslatingParticipantSpeech,E=new t.ConversationTranslationResult(S.participantId,this.getTranslations(S.translations),S.language,S.id,y,S.recognition,void 0,void 0,l.textBody,void 0);S.isFinal?((E.text!==void 0&&E.text.length>0||S.id===this.privLastPartialUtteranceId)&&(m=!0),m&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new c.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.final,E,v))):E.text!==void 0&&(this.privLastPartialUtteranceId=S.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new c.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.partial,E,v)));break;case"translated_message":const P=i.TextResponsePayload.fromJSON(l.textBody),b=new t.ConversationTranslationResult(P.participantId,this.getTranslations(P.translations),P.language,void 0,void 0,P.originalText,void 0,void 0,void 0,l.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new c.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.instantMessage,b,v));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return h.promise})}startMessageLoop(){return r(this,void 0,void 0,function*(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const h=this.receiveConversationMessageOverride();try{return yield h}catch(d){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",t.CancellationReason.Error,t.CancellationErrorCode.RuntimeError,d),null}})}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(h=>h.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(h=>h),this.privConnectionConfigPromise)}getTranslations(h){let d;if(h!==void 0){d=new t.Translations;for(const l of h)d.set(l.lang,l.translation)}return d}};return Br.ConversationServiceAdapter=o,Br}var mc;function Wg(){if(mc)return Ve;mc=1;var r=C&&C.__awaiter||function(o,a,h,d){function l(v){return v instanceof h?v:new h(function(f){f(v)})}return new(h||(h=Promise))(function(v,f){function m(y){try{S(d.next(y))}catch(E){f(E)}}function g(y){try{S(d.throw(y))}catch(E){f(E)}}function S(y){y.done?v(y.value):l(y.value).then(m,g)}S((d=d.apply(o,a||[])).next())})};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.ConversationTranslatorRecognizer=Ve.ConversationRecognizerFactory=void 0;const e=_(),t=I(),n=T,p=R(),u=zg(),c=$g();class s{static fromConfig(a,h,d){return new i(a,h,d)}}Ve.ConversationRecognizerFactory=s;let i=class extends p.Recognizer{constructor(a,h,d){const l=h;n.Contracts.throwIfNull(l,"speechConfig");const v=a;n.Contracts.throwIfNull(v,"conversationImpl"),super(d,l.properties,new u.ConversationConnectionFactory),this.privConversation=v,this.privIsDisposed=!1,this.privProperties=l.properties.clone(),this.privConnection=p.Connection.fromRecognizer(this),this.privProperties.getProperty(p.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=t.Timeout.setTimeout,this.privClearTimeout=t.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(a){this.privConnection.connected=a}set disconnected(a){this.privConnection.disconnected=a}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(a,h,d){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfNullOrWhitespace(a,"token"),this.privReco.conversationTranslatorToken=a,this.resetConversationTimeout(),this.privReco.connectAsync(h,d)}catch(l){if(d)if(l instanceof Error){const v=l;d(v.name+": "+v.message)}else d(l)}}disconnect(a,h){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{a&&a()},d=>{h&&h(d)})}catch(d){if(h)if(d instanceof Error){const l=d;h(l.name+": "+l.message)}else h(d);this.dispose(!0).catch(l=>{t.Events.instance.onEvent(new t.BackgroundEvent(l))})}}sendRequest(a,h,d){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(a,h,d)}catch(l){if(d)if(l instanceof Error){const v=l;d(v.name+": "+v.message)}else d(l);this.dispose(!0).catch(v=>{t.Events.instance.onEvent(new t.BackgroundEvent(v))})}}onToken(a){this.privConversation.onToken(a)}close(){return r(this,void 0,void 0,function*(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,yield this.dispose(!0))})}dispose(a){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privIsDisposed||a&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),yield h.dispose.call(this,a))})}createRecognizerConfig(a){return new e.RecognizerConfig(a,this.privProperties)}createServiceRecognizer(a,h,d,l){const v=d;return new c.ConversationServiceAdapter(a,h,v,l,this)}sendMessage(a,h,d){const l=this.privReco;((f,m,g)=>{f!==void 0?f.then(()=>{try{m&&m()}catch(S){g&&g(`'Unhandled error on promise callback: ${S}'`)}},S=>{try{g&&g(S)}catch{}}):g&&g("Null promise")})(l.sendMessageAsync(a),h,d),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};return Ve.ConversationTranslatorRecognizer=i,Ve}var qr={},Sc;function Hg(){if(Sc)return qr;Sc=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(qr,"__esModule",{value:!0}),qr.TranscriberRecognizer=void 0;const e=I(),t=T,n=R(),p=_();let u=class extends n.Recognizer{constructor(s,i){const o=s;t.Contracts.throwIfNull(o,"speechTranslationConfig");const a=i;t.Contracts.throwIfNull(a,"audioConfigImpl"),t.Contracts.throwIfNullOrWhitespace(o.speechRecognitionLanguage,n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage]),super(i,o.properties,new p.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return t.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){t.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,s)}set conversation(s){t.Contracts.throwIfNullOrUndefined(s,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=s}getConversationInfo(){return t.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(s){t.Contracts.throwIfNullOrUndefined(s,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=s}getMeetingInfo(){return t.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(s,i){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(p.RecognitionMode.Conversation),s,i)}stopContinuousRecognitionAsync(s,i){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),s,i)}close(){return r(this,void 0,void 0,function*(){this.privDisposedRecognizer||(yield this.dispose(!0))})}pushConversationEvent(s,i){return r(this,void 0,void 0,function*(){const o=this.privReco;t.Contracts.throwIfNullOrUndefined(o,"serviceRecognizer"),yield o.sendSpeechEventAsync(s,i)})}pushMeetingEvent(s,i){return r(this,void 0,void 0,function*(){const o=this.privReco;t.Contracts.throwIfNullOrUndefined(o,"serviceRecognizer"),yield o.sendMeetingSpeechEventAsync(s,i)})}enforceAudioGating(){return r(this,void 0,void 0,function*(){const o=(yield this.audioConfig.format).channels;if(o===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(o!==8)throw new Error(`Unsupported audio configuration: Detected ${o}-channel audio`)})}connectMeetingCallbacks(s){this.isMeetingRecognizer=!0,this.canceled=(i,o)=>{s.canceled&&s.canceled(s,o)},this.recognizing=(i,o)=>{s.transcribing&&s.transcribing(s,o)},this.recognized=(i,o)=>{s.transcribed&&s.transcribed(s,o)},this.sessionStarted=(i,o)=>{s.sessionStarted&&s.sessionStarted(s,o)},this.sessionStopped=(i,o)=>{s.sessionStopped&&s.sessionStopped(s,o)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}dispose(s){const i=Object.create(null,{dispose:{get:()=>super.dispose}});return r(this,void 0,void 0,function*(){this.privDisposedRecognizer||(s&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield i.dispose.call(this,s))})}createRecognizerConfig(s){return new p.RecognizerConfig(s,this.properties)}createServiceRecognizer(s,i,o,a){const h=o;return new p.TranscriptionServiceRecognizer(s,i,h,a,this)}};return qr.TranscriberRecognizer=u,qr}var Cc;function Vg(){return Cc||(Cc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Og();Object.defineProperty(r,"ConversationManager",{enumerable:!0,get:function(){return e.ConversationManager}});var t=pt;Object.defineProperty(r,"ConversationConnectionConfig",{enumerable:!0,get:function(){return t.ConversationConnectionConfig}});var n=Wg();Object.defineProperty(r,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return n.ConversationRecognizerFactory}});var p=Hg();Object.defineProperty(r,"TranscriberRecognizer",{enumerable:!0,get:function(){return p.TranscriberRecognizer}});var u=sp();Object.defineProperty(r,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return u.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(r,"LockRoomEventArgs",{enumerable:!0,get:function(){return u.LockRoomEventArgs}}),Object.defineProperty(r,"MuteAllEventArgs",{enumerable:!0,get:function(){return u.MuteAllEventArgs}}),Object.defineProperty(r,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return u.ParticipantAttributeEventArgs}}),Object.defineProperty(r,"ParticipantEventArgs",{enumerable:!0,get:function(){return u.ParticipantEventArgs}}),Object.defineProperty(r,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return u.ParticipantsListEventArgs}});var c=Se;Object.defineProperty(r,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return c.ConversationTranslatorCommandTypes}}),Object.defineProperty(r,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return c.ConversationTranslatorMessageTypes}}),Object.defineProperty(r,"InternalParticipants",{enumerable:!0,get:function(){return c.InternalParticipants}})}(co)),co}var Ko={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SynthesisAudioMetadata=r.MetadataType=void 0,function(t){t.WordBoundary="WordBoundary",t.Bookmark="Bookmark",t.Viseme="Viseme",t.SentenceBoundary="SentenceBoundary",t.SessionEnd="SessionEnd",t.AvatarSignal="TalkingAvatarSignal"}(r.MetadataType||(r.MetadataType={}));class e{constructor(n){this.privSynthesisAudioMetadata=JSON.parse(n)}static fromJSON(n){return new e(n)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}r.SynthesisAudioMetadata=e})(Ko);var Fr={},le={};Object.defineProperty(le,"__esModule",{value:!0});le.SynthesisStartedEvent=le.ConnectingToSynthesisServiceEvent=le.SynthesisTriggeredEvent=le.SpeechSynthesisEvent=void 0;const yc=I();class qn extends yc.PlatformEvent{constructor(e,t,n=yc.EventType.Info){super(e,n),this.privRequestId=t}get requestId(){return this.privRequestId}}le.SpeechSynthesisEvent=qn;class Kg extends qn{constructor(e,t,n){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=n}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}le.SynthesisTriggeredEvent=Kg;class Jg extends qn{constructor(e,t){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}le.ConnectingToSynthesisServiceEvent=Jg;class Gg extends qn{constructor(e,t){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}le.SynthesisStartedEvent=Gg;var Rc;function Qg(){if(Rc)return Fr;Rc=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.SynthesisTurn=void 0;const e=I(),t=$,n=R(),p=Ko,u=le;let c=class So{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=e.createNoDashGuid(),this.privTurnDeferral=new e.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(i){this.privStreamId=i}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(i){this.privAudioOutputFormat=i}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const i=new n.PropertyCollection;return i.setProperty(n.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),i}}getAllReceivedAudio(){return r(this,void 0,void 0,function*(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(yield this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null})}getAllReceivedAudioWithHeader(){return r(this,void 0,void 0,function*(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const i=yield this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(i),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()})}startNewSynthesis(i,o,a,h){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=i,this.privRawText=o,this.privIsSSML=a,this.privAudioOutputStream=new t.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",h!==void 0&&(this.privTurnAudioDestination=h,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new u.SynthesisTriggeredEvent(this.requestId,void 0,h===void 0?void 0:h.id()))}onPreConnectionStart(i){this.privAuthFetchEventId=i,this.onEvent(new u.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(i){i&&this.onComplete()}onConnectionEstablishCompleted(i){if(i===200){this.onEvent(new u.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else i===403&&this.onComplete()}onServiceResponseMessage(i){const o=JSON.parse(i);this.streamId=o.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(i){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new e.Deferred;const o=JSON.parse(i);o.webrtc&&(this.privWebRTCSDP=o.webrtc.connectionString)}onAudioChunkReceived(i){this.isSynthesizing&&(this.privAudioOutputStream.write(i),this.privBytesReceived+=i.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(i))}onTextBoundaryEvent(i){this.updateTextOffset(i.Data.text.Text,i.Type)}onVisemeMetadataReceived(i){i.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=i.Data.AnimationChunk)}onSessionEnd(i){this.privAudioDuration=i.Data.Offset}constructSynthesisResult(){return r(this,void 0,void 0,function*(){const i=yield this.getAllReceivedAudioWithHeader();return new n.SpeechSynthesisResult(this.requestId,n.ResultReason.SynthesizingAudioCompleted,i,void 0,this.extraProperties,this.audioDuration)})}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const i=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",i}onEvent(i){e.Events.instance.onEvent(i)}static isXmlTag(i){return i.length>=2&&i[0]==="<"&&i[i.length-1]===">"}updateTextOffset(i,o){o===p.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(i,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+i.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!So.isXmlTag(i)&&this.updateTextOffset(i,o))):(this.privSentenceOffset=this.privRawText.indexOf(i,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+i.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!So.isXmlTag(i)&&this.updateTextOffset(i,o)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}readAllAudioFromStream(){return r(this,void 0,void 0,function*(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{yield this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}})}withinXmlTag(i){return this.privRawText.indexOf("<",i+1)>this.privRawText.indexOf(">",i+1)}};return Fr.SynthesisTurn=c,Fr}var Ur={},Pc;function Zg(){if(Pc)return Ur;Pc=1;var r=C&&C.__awaiter||function(c,s,i,o){function a(h){return h instanceof i?h:new i(function(d){d(h)})}return new(i||(i=Promise))(function(h,d){function l(m){try{f(o.next(m))}catch(g){d(g)}}function v(m){try{f(o.throw(m))}catch(g){d(g)}}function f(m){m.done?h(m.value):a(m.value).then(l,v)}f((o=o.apply(c,s||[])).next())})};Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.SynthesisAdapterBase=void 0;const e=I(),t=R(),n=_(),p=Ce;let u=class{constructor(s,i,o,a){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!s)throw new e.ArgumentNullError("authentication");if(!i)throw new e.ArgumentNullError("connectionFactory");if(!o)throw new e.ArgumentNullError("synthesizerConfig");this.privAuthentication=s,this.privConnectionFactory=i,this.privSynthesizerConfig=o,this.privIsDisposed=!1,this.privSessionAudioDestination=a,this.privSynthesisTurn=new n.SynthesisTurn,this.privConnectionEvents=new e.EventSource,this.privServiceEvents=new e.EventSource,this.privSynthesisContext=new n.SynthesisContext,this.privAgentConfig=new n.AgentConfig,this.connectionEvents.attach(h=>{if(h.name==="ConnectionClosedEvent"){const d=h;d.statusCode!==1e3&&this.cancelSynthesisLocal(t.CancellationReason.Error,d.statusCode===1007?t.CancellationErrorCode.BadRequestParameters:t.CancellationErrorCode.ConnectionFailure,`${d.reason} websocket error code: ${d.statusCode}`)}})}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(s){this.privActivityTemplate=s}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(s){this.privAudioOutputFormat=s,this.privSynthesisTurn.audioOutputFormat=s,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=s),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=s)}isDisposed(){return this.privIsDisposed}dispose(s){return r(this,void 0,void 0,function*(){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&(yield(yield this.privConnectionConfigurationPromise).dispose(s))})}connect(){return r(this,void 0,void 0,function*(){yield this.connectImpl()})}sendNetworkMessage(s,i){return r(this,void 0,void 0,function*(){const o=typeof i=="string"?e.MessageType.Text:e.MessageType.Binary,a=typeof i=="string"?"application/json":"";return(yield this.fetchConnection()).send(new p.SpeechConnectionMessage(o,s,this.privSynthesisTurn.requestId,a,i))})}Speak(s,i,o,a,h,d){return r(this,void 0,void 0,function*(){let l;if(i?l=s:l=this.privSynthesizer.buildSsml(s),this.speakOverride!==void 0)return this.speakOverride(l,o,a,h);this.privSuccessCallback=a,this.privErrorCallback=h,this.privSynthesisTurn.startNewSynthesis(o,s,i,d);try{yield this.connectImpl();const v=yield this.fetchConnection();yield this.sendSynthesisContext(v),yield this.sendSsmlMessage(v,l,o),this.onSynthesisStarted(o),this.receiveMessage()}catch(v){return this.cancelSynthesisLocal(t.CancellationReason.Error,t.CancellationErrorCode.ConnectionFailure,v),Promise.reject(v)}})}stopSpeaking(){return r(this,void 0,void 0,function*(){return yield this.connectImpl(),(yield this.fetchConnection()).send(new p.SpeechConnectionMessage(e.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))})}cancelSynthesis(s,i,o,a){const h=new t.PropertyCollection;h.setProperty(n.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]);const d=new t.SpeechSynthesisResult(s,t.ResultReason.Canceled,void 0,a,h);if(this.onSynthesisCancelled(d),this.privSuccessCallback)try{this.privSuccessCallback(d)}catch{}}cancelSynthesisLocal(s,i,o){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,s,i,o))}processTypeSpecificMessages(s){return!0}receiveMessage(){return r(this,void 0,void 0,function*(){try{const i=yield(yield this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!i)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const o=p.SpeechConnectionMessage.fromConnectionMessage(i);if(o.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(o.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(o.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(o.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===o.streamId.toLowerCase()&&o.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(o.binaryBody),this.onSynthesizing(o.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(o.binaryBody));break;case"audio.metadata":const a=n.SynthesisAudioMetadata.fromJSON(o.textBody).Metadata;for(const d of a)switch(d.Type){case n.MetadataType.WordBoundary:case n.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(d);const l=new t.SpeechSynthesisWordBoundaryEventArgs(d.Data.Offset,d.Data.Duration,d.Data.text.Text,d.Data.text.Length,d.Type===n.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,d.Data.text.BoundaryType);this.onWordBoundary(l);break;case n.MetadataType.Bookmark:const v=new t.SpeechSynthesisBookmarkEventArgs(d.Data.Offset,d.Data.Bookmark);this.onBookmarkReached(v);break;case n.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(d),d.Data.IsLastAnimation){const f=new t.SpeechSynthesisVisemeEventArgs(d.Data.Offset,d.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(f)}break;case n.MetadataType.AvatarSignal:this.onAvatarEvent(d);break;case n.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(d);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let h;try{h=yield this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(h)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.onSynthesisCompleted(h);break;default:this.processTypeSpecificMessages(o)||this.privServiceEvents&&this.serviceEvents.onEvent(new e.ServiceEvent(o.path.toLowerCase(),o.textBody))}return this.receiveMessage()}catch{}})}sendSynthesisContext(s){this.setSynthesisContextSynthesisSection();const i=this.synthesisContext.toJSON();if(i)return s.send(new p.SpeechConnectionMessage(e.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",i))}setSpeechConfigSynthesisSection(){}connectImpl(s=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(o=>o.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=e.createNoDashGuid(),this.privConnectionId=e.createNoDashGuid(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const i=s?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=i.then(o=>r(this,void 0,void 0,function*(){this.privSynthesisTurn.onAuthCompleted(!1);const a=this.privConnectionFactory.create(this.privSynthesizerConfig,o,this.privConnectionId);a.events.attach(d=>{this.connectionEvents.onEvent(d)});const h=yield a.open();return h.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(h.statusCode),Promise.resolve(a)):h.statusCode===403&&!s?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(h.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${h.statusCode}, ${this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${h.reason}`))}),o=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(o)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(s,i){if(i)return s.send(new p.SpeechConnectionMessage(e.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",i))}sendSsmlMessage(s,i,o){return s.send(new p.SpeechConnectionMessage(e.MessageType.Text,"ssml",o,"application/ssml+xml",i))}fetchConnection(){return r(this,void 0,void 0,function*(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(s=>s.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)})}configureConnection(){return r(this,void 0,void 0,function*(){const s=yield this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(s):(this.setSpeechConfigSynthesisSection(),yield this.sendSpeechServiceConfig(s,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),s)})}onAvatarEvent(s){}onSynthesisStarted(s){}onSynthesizing(s){}onSynthesisCancelled(s){}onSynthesisCompleted(s){}onWordBoundary(s){}onVisemeReceived(s){}onBookmarkReached(s){}};return Ur.SynthesisAdapterBase=u,u.telemetryDataEnabled=!0,Ur}var $r={},Ec;function Xg(){if(Ec)return $r;Ec=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.AvatarSynthesisAdapter=void 0;const r=R(),e=_();let t=class extends e.SynthesisAdapterBase{constructor(p,u,c,s,i){super(p,u,c,void 0),this.privAvatarSynthesizer=s,this.privSynthesizer=s,this.privAvatarConfig=i}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){var p,u,c,s,i,o,a,h,d,l,v,f,m,g,S,y;this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:(p=this.privAvatarConfig.videoFormat)===null||p===void 0?void 0:p.bitrate,codec:(u=this.privAvatarConfig.videoFormat)===null||u===void 0?void 0:u.codec,crop:{bottomRight:{x:(i=(s=(c=this.privAvatarConfig.videoFormat)===null||c===void 0?void 0:c.cropRange)===null||s===void 0?void 0:s.bottomRight)===null||i===void 0?void 0:i.x,y:(h=(a=(o=this.privAvatarConfig.videoFormat)===null||o===void 0?void 0:o.cropRange)===null||a===void 0?void 0:a.bottomRight)===null||h===void 0?void 0:h.y},topLeft:{x:(v=(l=(d=this.privAvatarConfig.videoFormat)===null||d===void 0?void 0:d.cropRange)===null||l===void 0?void 0:l.topLeft)===null||v===void 0?void 0:v.x,y:(g=(m=(f=this.privAvatarConfig.videoFormat)===null||f===void 0?void 0:f.cropRange)===null||m===void 0?void 0:m.topLeft)===null||g===void 0?void 0:g.y}},resolution:{height:(S=this.privAvatarConfig.videoFormat)===null||S===void 0?void 0:S.height,width:(y=this.privAvatarConfig.videoFormat)===null||y===void 0?void 0:y.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style}}}onAvatarEvent(p){if(this.privAvatarSynthesizer.avatarEventReceived){const u=new r.AvatarEventArgs(p.Data.Offset,p.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,u)}catch{}}}};return $r.AvatarSynthesisAdapter=t,$r}var Wr={},_c;function Yg(){if(_c)return Wr;_c=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.SpeechSynthesisAdapter=void 0;const r=R(),e=_();let t=class extends e.SynthesisAdapterBase{constructor(p,u,c,s,i){super(p,u,c,i),this.privSpeechSynthesizer=s,this.privSynthesizer=s}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(p){const u=new r.SpeechSynthesisEventArgs(new r.SpeechSynthesisResult(p,r.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,u)}onSynthesizing(p){if(this.privSpeechSynthesizer.synthesizing)try{const u=this.privSynthesisTurn.audioOutputFormat.addHeader(p),c=new r.SpeechSynthesisEventArgs(new r.SpeechSynthesisResult(this.privSynthesisTurn.requestId,r.ResultReason.SynthesizingAudio,u));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,c)}catch{}}onSynthesisCancelled(p){if(this.privSpeechSynthesizer.SynthesisCanceled){const u=new r.SpeechSynthesisEventArgs(p);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,u)}catch{}}}onSynthesisCompleted(p){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new r.SpeechSynthesisEventArgs(p))}catch{}}onWordBoundary(p){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,p)}catch{}}onVisemeReceived(p){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,p)}catch{}}onBookmarkReached(p){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,p)}catch{}}};return Wr.SpeechSynthesisAdapter=t,Wr}var Hr={},Ic;function em(){if(Ic)return Hr;Ic=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.SynthesisRestAdapter=void 0;const r=F(),e=R(),t=de(),n=q;let p=class{constructor(c,s){let i=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!i){const a=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"westus"),h=t.ConnectionFactoryBase.getHostSuffix(a);i=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`https://${a}.tts.speech${h}`)}this.privUri=`${i}/cognitiveservices/voices/list`;const o=r.RestConfigBase.requestOptions;this.privRestAdapter=new r.RestMessageAdapter(o),this.privAuthentication=s}getVoicesList(c){return this.privRestAdapter.setHeaders(n.HeaderNames.ConnectionId,c),this.privAuthentication.fetch(c).then(s=>(this.privRestAdapter.setHeaders(s.headerName,s.token),this.privRestAdapter.request(r.RestRequestType.Get,this.privUri)))}};return Hr.SynthesisRestAdapter=p,Hr}var po={},Tc;function tm(){return Tc||(Tc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SynthesizerConfig=r.SynthesisServiceType=void 0;const e=_();var t;(function(p){p[p.Standard=0]="Standard",p[p.Custom=1]="Custom"})(t=r.SynthesisServiceType||(r.SynthesisServiceType={}));class n{constructor(u,c){this.privSynthesisServiceType=t.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=u||new e.SpeechServiceConfig(new e.Context(null)),this.privParameters=c}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(u){this.privSynthesisServiceType=u}set synthesisVideoSection(u){this.privSpeechServiceConfig.Context.synthesis={video:u}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}}r.SynthesizerConfig=n}(po)),po}var Vr={},Ac;function rm(){if(Ac)return Vr;Ac=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.SynthesisContext=void 0;const r=R();let e=class{constructor(){this.privContext={}}setSection(n,p){this.privContext[n]=p}set audioOutputFormat(n){this.privAudioOutputFormat=n}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(n){const p=this.buildSynthesisContext(n);this.setSection("synthesis",p)}buildSynthesisContext(n){return{audio:{metadataOptions:{bookmarkEnabled:!!(n!=null&&n.bookmarkReached),punctuationBoundaryEnabled:n==null?void 0:n.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!(n!=null&&n.wordBoundary)),sentenceBoundaryEnabled:n==null?void 0:n.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!(n!=null&&n.visemeReceived),wordBoundaryEnabled:n==null?void 0:n.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!(n!=null&&n.wordBoundary))},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:n==null?void 0:n.autoDetectSourceLanguage}}}};return Vr.SynthesisContext=e,Vr}var Kr={},wc;function im(){if(wc)return Kr;wc=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.SpeakerRecognitionConfig=void 0;const r=_();let e=class{constructor(n,p){this.privContext=n||new r.Context(null),this.privParameters=p}get parameters(){return this.privParameters}get Context(){return this.privContext}};return Kr.SpeakerRecognitionConfig=e,Kr}var Jr={},bc;function nm(){if(bc)return Jr;bc=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.SpeakerServiceRecognizer=void 0;const e=F(),t=I(),n=R(),p=_(),u=Ce;let c=class extends p.ServiceRecognizerBase{constructor(i,o,a,h,d){super(i,o,a,h,d),this.privSpeakerRecognizer=d,this.privSpeakerAudioSource=a,this.recognizeSpeaker=l=>this.recognizeSpeakerOnce(l),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(i){let o=!1;const a=new n.PropertyCollection;switch(i.messageType===t.MessageType.Text&&a.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,i.textBody),i.path.toLowerCase()){case"speaker.response":const d=JSON.parse(i.textBody);let l;d.status.statusCode.toLowerCase()!=="success"?l=new n.SpeakerRecognitionResult(d,n.ResultReason.Canceled,n.CancellationErrorCode.ServiceError,d.status.reason):l=new n.SpeakerRecognitionResult(d,n.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(l),o=!0;break}const h=new t.Deferred;return h.resolve(o),h.promise}cancelRecognition(i,o,a,h,d){if(new n.PropertyCollection().setProperty(p.CancellationErrorCodePropertyName,n.CancellationErrorCode[h]),this.privResultDeferral){const v=new n.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:d,reason:d}},n.ResultReason.Canceled,h,d);try{this.privResultDeferral.resolve(v)}catch(f){this.privResultDeferral.reject(f)}}}recognizeSpeakerOnce(i){return r(this,void 0,void 0,function*(){this.privSpeakerModel=i,this.voiceProfileType=i.scenario,this.privResultDeferral||(this.privResultDeferral=new t.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const o=this.connectImpl(),a=this.sendPreAudioMessages(this.extractSpeakerContext(i)),h=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),d=yield this.privSpeakerAudioSource.format,l=yield this.privSpeakerAudioSource.deviceInfo,v=new e.ReplayableAudioNode(h,d.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(v,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:l};try{yield o,yield a}catch(g){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,g)}const f=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,f),this.receiveMessage(),this.sendAudio(v).then(()=>{},g=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,g)}),this.privResultDeferral.promise})}sendPreAudioMessages(i){return r(this,void 0,void 0,function*(){const o=yield this.fetchConnection();yield this.sendSpeakerRecognition(o,i)})}sendSpeakerRecognition(i,o){return r(this,void 0,void 0,function*(){const a=JSON.stringify(o);return i.send(new u.SpeechConnectionMessage(t.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",a))})}extractSpeakerContext(i){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:i.profileIds,scenario:i.scenario}}};return Jr.SpeakerServiceRecognizer=c,Jr}var Gr={},Oc;function om(){if(Oc)return Gr;Oc=1;var r=C&&C.__awaiter||function(s,i,o,a){function h(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function v(g){try{m(a.next(g))}catch(S){l(S)}}function f(g){try{m(a.throw(g))}catch(S){l(S)}}function m(g){g.done?d(g.value):h(g.value).then(v,f)}m((a=a.apply(s,i||[])).next())})};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.VoiceServiceRecognizer=void 0;const e=F(),t=I(),n=R(),p=_(),u=Ce;let c=class extends p.ServiceRecognizerBase{constructor(i,o,a,h,d){super(i,o,a,h,d),this.privDeferralMap=new t.DeferralMap,this.privSpeakerAudioSource=a,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(i){this.privSpeakerAudioSource=i}processTypeSpecificMessages(i){let o=!1;const a=new n.PropertyCollection;switch(i.messageType===t.MessageType.Text&&a.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,i.textBody),i.path.toLowerCase()){case"speaker.profiles":const d=JSON.parse(i.textBody);switch(d.operation.toLowerCase()){case"create":this.handleCreateResponse(d,i.requestId);break;case"delete":case"reset":this.handleResultResponse(d,i.requestId);break;case"fetch":const m=JSON.parse(i.textBody);this.handleFetchResponse(m,i.requestId);break}o=!0;break;case"speaker.phrases":const l=JSON.parse(i.textBody);this.handlePhrasesResponse(l,i.requestId),o=!0;break;case"speaker.profile.enrollment":const v=JSON.parse(i.textBody),f=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(v.enrollment?v.enrollment.enrollmentStatus:v.status.statusCode),v.enrollment?JSON.stringify(v.enrollment):void 0,v.status.reason);this.privDeferralMap.getId(i.requestId)&&this.privDeferralMap.complete(i.requestId,f),this.privRequestSession.onSpeechEnded(),o=!0;break}const h=new t.Deferred;return h.resolve(o),h.promise}cancelRecognition(i,o,a,h,d){new n.PropertyCollection().setProperty(p.CancellationErrorCodePropertyName,n.CancellationErrorCode[h]);const v=new n.VoiceProfileEnrollmentResult(n.ResultReason.Canceled,d,d);this.privDeferralMap.getId(o)&&this.privDeferralMap.complete(o,v)}createProfile(i,o){return r(this,void 0,void 0,function*(){this.voiceProfileType=i.toString();const a=this.connectImpl();try{const h=new t.Deferred;return yield a,yield this.sendCreateProfile(h,i,o),this.receiveMessage(),h.promise}catch(h){throw h}})}resetProfile(i){return r(this,void 0,void 0,function*(){return this.voiceProfileType=i.profileType.toString(),this.sendCommonRequest("reset",i.profileType,i)})}deleteProfile(i){return r(this,void 0,void 0,function*(){return this.voiceProfileType=i.profileType.toString(),this.sendCommonRequest("delete",i.profileType,i)})}retrieveEnrollmentResult(i){return r(this,void 0,void 0,function*(){return this.voiceProfileType=i.profileType.toString(),this.privExpectedProfileId=i.profileId,this.sendCommonRequest("fetch",i.profileType,i)})}getAllProfiles(i){return r(this,void 0,void 0,function*(){return this.voiceProfileType=i.toString(),this.sendCommonRequest("fetch",i)})}getActivationPhrases(i,o){return r(this,void 0,void 0,function*(){this.voiceProfileType=i.toString();const a=this.connectImpl();try{const h=new t.Deferred;return yield a,yield this.sendPhrasesRequest(h,i,o),this.receiveMessage(),h.promise}catch(h){throw h}})}enrollProfile(i){return r(this,void 0,void 0,function*(){this.voiceProfileType=i.profileType.toString();const o=new t.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const a=this.connectImpl(),h=this.sendPreAudioMessages(i,o),d=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),l=yield this.privSpeakerAudioSource.format,v=yield this.privSpeakerAudioSource.deviceInfo,f=new e.ReplayableAudioNode(d,l.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(f,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:v};try{yield a,yield h}catch(S){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,S)}const m=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,m),this.receiveMessage(),this.sendAudio(f).then(()=>{},S=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,S)}),o.promise})}sendPreAudioMessages(i,o){return r(this,void 0,void 0,function*(){const a=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,o),yield this.sendBaseRequest(a,"enroll",this.scenarioFrom(i.profileType),i)})}sendPhrasesRequest(i,o,a){return r(this,void 0,void 0,function*(){const h=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,i);const d=this.scenarioFrom(o),l={locale:a,scenario:d};return h.send(new u.SpeechConnectionMessage(t.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(l)))})}sendCreateProfile(i,o,a){return r(this,void 0,void 0,function*(){const h=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,i);const d=o===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":o===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",l={locale:a,number:"1",scenario:d};return h.send(new u.SpeechConnectionMessage(t.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(l)))})}sendCommonRequest(i,o,a=void 0){return r(this,void 0,void 0,function*(){const h=this.connectImpl();try{const d=new t.Deferred;this.privRequestSession.onSpeechContext(),yield h;const l=yield this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,d),yield this.sendBaseRequest(l,i,this.scenarioFrom(o),a),this.receiveMessage(),d.promise}catch(d){throw d}})}sendBaseRequest(i,o,a,h){return r(this,void 0,void 0,function*(){const d={scenario:a};return h?d.profileIds=[h.profileId]:d.maxPageSize=-1,i.send(new u.SpeechConnectionMessage(t.MessageType.Text,`speaker.profile.${o}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(d)))})}extractSpeakerContext(i){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:i.profileIds,scenario:i.scenario}}handlePhrasesResponse(i,o){if(this.privDeferralMap.getId(o))if(i.status.statusCode.toLowerCase()!=="success"){const a=n.ResultReason.Canceled,h=new n.VoiceProfilePhraseResult(a,i.status.statusCode,i.passPhraseType,[]);this.privDeferralMap.complete(o,h)}else if(i.phrases&&i.phrases.length>0){const a=n.ResultReason.EnrollingVoiceProfile,h=new n.VoiceProfilePhraseResult(a,i.status.statusCode,i.passPhraseType,i.phrases);this.privDeferralMap.complete(o,h)}else throw new Error("Voice Profile get activation phrases failed, no phrases received");else throw new Error(`Voice Profile get activation phrases request for requestID ${o} not found`)}handleCreateResponse(i,o){if(i.profiles&&i.profiles.length>0)if(this.privDeferralMap.getId(o)){const a=i.profiles.map(h=>h.profileId);this.privDeferralMap.complete(o,a)}else throw new Error(`Voice Profile create request for requestID ${o} not found`);else throw new Error("Voice Profile create failed, no profile id received")}handleResultResponse(i,o){if(this.privDeferralMap.getId(o)){const a=i.operation.toLowerCase()==="delete"?n.ResultReason.DeletedVoiceProfile:n.ResultReason.ResetVoiceProfile,h=i.status.statusCode.toLowerCase()==="success"?a:n.ResultReason.Canceled,d=new n.VoiceProfileResult(h,`statusCode: ${i.status.statusCode}, errorDetails: ${i.status.reason}`);this.privDeferralMap.complete(o,d)}else throw new Error(`Voice Profile create request for requestID ${o} not found`)}handleFetchResponse(i,o){if(this.privDeferralMap.getId(o)&&i.profiles[0]){if(this.privExpectedProfileId&&i.profiles.length===1&&i.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const a=i.profiles[0],h=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(a.enrollmentStatus),JSON.stringify(a),i.status.reason);this.privDeferralMap.complete(o,h)}else if(i.profiles.length>0){const a=i.profiles,h=[];for(const d of a)h.push(new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(d.enrollmentStatus),JSON.stringify(d),i.status.reason));this.privDeferralMap.complete(o,h)}}else throw new Error(`Voice Profile fetch request for requestID ${o} not found`)}enrollmentReasonFrom(i){switch(i.toLowerCase()){case"enrolled":return n.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return n.ResultReason.Canceled;default:return n.ResultReason.EnrollingVoiceProfile}}scenarioFrom(i){return i===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":i===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}};return Gr.VoiceServiceRecognizer=c,Gr}var cp={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.type=r.connectivity=r.Device=r.OS=r.System=r.Context=r.SpeechServiceConfig=void 0;class e{constructor(s){this.context=s}serialize(){return JSON.stringify(this,(s,i)=>{if(i&&typeof i=="object"&&!Array.isArray(i)){const o={};for(const a in i)Object.hasOwnProperty.call(i,a)&&(o[a&&a.charAt(0).toLowerCase()+a.substring(1)]=i[a]);return o}return i})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(s){this.recognition=s.toLowerCase()}}r.SpeechServiceConfig=e;class t{constructor(s){this.system=new n,this.os=s}}r.Context=t;class n{constructor(){const s="1.34.0";this.name="SpeechSDK",this.version=s,this.build="JavaScript",this.lang="JavaScript"}}r.System=n;class p{constructor(s,i,o){this.platform=s,this.name=i,this.version=o}}r.OS=p;class u{constructor(s,i,o){this.manufacturer=s,this.model=i,this.version=o}}r.Device=u,function(c){c.Bluetooth="Bluetooth",c.Wired="Wired",c.WiFi="WiFi",c.Cellular="Cellular",c.InBuilt="InBuilt",c.Unknown="Unknown"}(r.connectivity||(r.connectivity={})),function(c){c.Phone="Phone",c.Speaker="Speaker",c.Car="Car",c.Headset="Headset",c.Thermostat="Thermostat",c.Microphones="Microphones",c.Deskphone="Deskphone",c.RemoteControl="RemoteControl",c.Unknown="Unknown",c.File="File",c.Stream="Stream"}(r.type||(r.type={}))})(cp);var Mc;function _(){return Mc||(Mc=1,function(r){var e=C&&C.__createBinding||(Object.create?function(u,c,s,i){i===void 0&&(i=s),Object.defineProperty(u,i,{enumerable:!0,get:function(){return c[s]}})}:function(u,c,s,i){i===void 0&&(i=s),u[i]=c[s]}),t=C&&C.__exportStar||function(u,c){for(var s in u)s!=="default"&&!c.hasOwnProperty(s)&&e(c,u,s)};Object.defineProperty(r,"__esModule",{value:!0}),r.AutoDetectSourceLanguagesOpenRangeOptionName=r.ForceDictationPropertyName=r.ServicePropertiesPropertyName=r.CancellationErrorCodePropertyName=r.OutputFormatPropertyName=void 0,t(Ti,r),t(Ki,r),t(ut,r),t(ou,r),t(su,r),t(Kf(),r),t(Jf(),r),t(Pn,r),t(Gf(),r),t(Qf(),r),t(Zf(),r),t(Yu,r),t(En,r),t(Yf(),r),t(eg(),r),t(tg(),r),t(rg(),r),t(Qu(),r),t(ig(),r),t(ep,r),t(ng(),r),t(_n,r),t(ag(),r),t(cg(),r),t(In,r),t(Tn,r),t(An,r),t(ug(),r),t(pg(),r),t(dg(),r),t(hg(),r),t(lg(),r),t(wn,r),t(fg(),r),t(bn,r),t(np,r),t(On,r),t(Dn,r),t(kn,r),t(op,r),t(Ag(),r),t(jn,r),t(Vg(),r),t(Ko,r),t(Qg(),r),t(Zg(),r);var n=Xg();Object.defineProperty(r,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return n.AvatarSynthesisAdapter}});var p=Yg();Object.defineProperty(r,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return p.SpeechSynthesisAdapter}}),t(em(),r),t(tm(),r),t(rm(),r),t(im(),r),t(nm(),r),t(om(),r),t(cp,r),r.OutputFormatPropertyName="OutputFormat",r.CancellationErrorCodePropertyName="CancellationErrorCode",r.ServicePropertiesPropertyName="ServiceProperties",r.ForceDictationPropertyName="ForceDictation",r.AutoDetectSourceLanguagesOpenRangeOptionName="OpenRange"}($n)),$n}(function(r){var e=C&&C.__createBinding||(Object.create?function(p,u,c,s){s===void 0&&(s=c),Object.defineProperty(p,s,{enumerable:!0,get:function(){return u[c]}})}:function(p,u,c,s){s===void 0&&(s=c),p[s]=u[c]}),t=C&&C.__exportStar||function(p,u){for(var c in p)c!=="default"&&!u.hasOwnProperty(c)&&e(u,p,c)};Object.defineProperty(r,"__esModule",{value:!0});const n=_();new n.AgentConfig,t(R(),r)})(re);const sm=(r,e)=>{if(r=Jo(r),!e){console.log("AvatarSynthesizer is not initialized");return}if(!r||r===""){console.log("SSML Text is not provided");return}e.speakSsmlAsync(r).then(t=>{if(t.reason==="ResultReason.SynthesizingAudioCompleted")console.log(`Speech and avatar synthesized to video stream : ${t}`);else if(console.log(`Speech and avatar synthesis failed: ${t.resultId}`),t.reason===re.ResultReason.Canceled){const n=re.CancellationDetails.fromResult(t);console.log(`Speech synthesis canceled: ${n.errorDetails}`)}})},am=(r,e)=>{if(r=Jo(r),!e){console.log("AvatarSynthesizer is not initialized");return}if(!r||r===""){console.log("Text is not provided");return}e.speakTextAsync(r).then(t=>{if(t.reason==="ResultReason.SynthesizingAudioCompleted")console.log(`Speech and avatar synthesized to video stream : ${t}`);else if(console.log(`Speech and avatar synthesis failed: ${t.resultId}`),t.reason===re.ResultReason.Canceled){const n=re.CancellationDetails.fromResult(t);console.log(`Speech synthesis canceled: ${n.errorDetails}`)}})},cm=r=>(r=r.replace("indeed",""),r),Jo=r=>{const e=/[^0-9a-zA-Z-?!-. ,\n'"]/g;return r.replace(e,"")},Co={speak:am,speakSSML:sm,filterString:Jo,filterUnnessaceryWords:cm},um=()=>{let r={speechConfig:null,audioConfig:null,speechRecognizer:null,listeningTimeout:null,listeningLimit:3e3};return r.speechConfig=re.SpeechConfig.fromSubscription(L.AzureCredential.cognitive.accessKey,L.AzureCredential.cognitive.region),r.speechConfig.speechRecognitionLanguage=L.AvatarConfig.voicelanguage,r.audioConfig=re.AudioConfig.fromDefaultMicrophoneInput(),r.speechRecognizer=new re.SpeechRecognizer(r.speechConfig,r.audioConfig),r},pm=(r,e,t)=>{e.speechRecognizer.recognizing=(n,p)=>{r.value=p.result.text,console.log(`RECOGNIZING: Text=${p.result.text}`),Dc(e,t)},e.speechRecognizer.startContinuousRecognitionAsync(),Dc(e,t)},Dc=(r,e)=>{r.listeningTimeout&&clearTimeout(r.listeningTimeout),r.listeningTimeout=setTimeout(()=>{console.log("Silence detected, stopping listening"),up(),e()},r.listeningLimit)},dm=r=>{r.listeningTimeout&&clearTimeout(r.listeningTimeout),r.speechRecognizer=null},up=(r,e)=>{r&&(r.stopContinuousRecognitionAsync(dm(r)),e&&typeof e=="function"&&e())},Qr={initSpeechParams:um,startListening:pm,stopListening:up},pp={"Content-Type":"application/json"},hm=async(r,e)=>{const t=JSON.stringify({session_id:e,message:r});return fetch(`${L.Backend.url}:${L.Backend.port}/api/gpt/query`,{method:"POST",headers:pp,body:t}).then(n=>n.json()).then(n=>n.response).catch(n=>{throw console.error("Error:",n),n})},lm=async r=>{const e=JSON.stringify({session_id:r,message:""});return fetch(`${L.Backend.url}:${L.Backend.port}/api/gpt/query`,{method:"POST",headers:pp,body:e}).then(t=>t.json()).then(t=>t.response).catch(t=>{throw console.error("Error:",t),t})},vm={name:"ChattingBar",setup(r,{emit:e}){const t=Ii(),n=Te(!1),p=Te(""),u=Te(""),c=t.getters["accounts/getStudent"].username,s=t.getters["accounts/getTeacher"].username;let i=null;const o=m=>{Pi.emit("speak",m)},a=async m=>{try{if(m==="")return;t.dispatch("messages/addMessage",{message:m,username:c,created_at:new Date});const g=await t.getters["avatar/getSessionId"];let S=await hm(m,g);S=Co.filterUnnessaceryWords(S),t.dispatch("messages/addMessage",{message:S,username:s,created_at:new Date}),o(S)}catch(g){console.log(g)}},h=m=>{const g=p.value;p.value="",m.key==="Enter"&&a(g)},d=()=>{const m=u.value;u.value="",a(m),Qr.stopListening(i.speechRecognizer)},l=()=>{n.value?Qr.stopListening(i.speechRecognizer,d):(n.value=!n.value,Qr.startListening(u,i,d))},v=async()=>{try{await(y=>new Promise(E=>setTimeout(E,y)))(2e3);const g=t.getters["avatar/getSessionId"];let S=await lm(g);console.log(S),S=Co.filterUnnessaceryWords(S),t.dispatch("messages/addMessage",{message:S,username:s,created_at:new Date}),o(S)}catch(m){console.log(m)}},f=Pi.on("greet",v);return yo(()=>{i=Qr.initSpeechParams()}),Nc(()=>{Qr.stopListening(i.speechRecognizer),f()}),{communicate:a,voicetext:u,textmessage:p,isLitening:n,toggleListening:l,handleTextTyping:h}}},dp=r=>(yd("data-v-0ec310a2"),r=r(),Rd(),r),fm={class:"ChattingBar"},gm={key:0,class:"textBoxContainer shadow-md"},mm=dp(()=>ee("span",{class:"sendButtonIcon","aria-label":" "},"SEND",-1)),Sm=[mm],Cm={key:2,class:"textBoxContainer shadow-md"},ym=dp(()=>ee("span",{class:"micButtonIcon","aria-label":" "},"",-1)),Rm=[ym];function Pm(r,e,t,n,p,u){return ce(),he("div",fm,[n.isLitening?Un("",!0):(ce(),he("div",gm,[Yo(ee("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>n.textmessage=c),onKeyup:e[1]||(e[1]=Cd((...c)=>n.handleTextTyping&&n.handleTextTyping(...c),["enter"])),type:"text",class:"textBox",placeholder:" ."},null,544),[[es,n.textmessage]])])),n.isLitening?Un("",!0):(ce(),he("button",{key:1,class:"ChattingButton sendButton shadow-md",type:"button",onClick:e[2]||(e[2]=(...c)=>n.handleTextTyping&&n.handleTextTyping(...c))},Sm)),n.isLitening?(ce(),he("div",Cm,[Yo(ee("input",{"onUpdate:modelValue":e[3]||(e[3]=c=>n.voicetext=c),type:"text",class:"textBox",placeholder:" "},null,512),[[es,n.voicetext]])])):Un("",!0),ee("button",{class:"ChattingButton micButton shadow-md",type:"button",onClick:e[4]||(e[4]=(...c)=>n.toggleListening&&n.toggleListening(...c))},Rm)])}const Em=st(vm,[["render",Pm],["__scopeId","data-v-0ec310a2"]]),_m={name:"Message",props:{id:Number},setup(r){const e=Te(!1),t=Ii(),n=t.getters["messages/getMessageById"](r.id),p=t.getters["accounts/getStudent"].username;let u=null,c=null;return yo(()=>{u=setTimeout(()=>{e.value=!0,c=setTimeout(()=>{t.dispatch("messages/removeMessage",r.id)},L.MessageDuration.clean)},L.MessageDuration.display)}),Pd(()=>{clearTimeout(u),clearTimeout(c)}),{message:n.message,username:n.username,fadeOutApplied:e,myName:p}}},Im={class:"message-username"},Tm={class:"message-content"};function Am(r,e,t,n,p,u){return ce(),he("div",{class:jc(["message",{"fade-out":n.fadeOutApplied,"message-user":n.username===n.myName,"message-other":n.username!==n.myName}])},[ee("div",Im,ts(n.username),1),ee("div",Tm,[ee("p",null,ts(n.message),1)])],2)}const wm=st(_m,[["render",Am],["__scopeId","data-v-0aed9458"]]),bm={name:"ChattingBox",components:{ChattingBar:Em,Message:wm},setup(){const r=Ii();return{messages:ho(()=>r.getters["messages/getMessages"])}}},Om={class:"ChattingBox"},Mm={class:"message-container scroll shadow-lg small-rounded"};function Dm(r,e,t,n,p,u){const c=tt("ChattingBar"),s=tt("Message");return ce(),he("div",Om,[Xr(c),ee("div",Mm,[(ce(!0),he(Lc,null,Ed(n.messages,i=>(ce(),_d(s,{key:i.id,id:i.id,message:i.message,username:i.username,duration:i.render_duration},null,8,["id","message","username","duration"]))),128))])])}const kc=st(bm,[["render",Dm],["__scopeId","data-v-407dc231"]]),km={name:"ConnectionButton",setup(r,{emit:e}){const t=Te(0);return{HandleOnClick:()=>{try{t.value==0?(e("connect"),t.value=2):(e("disconnect"),t.value=0)}catch(p){console.log(p)}},connectionState:t}}};function zm(r,e,t,n,p,u){return ce(),he("button",{class:"connection-button",onClick:e[0]||(e[0]=(...c)=>n.HandleOnClick&&n.HandleOnClick(...c))},[ee("span",{class:jc(["connection-button-inner",{connected:n.connectionState==2},{connecting:n.connectionState==1}])},null,2)])}const Nm=st(km,[["render",zm],["__scopeId","data-v-8aaacae7"]]),jm=async(r,e,t)=>new RTCPeerConnection({iceServers:[{urls:r,username:e,credential:t}]}),Lm=async()=>{try{const r=re.SpeechConfig.fromSubscription(L.AzureCredential.cognitive.accessKey,L.AzureCredential.cognitive.region);r.speechSynthesisVoiceName=L.AvatarConfig.voice;const e=new re.AvatarVideoFormat;let t=new re.Coordinate(600,50),n=new re.Coordinate(1320,1080);e.setCropRange(t,n),console.log(e);const p=new re.AvatarConfig(L.AvatarConfig.character,L.AvatarConfig.style,e);p.backgroundColor=L.AvatarConfig.background,console.log(p);let u=new re.AvatarSynthesizer(r,p);return u.avatarEventReceived=(c,s)=>{let i=s.offset/1e4>0?`+${s.offset/1e4} ms`:"unknwon";console.log(`[${new Date().toISOString()}] Avatar Event received: ${s.EventType}, ${i}`)},u}catch(r){console.log(r)}},xm=async()=>jm(Je.state.iceserver.urls,Je.state.iceserver.username,Je.state.iceserver.credential),Bm=async(r,e,t)=>(console.log("updateOnTrack + peerConnection: ",r),r.ontrack=n=>{if(n.track.kind==="video"){console.log("video track received");const p=e.value;p.srcObject=n.streams[0],p.autoplay=!0}if(n.track.kind==="audio"){console.log("audio track received");const p=t.value;p.srcObject=n.streams[0],p.autoplay=!0,p.muted=!0}},r.addTransceiver("audio",{direction:"sendrecv"}),r.addTransceiver("video",{direction:"sendrecv"}),r.oniceconnectionstatechange=n=>{console.log(`oniceconnectionstatechange: ${r.iceConnectionState}`)},r),qm=(r,e)=>{Je.dispatch("avatar/updateSynthesizer",r),Je.dispatch("avatar/updateConnection",e)},Fm=async r=>{console.log("building AvatarSynthesizer...");const e=await Lm();return e.startAvatarAsync(r).then(()=>{console.log(`[${new Date().toISOString()}] Avatar started`)}).catch(t=>{console.log(`[${new Date().toISOString()}] Avatar start failed: ${t}`)}),e},Um=async(r,e)=>{try{const t=await xm(),n=await Bm(t,r,e),p=await Fm(n);return qm(p,n),p}catch(t){console.log(t)}},$m=async(r,e)=>{r&&e&&r.stopAvatarAsync().then(()=>{Je.dispatch("avatar/clearSynthesizer")}).then(()=>{e.close(),Je.dispatch("avatar/clearConnection")}).then(()=>{console.log(`[${new Date().toISOString()}] Avatar and RTCPeerConnection closed`)}).catch(t=>{console.log(t)})},hp={"Content-Type":"application/json"},Wm=r=>{console.log(r)},Hm=async r=>{const e=JSON.stringify({user_id:L.Accounts.student.username,subject_code:r});return console.log(`request to : ............. ${L.Backend.url}:${L.Backend.port}`),fetch(`${L.Backend.url}:${L.Backend.port}/api/session`,{method:"POST",headers:hp,body:e}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>t.session_id).catch(t=>{throw console.error("Error:",t),t})},Vm=async r=>fetch(`${L.Backend.url}:${L.Backend.port}/api/session/${r}`,{method:"DELETE",headers:hp}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).catch(e=>{throw console.error("Error:",e),e}),Km={name:"AvatarModule",components:{ConnectionButton:Nm},props:{course_code:String},setup(r){const e=Ii(),t=Te(!1),n=Te(null),p=Te(null),u="#/public/image/background.webp",c=()=>{Pi.emit("greet")},s=async()=>{try{t.value=!0;const d=await Hm(r.course_code);e.dispatch("avatar/updateSessionId",d);const l=await Um(n,p)}catch(d){console.log(d)}},i=async()=>{try{$m(e.getters["avatar/getSynthesizer"],e.getters["avatar/getConnection"]),await Vm(e.getters["avatar/getSessionId"]),e.getters["avatar/getSynthesizer"]!==null&&e.dispatch("avatar/clearSynthesizer"),e.dispatch("avatar/clearSessionId"),t.value=!1}catch(d){console.log(d)}},o=async d=>{try{p.value.muted=!1;const l=e.getters["avatar/getSynthesizer"];Co.speak(d,l)}catch(l){console.log(l)}},a=Pi.on("speak",o),h=()=>{const d=document.querySelector(".avatarBackground"),l=new Image,v=window.devicePixelRatio||1,f=d.getBoundingClientRect();d.width=f.width*v,d.height=f.height*v,l.onload=()=>{d.getContext("2d").drawImage(l,0,0,d.width,d.height)},l.src=u};return yo(()=>{h()}),Nc(()=>{a(),i(),e.dispatch("messages/clearMessages")}),{logEvent:Wm,videoElement:n,audioElement:p,displayFlag:t,handleConnect:s,handleDisconnect:i,emitRequestGreetings:c,imagePath:u}}},Jm={class:"AvatarModule"},Gm={className:"avatarVideo large-rounded"},Qm={class:"avatarAudioElement large-rounded",ref:"audioElement",autoplay:""},Zm={class:"avatarBackground large-rounded",ref:"background"};function Xm(r,e,t,n,p,u){const c=tt("ConnectionButton");return ce(),he("div",Jm,[ee("div",Gm,[ee("video",{class:"avatarVideoElement large-rounded",ref:"videoElement",autoplay:"",style:Id({display:n.displayFlag?"block":"none"}),onPlay:e[0]||(e[0]=(...s)=>n.emitRequestGreetings&&n.emitRequestGreetings(...s))},null,36),ee("audio",Qm,null,512),ee("canvas",Zm,null,512)]),Xr(c,{onConnect:n.handleConnect,onDisconnect:n.handleDisconnect},null,8,["onConnect","onDisconnect"])])}const zc=st(Km,[["render",Xm],["__scopeId","data-v-99d4176d"]]),Ym={name:"MainPage",components:{Header:rs,AvatarModule:zc,ChattingBox:kc},setup(){const r=Td();console.log(r.query);const e=ho(()=>r.query.course_name),t=ho(()=>r.query.course_code);return{header_title:e,course_code:t,Header:rs,AvatarModule:zc,ChattingBox:kc}}},eS={class:"Page CoursePage"};function tS(r,e,t,n,p,u){const c=tt("Header"),s=tt("AvatarModule"),i=tt("ChattingBox");return ce(),he(Lc,null,[Xr(c,{title:n.header_title},null,8,["title"]),ee("div",eS,[Xr(s,{course_code:n.course_code},null,8,["course_code"]),Xr(i)])],64)}const IC=st(Ym,[["render",tS]]);export{IC as default};
